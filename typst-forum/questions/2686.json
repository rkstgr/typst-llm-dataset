{
  "topic_metadata": {
    "id": 2686,
    "title": "Figure outline customization (number+caption) in Typst 0.13",
    "slug": "figure-outline-customization-number-caption-in-typst-0-13",
    "posts_count": 12,
    "created_at": "2025-02-05T20:13:49.524Z",
    "last_posted_at": "2025-02-07T12:08:01.837Z",
    "views": 445,
    "like_count": 1,
    "reply_count": 6,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 12,
    "accepted_answer_username": "tcfx",
    "tags": [
      "outline",
      "v0-13"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 907
  },
  "posts": [
    {
      "id": 8246,
      "post_number": 1,
      "username": "tcfx",
      "name": "Tomás Fachada",
      "created_at": "2025-02-05T20:13:49.709Z",
      "updated_at": "2025-02-05T21:35:43.477Z",
      "cooked": "<p>Now that the first RC for 0.13 is out, I thought I’d try to adapt my template. I’ve been trying to fix some outline show rules by reading the preview docs, yet there’s still a problematic part in my code that I don’t know how to fix:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">  // Make the Lists of Figures/Tables/... more concise and easier to read, like in the LaTeX templates\n  show outline.entry: it =&gt; context {\n    if it.element.has(\"kind\") {\n      let loc = it.element.location()\n\n      if counter(figure.where(kind: it.element.kind)).at(loc).first() == 1 {\n        v(1em)\n      }\n\n      show link: set text(rgb(\"000000\"))\n      link(loc,\n        box(it.body.children.at(2), width: 2.6em) // figure number\n        + it.body.children.slice(4).join()        // figure caption\n        + box(it.fill, width: 1fr)\n        + it.page\n      )\n    } else {\n      it\n    }\n  }\n</code></pre>\n<p>This code serves to visually simplify figure outlines, by using <code>show</code> rules to, among other things, hide the supplements. The problematic part is here:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">      link(loc,\n        box(it.body.children.at(2), width: 2.6em) // figure number\n        + it.body.children.slice(4).join()        // figure caption\n        + box(it.fill, width: 1fr)\n        + it.page\n      )\n</code></pre>\n<p>While I understood <s>that <code>it.body</code> is now <code>it.element.body</code> and</s> that <code>it.page</code> is now <code>it.page()</code>, I have no idea of where the numbers and captions of the figure went. How can I replicate those?</p>",
      "raw": "Now that the first RC for 0.13 is out, I thought I'd try to adapt my template. I've been trying to fix some outline show rules by reading the preview docs, yet there's still a problematic part in my code that I don't know how to fix:\n\n```typc\n  // Make the Lists of Figures/Tables/... more concise and easier to read, like in the LaTeX templates\n  show outline.entry: it => context {\n    if it.element.has(\"kind\") {\n      let loc = it.element.location()\n\n      if counter(figure.where(kind: it.element.kind)).at(loc).first() == 1 {\n        v(1em)\n      }\n\n      show link: set text(rgb(\"000000\"))\n      link(loc,\n        box(it.body.children.at(2), width: 2.6em) // figure number\n        + it.body.children.slice(4).join()        // figure caption\n        + box(it.fill, width: 1fr)\n        + it.page\n      )\n    } else {\n      it\n    }\n  }\n```\n\nThis code serves to visually simplify figure outlines, by using `show` rules to, among other things, hide the supplements. The problematic part is here:\n\n```typc\n      link(loc,\n        box(it.body.children.at(2), width: 2.6em) // figure number\n        + it.body.children.slice(4).join()        // figure caption\n        + box(it.fill, width: 1fr)\n        + it.page\n      )\n```\n\nWhile I understood ~~that `it.body` is now `it.element.body` and~~ that `it.page` is now `it.page()`, I have no idea of where the numbers and captions of the figure went. How can I replicate those?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 65,
      "score": 1292.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 515
    },
    {
      "id": 8248,
      "post_number": 2,
      "username": "flokl",
      "name": "",
      "created_at": "2025-02-05T20:46:54.811Z",
      "updated_at": "2025-02-05T21:07:57.317Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/tcfx\">@tcfx</a>,<br>\nif you use the web app or the Tinymist extension, you can hover with your mouse pointer over code, for example <code>it.element</code> and see all the internal fields of the element.<br>\nTo get the caption you need to use <s><code>it.element.caption.body</code></s> Edit: see laurmaedje’s answer</p>\n<p>The correct figure number is a bit more complicated, you need: <code>numbering(it.element.numbering, ..it.element.counter.at(it.element.location()))</code></p>",
      "raw": "Hi @tcfx,\nif you use the web app or the Tinymist extension, you can hover with your mouse pointer over code, for example `it.element` and see all the internal fields of the element. \nTo get the caption you need to use ~~`it.element.caption.body`~~ Edit: see laurmaedje's answer\n\nThe correct figure number is a bit more complicated, you need: `numbering(it.element.numbering, ..it.element.counter.at(it.element.location()))`",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 62,
      "score": 17.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 8
    },
    {
      "id": 8249,
      "post_number": 3,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2025-02-05T20:54:26.123Z",
      "updated_at": "2025-02-05T20:54:26.123Z",
      "cooked": "<p>To replace <code>it.body</code>, you should be using <code>it.body()</code> rather than <code>it.element.body</code>. The numbering is now separate and accessible via <code>it.prefix()</code>, so you don’t have to go through the whole ordeal with <code>numbering(..)</code> etc.</p>\n<p>The preview outline entry docs are a bit messed up because the docs generator choked on methods in a sub-element. We need to fix that before the proper release.</p>",
      "raw": "To replace `it.body`, you should be using `it.body()` rather than `it.element.body`. The numbering is now separate and accessible via `it.prefix()`, so you don't have to go through the whole ordeal with `numbering(..)` etc.\n\nThe preview outline entry docs are a bit messed up because the docs generator choked on methods in a sub-element. We need to fix that before the proper release.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 60,
      "score": 82.0,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    },
    {
      "id": 8250,
      "post_number": 4,
      "username": "flokl",
      "name": "",
      "created_at": "2025-02-05T21:11:07.752Z",
      "updated_at": "2025-02-05T21:11:33.914Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/laurmaedje\">@laurmaedje</a> uhh I was confused because the functions did not show up in autocomplete.<br>\nIf no supplement should be displayed I guess the whole  <code>numbering(...)</code> is needed, or is there a better way?</p>",
      "raw": "@laurmaedje uhh I was confused because the functions did not show up in autocomplete.\nIf no supplement should be displayed I guess the whole  `numbering(...)` is needed, or is there a better way?",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 55,
      "score": 16.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 8
    },
    {
      "id": 8251,
      "post_number": 5,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2025-02-05T21:40:17.214Z",
      "updated_at": "2025-02-05T21:40:17.214Z",
      "cooked": "<p>For headings, no supplement will be added, but for figures it is indeed added and if you don’t want that the <code>numbering</code> stuff is neccessary. Will check about the autocomplete not working.</p>",
      "raw": "For headings, no supplement will be added, but for figures it is indeed added and if you don't want that the `numbering` stuff is neccessary. Will check about the autocomplete not working.",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 55,
      "score": 16.0,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    },
    {
      "id": 8252,
      "post_number": 6,
      "username": "tcfx",
      "name": "Tomás Fachada",
      "created_at": "2025-02-05T21:52:32.966Z",
      "updated_at": "2025-02-05T21:52:32.966Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/laurmaedje\">@laurmaedje</a> <a class=\"mention\" href=\"/u/flokl\">@flokl</a> I now have this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">      link(loc,\n        box(numbering(it.element.numbering, ..it.element.counter.at(it.element.location())), width: 2.6em)  // figure number\n        + it.body()                     // figure caption\n        + box(it.fill, width: 1fr)\n        + it.page()\n      )\n</code></pre>\n<p>And the output is this:</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/e/ed388baca79c131bd5c43f53a61412b0071d6d37.png\" alt=\"Screenshot_20250205_214426\" data-base62-sha1=\"xQyj9nLLLY0w16NwZ6BCk8GvWDR\" width=\"651\" height=\"203\"></p>\n<p>When it should be this:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/5f843a007c5ab3801b59c8c8fd762613f7d467df.png\" data-download-href=\"https://forum.typst.app/uploads/default/5f843a007c5ab3801b59c8c8fd762613f7d467df\" title=\"Screenshot_20250205_214646\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/5f843a007c5ab3801b59c8c8fd762613f7d467df_2_690x339.png\" alt=\"Screenshot_20250205_214646\" data-base62-sha1=\"dCYExfK86SRy1zY7iyAso21D2WP\" width=\"690\" height=\"339\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/5f843a007c5ab3801b59c8c8fd762613f7d467df_2_690x339.png, https://forum.typst.app/uploads/default/original/2X/5/5f843a007c5ab3801b59c8c8fd762613f7d467df.png 1.5x, https://forum.typst.app/uploads/default/original/2X/5/5f843a007c5ab3801b59c8c8fd762613f7d467df.png 2x\" data-dominant-color=\"F7F7F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">Screenshot_20250205_214646</span><span class=\"informations\">832×409 39.3 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>(ignore 1.3/1.4/B.2, since those three are commented out in 0.13 for now due to an issue I’ll post about later)</p>",
      "raw": "@laurmaedje @flokl I now have this:\n\n```typ\n      link(loc,\n        box(numbering(it.element.numbering, ..it.element.counter.at(it.element.location())), width: 2.6em)  // figure number\n        + it.body()                     // figure caption\n        + box(it.fill, width: 1fr)\n        + it.page()\n      )\n```\n\nAnd the output is this:\n\n![Screenshot_20250205_214426|651x203](upload://xQyj9nLLLY0w16NwZ6BCk8GvWDR.png)\n\nWhen it should be this:\n\n![Screenshot_20250205_214646|690x339](upload://dCYExfK86SRy1zY7iyAso21D2WP.png)\n\n(ignore 1.3/1.4/B.2, since those three are commented out in 0.13 for now due to an issue I'll post about later)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 55,
      "score": 16.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 515
    },
    {
      "id": 8256,
      "post_number": 7,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2025-02-06T07:16:22.161Z",
      "updated_at": "2025-02-06T07:16:22.161Z",
      "cooked": "<p>You should use a block instead a box. The old outline used line breaks between entries whereas the new one expects them to be blocks (as that makes much more sense semantically and means we can use show-set rules for block spacing).</p>",
      "raw": "You should use a block instead a box. The old outline used line breaks between entries whereas the new one expects them to be blocks (as that makes much more sense semantically and means we can use show-set rules for block spacing).",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 49,
      "score": 14.8,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    },
    {
      "id": 8264,
      "post_number": 8,
      "username": "tcfx",
      "name": "Tomás Fachada",
      "created_at": "2025-02-06T11:40:07.621Z",
      "updated_at": "2025-02-06T15:16:21.400Z",
      "cooked": "<p>I was initially gonna use a grid as a workaround, but that makes sense, and it may explain a spacing issue I am having with the main outline.</p>\n<p>That being said, the main problem remains: I’m still unable to correctly fetch the numbers of the figures, which are chapter-relative, with “1.1” numbering for normal chapters and “A.1” numbering for appendices. Currently 1.1 becomes 0.1, B.1 becomes -.1, etc.</p>",
      "raw": "I was initially gonna use a grid as a workaround, but that makes sense, and it may explain a spacing issue I am having with the main outline.\n\nThat being said, the main problem remains: I'm still unable to correctly fetch the numbers of the figures, which are chapter-relative, with \"1.1\" numbering for normal chapters and \"A.1\" numbering for appendices. Currently 1.1 becomes 0.1, B.1 becomes -.1, etc.",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 45,
      "score": 9.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 515
    },
    {
      "id": 8321,
      "post_number": 9,
      "username": "tcfx",
      "name": "Tomás Fachada",
      "created_at": "2025-02-07T10:18:46.800Z",
      "updated_at": "2025-02-07T10:18:46.800Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/laurmaedje\">@laurmaedje</a> So, is it still possible to fetch the full chapter-relative numbers in 0.13?</p>\n<p>This is the current code and output:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">      block(\n        link(loc,\n          box(numbering(it.element.numbering, ..it.element.counter.at(it.element.location())), width: 2.6em)  // figure number\n          + it.body()                     // figure caption\n          + box(it.fill, width: 1fr)\n          + it.page()\n        )\n      )\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/0/006dea51450b466a877148efce38d9544826fc20.png\" alt=\"Screenshot_20250207_101517\" data-base62-sha1=\"3NuwYy7brk3thQYOVOfHP4gbq8\" width=\"670\" height=\"242\"></p>",
      "raw": "@laurmaedje So, is it still possible to fetch the full chapter-relative numbers in 0.13?\n\nThis is the current code and output:\n\n```typ\n      block(\n        link(loc,\n          box(numbering(it.element.numbering, ..it.element.counter.at(it.element.location())), width: 2.6em)  // figure number\n          + it.body()                     // figure caption\n          + box(it.fill, width: 1fr)\n          + it.page()\n        )\n      )\n```\n\n![Screenshot_20250207_101517|670x242](upload://3NuwYy7brk3thQYOVOfHP4gbq8.png)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 39,
      "score": 37.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 515
    },
    {
      "id": 8322,
      "post_number": 10,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2025-02-07T10:24:46.605Z",
      "updated_at": "2025-02-07T10:24:46.605Z",
      "cooked": "<p>Typst doesn’t and didn’t natively support chapter-relative numbers, so nothing has really changed in that regard. Maybe you loaded some package that implemented this?</p>",
      "raw": "Typst doesn't and didn't natively support chapter-relative numbers, so nothing has really changed in that regard. Maybe you loaded some package that implemented this?",
      "reply_to_post_number": 9,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 38,
      "score": 17.6,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    },
    {
      "id": 8324,
      "post_number": 11,
      "username": "tcfx",
      "name": "Tomás Fachada",
      "created_at": "2025-02-07T11:25:38.266Z",
      "updated_at": "2025-02-07T11:25:38.266Z",
      "cooked": "<p>I implemented it manually, <a href=\"https://github.com/tfachada/thesist/blob/main/src/figure-numbering.typ\" rel=\"noopener nofollow ugc\">here</a>. Can’t this still be considered a regression, though? I honestly think it would make sense to have a way to call <code>it.prefix()</code> without the supplement. This way, my template would still replicate the LaTeX one rather than losing functionality relative to 0.12. For comparison with an already existing functionality, it would be something like how calling a labeled figure like <code>@this[]</code> removes the supplement in the reference.</p>",
      "raw": "I implemented it manually, [here](https://github.com/tfachada/thesist/blob/main/src/figure-numbering.typ). Can't this still be considered a regression, though? I honestly think it would make sense to have a way to call `it.prefix()` without the supplement. This way, my template would still replicate the LaTeX one rather than losing functionality relative to 0.12. For comparison with an already existing functionality, it would be something like how calling a labeled figure like `@this[]` removes the supplement in the reference.",
      "reply_to_post_number": 10,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 12.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 515
    },
    {
      "id": 8328,
      "post_number": 12,
      "username": "tcfx",
      "name": "Tomás Fachada",
      "created_at": "2025-02-07T12:08:01.837Z",
      "updated_at": "2025-02-07T12:08:01.837Z",
      "cooked": "<p>Update: I figured it out myself. It’s <code>it.prefix().children.at(2)</code>.</p>\n<p>The final code thus becomes:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">  // Make the Lists of Figures/Tables/... more concise and easier to read, like in the LaTeX templates\n  show outline.entry: it =&gt; context {\n    if it.element.has(\"kind\") {\n      let loc = it.element.location()\n\n      if counter(figure.where(kind: it.element.kind)).at(loc).first() == 1 {\n        v(1em)\n      }\n\n      show link: set text(rgb(\"000000\"))\n      block(\n        link(loc,\n          box(it.prefix().children.at(2), width: 2.6em)  // figure number\n          + it.body()                     // figure caption\n          + box(it.fill, width: 1fr)\n          + it.page()\n        )\n      )\n    } else {\n      it\n    }\n  }\n</code></pre>",
      "raw": "Update: I figured it out myself. It's `it.prefix().children.at(2)`.\n\nThe final code thus becomes:\n\n```typ\n  // Make the Lists of Figures/Tables/... more concise and easier to read, like in the LaTeX templates\n  show outline.entry: it => context {\n    if it.element.has(\"kind\") {\n      let loc = it.element.location()\n\n      if counter(figure.where(kind: it.element.kind)).at(loc).first() == 1 {\n        v(1em)\n      }\n\n      show link: set text(rgb(\"000000\"))\n      block(\n        link(loc,\n          box(it.prefix().children.at(2), width: 2.6em)  // figure number\n          + it.body()                     // figure caption\n          + box(it.fill, width: 1fr)\n          + it.page()\n        )\n      )\n    } else {\n      it\n    }\n  }\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 72.0,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 515
    }
  ],
  "scraped_at": "2025-06-10T09:52:00.420245"
}