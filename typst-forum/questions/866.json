{
  "topic_metadata": {
    "id": 866,
    "title": "How to include multiple headings in table using a function?",
    "slug": "how-to-include-multiple-headings-in-table-using-a-function",
    "posts_count": 8,
    "created_at": "2024-10-02T09:04:00.411Z",
    "last_posted_at": "2024-10-08T08:23:15.783Z",
    "views": 366,
    "like_count": 2,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Tinger",
    "tags": [
      "scripting",
      "tables",
      "context"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 763
  },
  "posts": [
    {
      "id": 3195,
      "post_number": 1,
      "username": "flixz02",
      "name": "",
      "created_at": "2024-10-02T09:04:00.584Z",
      "updated_at": "2024-10-10T16:12:15.881Z",
      "cooked": "<p>I want to create a function (in an extra typst file), which creates an table including first level headings using a loop. The following is what i have so far, but it only returns the titles of the heading and doesn’t put it into separate table cells. I also would like to omit some first level headings, for example the first one, which is the heading of the table of contents.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let title_headings() = {\n  table(\n    row-gutter: 1cm,\n    columns: (4fr, 1fr),\n    fill: (x, y) =&gt;\n      if x == 1 {\n        color.rgb(\"#aa0000\")\n      },\n    align: center + horizon,\n\n    context{\n      for element in query(heading.where(level: 1)) {\n        table.cell(text(size: 14pt, element.body))\n        table.cell(text(size: 26pt, fill: white, \"1\"))\n      }\n    }\n  )\n}\n</code></pre>\n<p>This function is included in a grid a template file like this. The template is then used in the main document</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#grid(\n      ...\n      [#title_headings()],\n      ...\n  )\n</code></pre>\n<p>The end result should look like this.<br>\n<img src=\"https://forum.typst.app/uploads/default/original/1X/673bca6e9683908a049900cb30ff752a93a8627b.png\" alt=\"Screenshot 2024-10-02 105749\" data-base62-sha1=\"eJfhoqfFUXcSXWbbeiKA97odK9t\" width=\"320\" height=\"409\"></p>",
      "raw": "I want to create a function (in an extra typst file), which creates an table including first level headings using a loop. The following is what i have so far, but it only returns the titles of the heading and doesn't put it into separate table cells. I also would like to omit some first level headings, for example the first one, which is the heading of the table of contents.\n\n```typ\n#let title_headings() = {\n  table(\n    row-gutter: 1cm,\n    columns: (4fr, 1fr),\n    fill: (x, y) =>\n      if x == 1 {\n        color.rgb(\"#aa0000\")\n      },\n    align: center + horizon,\n\n    context{\n      for element in query(heading.where(level: 1)) {\n        table.cell(text(size: 14pt, element.body))\n        table.cell(text(size: 26pt, fill: white, \"1\"))\n      }\n    }\n  )\n}\n```\nThis function is included in a grid a template file like this. The template is then used in the main document\n```typ\n#grid(\n      ...\n      [#title_headings()],\n      ...\n  )\n```\nThe end result should look like this.\n![Screenshot 2024-10-02 105749|320x409](upload://eJfhoqfFUXcSXWbbeiKA97odK9t.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 52,
      "score": 1390.4,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 519
    },
    {
      "id": 3197,
      "post_number": 2,
      "username": "Tinger",
      "name": "Tinger",
      "created_at": "2024-10-02T09:45:56.669Z",
      "updated_at": "2024-10-02T09:45:56.669Z",
      "cooked": "<p>Hi, welcome to the forum!</p>\n<p>A context expression is a single bit of content, which cannot be inspected anymore, the table gets this single bit of content and treats it as a single cell (See <a href=\"https://forum.typst.app/t/why-is-the-value-i-receive-from-context-always-content/164\" class=\"inline-onebox\">Why is the value I receive from context always content?</a>). This means that if you need more than one cell out of the context expression you need to move your context further up, I’ve done that here by lifting it outside the table. Additionally looping over cells and just placing them next to each other will also just create a single long bit of content. The solution is to create an array of individual cells, which are then all applied as individual cells to table by the use of the spread operator <code>..</code>. Because the inner loop returned not one, but two cells, we flatten the inner arrays, otherwise we’d spread pairs of cells into the table, not cells itself.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let title-headings() = context table(\n  // ..\n  ..query(heading.where(level: 1))\n    .map(element =&gt; (\n      table.cell(text(size: 14pt, element.body)),\n      table.cell(text(size: 26pt, fill: white, \"1\")),\n    ))\n    .flatten()\n)\n</code></pre>",
      "raw": "Hi, welcome to the forum!\n\nA context expression is a single bit of content, which cannot be inspected anymore, the table gets this single bit of content and treats it as a single cell (See https://forum.typst.app/t/why-is-the-value-i-receive-from-context-always-content/164). This means that if you need more than one cell out of the context expression you need to move your context further up, I've done that here by lifting it outside the table. Additionally looping over cells and just placing them next to each other will also just create a single long bit of content. The solution is to create an array of individual cells, which are then all applied as individual cells to table by the use of the spread operator `..`. Because the inner loop returned not one, but two cells, we flatten the inner arrays, otherwise we'd spread pairs of cells into the table, not cells itself.\n\n```typ\n#let title-headings() = context table(\n  // ..\n  ..query(heading.where(level: 1))\n    .map(element => (\n      table.cell(text(size: 14pt, element.body)),\n      table.cell(text(size: 26pt, fill: white, \"1\")),\n    ))\n    .flatten()\n)\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 41,
      "score": 218.2,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 29
    },
    {
      "id": 3209,
      "post_number": 3,
      "username": "Andrew",
      "name": "",
      "created_at": "2024-10-02T12:46:07.554Z",
      "updated_at": "2024-10-02T13:06:55.303Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Tinger\" data-post=\"2\" data-topic=\"866\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/tinger/48/44_2.png\" class=\"avatar\"> Tinger:</div>\n<blockquote>\n<p>A context expression is a single bit of content, which cannot be inspected anymore</p>\n</blockquote>\n</aside>\n<p>I think you have used “anymore” here in such a way that makes it confusing. <a href=\"https://typst.app/docs/reference/context/\"><code>context</code></a> is <em>always</em> opaque and <strong>never</strong> can be inspected. So “anymore” here refers to “inside <code>context</code>” and “outside <code>context</code>”: you can inspect whatever is written in the <code>context</code> clause/block, but when you go outside (hehe), the <code>context</code>’s content can’t be inspected <em>anymore</em> (it becomes opaque).</p>\n<p>Also a few useful links:</p>\n<ul>\n<li><a href=\"https://typst.app/docs/reference/foundations/arguments/#spreading\">spread operator</a></li>\n<li><a href=\"https://typst.app/docs/reference/foundations/array/#definitions-flatten\"><code>array.flatten()</code></a></li>\n</ul>",
      "raw": "[quote=\"Tinger, post:2, topic:866\"]\nA context expression is a single bit of content, which cannot be inspected anymore\n[/quote]\n\nI think you have used \"anymore\" here in such a way that makes it confusing. [`context`](https://typst.app/docs/reference/context/) is *always* opaque and **never** can be inspected. So \"anymore\" here refers to \"inside `context`\" and \"outside `context`\": you can inspect whatever is written in the `context` clause/block, but when you go outside (hehe), the `context`'s content can't be inspected *anymore* (it becomes opaque).\n\nAlso a few useful links:\n- [spread operator](https://typst.app/docs/reference/foundations/arguments/#spreading)\n- [`array.flatten()`](https://typst.app/docs/reference/foundations/array/#definitions-flatten)",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 38,
      "score": 37.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 3211,
      "post_number": 4,
      "username": "Tinger",
      "name": "Tinger",
      "created_at": "2024-10-02T13:04:36.562Z",
      "updated_at": "2024-10-02T13:04:36.562Z",
      "cooked": "<p>Yes, that’s how it was meant, couldn’t have said it better!</p>",
      "raw": "Yes, that's how it was meant, couldn't have said it better!",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 37,
      "score": 27.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 29
    },
    {
      "id": 3212,
      "post_number": 5,
      "username": "Andrew",
      "name": "",
      "created_at": "2024-10-02T13:05:22.740Z",
      "updated_at": "2024-10-02T13:13:02.446Z",
      "cooked": "<p>Building on top of <a class=\"mention\" href=\"/u/tinger\">@Tinger</a>’s function, here is a code that should give you the output you desire:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set text(14pt, font: \"Libertinus Sans\")\n#let title-headings() = context table(\n  align: center + horizon,\n  row-gutter: 1em,\n  stroke: 0.5pt,\n  inset: (left: 5pt, rest: 1pt),\n  ..query(heading.where(level: 1))\n    .enumerate()\n    .map(((i, element)) =&gt; stack(\n      dir: ltr,\n      spacing: 1em,\n      text(element.body),\n      square(\n        fill: red,\n        stroke: black + 0.5pt,\n        text(white, size: 0.9em, str(i + 1))\n      )\n    ))\n    .flatten()\n)\n\n#title-headings()\n\n= Heading 1\n== Subtitle\n\n= Heading 2\n== Subtitle\n\n= Heading 3\n== Subtitle\n=== Subsubtitle\n\n= Heading 4\n== Subtitle\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/1X/5d3dc95227c249e69713c43cc37256eba7efc912.png\" data-download-href=\"https://forum.typst.app/uploads/default/5d3dc95227c249e69713c43cc37256eba7efc912\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/5d3dc95227c249e69713c43cc37256eba7efc912_2_121x500.png\" alt=\"image\" data-base62-sha1=\"diQMsb85OMasQIxv8Zza7TP3hbI\" width=\"121\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/1X/5d3dc95227c249e69713c43cc37256eba7efc912_2_121x500.png, https://forum.typst.app/uploads/default/original/1X/5d3dc95227c249e69713c43cc37256eba7efc912.png 1.5x, https://forum.typst.app/uploads/default/original/1X/5d3dc95227c249e69713c43cc37256eba7efc912.png 2x\" data-dominant-color=\"1B1817\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">175×720 25.4 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>If some padding/inset doesn’t look perfect, you can always tweak them to your liking. :)</p>\n<p>P.S. Not sure why <code>table.cell()</code> wrapper was used there, pretty sure it’s unnecessary.</p>",
      "raw": "Building on top of @Tinger's function, here is a code that should give you the output you desire:\n\n```typ\n#set text(14pt, font: \"Libertinus Sans\")\n#let title-headings() = context table(\n  align: center + horizon,\n  row-gutter: 1em,\n  stroke: 0.5pt,\n  inset: (left: 5pt, rest: 1pt),\n  ..query(heading.where(level: 1))\n    .enumerate()\n    .map(((i, element)) => stack(\n      dir: ltr,\n      spacing: 1em,\n      text(element.body),\n      square(\n        fill: red,\n        stroke: black + 0.5pt,\n        text(white, size: 0.9em, str(i + 1))\n      )\n    ))\n    .flatten()\n)\n\n#title-headings()\n\n= Heading 1\n== Subtitle\n\n= Heading 2\n== Subtitle\n\n= Heading 3\n== Subtitle\n=== Subsubtitle\n\n= Heading 4\n== Subtitle\n```\n\n![image|121x500](upload://diQMsb85OMasQIxv8Zza7TP3hbI.png)\n\nIf some padding/inset doesn't look perfect, you can always tweak them to your liking. :)\n\nP.S. Not sure why `table.cell()` wrapper was used there, pretty sure it's unnecessary.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 39,
      "score": 17.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 3254,
      "post_number": 6,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2024-10-02T19:32:52.840Z",
      "updated_at": "2024-10-02T19:33:04.696Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/flixz02\">@flixz02</a>, thanks for your question! Could you maybe try to revise your post’s title so others can find it easier in the future? The <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\">question guidelines </a> recommend a complete question:</p>\n<blockquote>\n<p><strong>Good titles are questions you would ask your friend about Typst.</strong></p>\n</blockquote>\n<p>I thought about editing the title myself, but I didn’t want to miss your intent – after all the problem revolved around <code>context</code> in addition to tables. I would also encourage you to add these labels (<a class=\"hashtag-cooked\" href=\"/tag/context\" data-type=\"tag\" data-slug=\"context\" data-id=\"61\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>context</span></a>, <a class=\"hashtag-cooked\" href=\"/tag/tables\" data-type=\"tag\" data-slug=\"tables\" data-id=\"53\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>tables</span></a>) while you’re doing so.</p>\n<p>Thank you!</p>",
      "raw": "Hi @flixz02, thanks for your question! Could you maybe try to revise your post’s title so others can find it easier in the future? The [question guidelines ](https://forum.typst.app/t/how-to-post-in-the-questions-category/11) recommend a complete question:\n\n> **Good titles are questions you would ask your friend about Typst.**\n\nI thought about editing the title myself, but I didn't want to miss your intent -- after all the problem revolved around `context` in addition to tables. I would also encourage you to add these labels (#context, #tables) while you're doing so.\n\nThank you!",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 27.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 3531,
      "post_number": 7,
      "username": "flixz02",
      "name": "",
      "created_at": "2024-10-07T17:56:37.465Z",
      "updated_at": "2024-10-07T17:56:37.465Z",
      "cooked": "<p>Thanks to all of you for your help. Got it to work just the way I wanted <img src=\"https://forum.typst.app/images/emoji/apple/smiley.png?v=12\" title=\":smiley:\" class=\"emoji\" alt=\":smiley:\" loading=\"lazy\" width=\"20\" height=\"20\"><br>\n<a class=\"mention\" href=\"/u/sillyfreak\">@SillyFreak</a> not sure how, if I don’t figure out how maybe you just do it.</p>",
      "raw": "Thanks to all of you for your help. Got it to work just the way I wanted :smiley: \n@SillyFreak not sure how, if I don't figure out how maybe you just do it.",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 35.2,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 519
    },
    {
      "id": 3544,
      "post_number": 8,
      "username": "Tinger",
      "name": "Tinger",
      "created_at": "2024-10-08T08:23:15.783Z",
      "updated_at": "2024-10-08T08:23:15.783Z",
      "cooked": "<p>Glad we could help, could you mark one of the replies as a solution so others can find it easier?</p>",
      "raw": "Glad we could help, could you mark one of the replies as a solution so others can find it easier?",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 10.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 29
    }
  ],
  "scraped_at": "2025-06-10T09:57:34.964122"
}