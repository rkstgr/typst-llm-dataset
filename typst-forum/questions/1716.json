{
  "topic_metadata": {
    "id": 1716,
    "title": "How to change numbering in Appendix?",
    "slug": "how-to-change-numbering-in-appendix",
    "posts_count": 7,
    "created_at": "2024-11-13T22:16:24.394Z",
    "last_posted_at": "2024-12-03T13:26:39.670Z",
    "views": 1025,
    "like_count": 7,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "slowjo",
    "tags": [
      "scripting",
      "numbering"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 799
  },
  "posts": [
    {
      "id": 5607,
      "post_number": 1,
      "username": "kazuyanagimoto",
      "name": "Kazuharu Yanagimoto",
      "created_at": "2024-11-13T22:16:24.774Z",
      "updated_at": "2024-11-14T19:37:52.405Z",
      "cooked": "<p>I’m writing a thesis and want to reset a numbering in Appendix.</p>\n<p>I managed to reset the numbering of the headings by</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set heading(numbering: \"A.1.1\", supplement: [Appendix])\n#counter(heading).update(0)\n#text(size: 2em)[Appendix]\n</code></pre>\n<p>I also want to reset the numbering of Figures and Tables and to use a numbering like “Table A1”, “Figure A2”. Is it possible to implement it?</p>",
      "raw": "I'm writing a thesis and want to reset a numbering in Appendix.\n\nI managed to reset the numbering of the headings by\n\n```typst\n#set heading(numbering: \"A.1.1\", supplement: [Appendix])\n#counter(heading).update(0)\n#text(size: 2em)[Appendix]\n```\n\nI also want to reset the numbering of Figures and Tables and to use a numbering like \"Table A1\", \"Figure A2\". Is it possible to implement it?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 90,
      "score": 5238.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 803
    },
    {
      "id": 5608,
      "post_number": 2,
      "username": "slowjo",
      "name": "slowjo",
      "created_at": "2024-11-13T23:03:29.835Z",
      "updated_at": "2024-11-13T23:03:29.835Z",
      "cooked": "<p>Typst currently needs a workaround for this to work, as displaying the headings somehow doesn’t correctly track the numbering that’s set.</p>\n<p>I’m in the same situation as you, and I currently got something like the following in my template:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let backmatter(content) = {\n\tset heading(numbering: \"A.1\")\n\tcounter(heading).update(0)\n\tstate(\"backmatter\").update(true)\n\tcontent\n}\n#set figure(numbering: it =&gt; {\n\t//workaround...\n\tlet appx = state(\"backmatter\", false).get()\n\tlet alph = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n\tlet hdr = counter(heading).get().at(0)\n\tif appx [#alph.at(hdr - 1).#it]\n\telse [#hdr.#it]\n})\n#show heading.where(level: 1): hdr =&gt; {\n\tcounter(figure.where(kind:image)).update(0)\n\tcounter(figure.where(kind:table)).update(0)\n\thdr\n}\n\n// Example\n#set heading(numbering: \"1.1\")\n#let testfig(caption) = {\n\tfigure(box(width:3cm, height:1cm, stroke: 1pt), caption: caption)\n}\n#set page(width: auto, height: auto, margin: 2em)\n\n= Start\nCiting the figures in order @first, @second, and @third.\n#testfig[First Box] &lt;first&gt;\n\n= Next\n#lorem(10)\n#testfig[Second Box] &lt;second&gt;\n\n#show: backmatter\n\n= Appendix\n#lorem(10)\n#testfig[Third Box] &lt;third&gt;\n</code></pre>\n<p>which produces<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/3/33f3171480662163a9c70c61e4bb76d5cf9e628c.png\" data-download-href=\"https://forum.typst.app/uploads/default/33f3171480662163a9c70c61e4bb76d5cf9e628c\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/3/33f3171480662163a9c70c61e4bb76d5cf9e628c_2_504x500.png\" alt=\"image\" data-base62-sha1=\"7pzauBljOrvCoPmwqOdr4odnkvy\" width=\"504\" height=\"500\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/3/33f3171480662163a9c70c61e4bb76d5cf9e628c_2_504x500.png, https://forum.typst.app/uploads/default/original/2X/3/33f3171480662163a9c70c61e4bb76d5cf9e628c.png 1.5x, https://forum.typst.app/uploads/default/original/2X/3/33f3171480662163a9c70c61e4bb76d5cf9e628c.png 2x\" data-dominant-color=\"F7F7F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">661×655 106 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "Typst currently needs a workaround for this to work, as displaying the headings somehow doesn't correctly track the numbering that's set.\n\nI'm in the same situation as you, and I currently got something like the following in my template:\n\n```typst\n#let backmatter(content) = {\n\tset heading(numbering: \"A.1\")\n\tcounter(heading).update(0)\n\tstate(\"backmatter\").update(true)\n\tcontent\n}\n#set figure(numbering: it => {\n\t//workaround...\n\tlet appx = state(\"backmatter\", false).get()\n\tlet alph = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n\tlet hdr = counter(heading).get().at(0)\n\tif appx [#alph.at(hdr - 1).#it]\n\telse [#hdr.#it]\n})\n#show heading.where(level: 1): hdr => {\n\tcounter(figure.where(kind:image)).update(0)\n\tcounter(figure.where(kind:table)).update(0)\n\thdr\n}\n\n// Example\n#set heading(numbering: \"1.1\")\n#let testfig(caption) = {\n\tfigure(box(width:3cm, height:1cm, stroke: 1pt), caption: caption)\n}\n#set page(width: auto, height: auto, margin: 2em)\n\n= Start\nCiting the figures in order @first, @second, and @third.\n#testfig[First Box] <first>\n\n= Next\n#lorem(10)\n#testfig[Second Box] <second>\n\n#show: backmatter\n\n= Appendix\n#lorem(10)\n#testfig[Third Box] <third>\n```\n\nwhich produces \n![image|504x500](upload://7pzauBljOrvCoPmwqOdr4odnkvy.png)",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 3,
      "reads": 89,
      "score": 157.8,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 793
    },
    {
      "id": 5625,
      "post_number": 3,
      "username": "kazuyanagimoto",
      "name": "Kazuharu Yanagimoto",
      "created_at": "2024-11-14T09:54:05.161Z",
      "updated_at": "2024-11-14T09:54:05.161Z",
      "cooked": "<p>It works! Thank you. Hope Typst will officially support these features.</p>",
      "raw": "It works! Thank you. Hope Typst will officially support these features.",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 77,
      "score": 20.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 803
    },
    {
      "id": 5640,
      "post_number": 4,
      "username": "PgBiel",
      "name": "",
      "created_at": "2024-11-14T19:38:00.748Z",
      "updated_at": "2024-11-14T19:38:00.748Z",
      "cooked": "<p>Hey <a class=\"mention\" href=\"/u/kazuyanagimoto\">@kazuyanagimoto</a>, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></p>\n<p>Make sure your title is a question you’d ask to a friend about Typst. <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hey @kazuyanagimoto, welcome to the forum! I've changed your question post's title to better fit our guidelines: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n\nMake sure your title is a question you'd ask to a friend about Typst. :wink:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 76,
      "score": 165.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 5643,
      "post_number": 5,
      "username": "PgBiel",
      "name": "",
      "created_at": "2024-11-14T19:49:17.351Z",
      "updated_at": "2024-11-14T19:49:42.834Z",
      "cooked": "<p>This is the proper way to do it (as of Typst 0.11 and 0.12)! The code inside the figure numbering function is given the original location of the figure as context, meaning any counter accesses in that function (including to the heading counter) will correctly return the value at where the figure was placed, even if the numbering is used in the outline. This won’t hold if you create a new context block inside the figure numbering function (then, the context will be relative to where the <em>numbering</em> is placed, not to the figure itself), so please don’t do that.</p>\n<p>Regarding your solution, I’d note that the numbering function can be used to specify numbering formats (such as alphabetic) instead of having to implement that on your own: <a href=\"https://typst.app/docs/reference/model/numbering/\" class=\"inline-onebox\">Numbering Function – Typst Documentation</a></p>\n<p>Therefore, your figure set rule can be improved as follows (giving the same results):</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set figure(numbering: n =&gt; {\n  let appx = state(\"backmatter\", false).get()\n  let hdr = counter(heading).get()\n  let format = if appx {\n    \"A.1.\"\n  } else {\n    \"1.1\"\n  }\n  // Replace 'hdr.first()' by '..hdr' to display\n  // all heading levels\n  numbering(format, hdr.first(), n)\n})\n</code></pre>",
      "raw": "This is the proper way to do it (as of Typst 0.11 and 0.12)! The code inside the figure numbering function is given the original location of the figure as context, meaning any counter accesses in that function (including to the heading counter) will correctly return the value at where the figure was placed, even if the numbering is used in the outline. This won't hold if you create a new context block inside the figure numbering function (then, the context will be relative to where the _numbering_ is placed, not to the figure itself), so please don't do that.\n\nRegarding your solution, I'd note that the numbering function can be used to specify numbering formats (such as alphabetic) instead of having to implement that on your own: https://typst.app/docs/reference/model/numbering/\n\nTherefore, your figure set rule can be improved as follows (giving the same results):\n\n```typ\n#set figure(numbering: n => {\n  let appx = state(\"backmatter\", false).get()\n  let hdr = counter(heading).get()\n  let format = if appx {\n    \"A.1.\"\n  } else {\n    \"1.1\"\n  }\n  // Replace 'hdr.first()' by '..hdr' to display\n  // all heading levels\n  numbering(format, hdr.first(), n)\n})\n```",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 70,
      "score": 54.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 5645,
      "post_number": 6,
      "username": "slowjo",
      "name": "slowjo",
      "created_at": "2024-11-14T21:15:44.086Z",
      "updated_at": "2024-11-14T21:15:44.086Z",
      "cooked": "<p>huh, yeah you’re right, reimplementing the numbering isn’t necessary, not sure anymore why I ended up doing that.<br>\nmy point about the numbering not being correctly tracked is that i’d like to be able to just use <code>counter(heading).display()</code>, and for it to use the correct <code>numbering</code> of the heading. This does however not work as I would expect.</p>\n<p>Your answer did however get me thinking, and I took some time to tinker. I finally figured out how to get this to work without having multiple “sources of truth” as to what <code>numbering</code> to use where. It also does away with having to use the “backmatter” <code>state</code>, and is therefore cleaner.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set figure(numbering: n =&gt; {\n\tlet hdr = counter(heading).get().first()\n\tlet num = query(\n\t\tselector(heading).before(here())\n\t).last().numbering\n\tnumbering(num, hdr, n)\n})\n</code></pre>\n<p>this seems to work correctly, in the figures, references, and outlines as well.</p>",
      "raw": "huh, yeah you're right, reimplementing the numbering isn't necessary, not sure anymore why I ended up doing that.\nmy point about the numbering not being correctly tracked is that i'd like to be able to just use `counter(heading).display()`, and for it to use the correct `numbering` of the heading. This does however not work as I would expect.\n\nYour answer did however get me thinking, and I took some time to tinker. I finally figured out how to get this to work without having multiple \"sources of truth\" as to what `numbering` to use where. It also does away with having to use the \"backmatter\" `state`, and is therefore cleaner.\n```typst\n#set figure(numbering: n => {\n\tlet hdr = counter(heading).get().first()\n\tlet num = query(\n\t\tselector(heading).before(here())\n\t).last().numbering\n\tnumbering(num, hdr, n)\n})\n```\nthis seems to work correctly, in the figures, references, and outlines as well.",
      "reply_to_post_number": 5,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 64,
      "score": 122.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 793
    },
    {
      "id": 6282,
      "post_number": 7,
      "username": "Waldo",
      "name": "Waldo",
      "created_at": "2024-12-03T13:26:39.670Z",
      "updated_at": "2024-12-03T14:12:10.207Z",
      "cooked": "<p>Any Idea how to make this work with images in a Grid using Subpar?</p>\n<pre><code class=\"lang-auto\">#import \"@preview/subpar:0.2.0\"\n#subpar.grid(align: top, gap: 2em,\n  figure(image(\"/Figures/andromeda.png\"), caption: [\n    An image of the andromeda galaxy.\n  ]), &lt;a&gt;,\n  figure(image(\"/Figures/andromeda.png\"), caption: [\n    A sunset illuminating the sky above a mountain range.\n  ]), &lt;b&gt;,\n  figure(image(\"/Figures/andromeda.png\"), caption: [\n    A sunset illuminating the sky above a mountain range.\n  ]), &lt;c&gt;,\n\n\n  columns: (0.33fr, 0.33fr, 0.33fr),\n  caption: [A figure composed of two sub figures.],\n  label: &lt;full&gt;,\n)\n</code></pre>\n<p>In my Appendix, this is becomes a numbered Figure X, while normal Figures use A.X</p>\n<p>Edit: I figured you can do the same in the numbering of the grid, but i’m not sure how to overwrite it globally:</p>\n<pre><code class=\"lang-auto\">#subpar.grid(numbering: n =&gt; {\n\tlet hdr = counter(heading).get().first()\n\tlet num = query(\n\t\tselector(heading).before(here())\n\t).last().numbering\n\tnumbering(num, hdr, n)\n},\n</code></pre>",
      "raw": "Any Idea how to make this work with images in a Grid using Subpar?\n\n```\n#import \"@preview/subpar:0.2.0\"\n#subpar.grid(align: top, gap: 2em,\n  figure(image(\"/Figures/andromeda.png\"), caption: [\n    An image of the andromeda galaxy.\n  ]), <a>,\n  figure(image(\"/Figures/andromeda.png\"), caption: [\n    A sunset illuminating the sky above a mountain range.\n  ]), <b>,\n  figure(image(\"/Figures/andromeda.png\"), caption: [\n    A sunset illuminating the sky above a mountain range.\n  ]), <c>,\n\n\n  columns: (0.33fr, 0.33fr, 0.33fr),\n  caption: [A figure composed of two sub figures.],\n  label: <full>,\n)\n```\n\nIn my Appendix, this is becomes a numbered Figure X, while normal Figures use A.X\n\nEdit: I figured you can do the same in the numbering of the grid, but i'm not sure how to overwrite it globally:\n\n\n```\n#subpar.grid(numbering: n => {\n\tlet hdr = counter(heading).get().first()\n\tlet num = query(\n\t\tselector(heading).before(here())\n\t).last().numbering\n\tnumbering(num, hdr, n)\n},\n```",
      "reply_to_post_number": 6,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 53,
      "score": 25.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 880
    }
  ],
  "scraped_at": "2025-06-10T09:54:58.211631"
}