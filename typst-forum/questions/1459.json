{
  "topic_metadata": {
    "id": 1459,
    "title": "How to get the position of an item placed by a show rule in Typst 0.12?",
    "slug": "how-to-get-the-position-of-an-item-placed-by-a-show-rule-in-typst-0-12",
    "posts_count": 6,
    "created_at": "2024-10-31T16:03:52.652Z",
    "last_posted_at": "2024-11-01T19:00:53.894Z",
    "views": 259,
    "like_count": 2,
    "reply_count": 3,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "PgBiel",
    "tags": [
      "placement",
      "v0-12"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 539
  },
  "posts": [
    {
      "id": 4913,
      "post_number": 1,
      "username": "sijo",
      "name": "",
      "created_at": "2024-10-31T16:03:52.774Z",
      "updated_at": "2024-11-01T15:38:05.372Z",
      "cooked": "<p>Let’s say I <code>place</code> a title using a show rule. In Typst 0.11 I could get its position with a query, but in 0.12 I get the position of the <code>place</code> call:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(margin: 20pt, paper: \"a6\", flipped: true)\n#set block(spacing: 0pt)\n\n#show heading: it =&gt; place(\n  top,\n  float: true,\n  clearance: 0pt,\n  block(width: 100%, height: 40pt, fill: luma(90%), it),\n)\n  \n#block(width: 100%, height: 100pt, fill: eastern)\n\n= Title\n\n#context locate(heading).position()\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/c/c376cb9ce29a52e6de69cd69bacb24213e2df730.png\" alt=\"image\" data-base62-sha1=\"rT9CJ4nJpO1gY6RT4r7nTfgLRD2\" width=\"336\" height=\"235\"></p>\n<p>In Typst 0.11 this would show <code>y: 20pt</code> which is indeed the vertical position of the title. How can I get it in Typst 0.12?</p>",
      "raw": "Let's say I `place` a title using a show rule. In Typst 0.11 I could get its position with a query, but in 0.12 I get the position of the `place` call:\n\n```typ\n#set page(margin: 20pt, paper: \"a6\", flipped: true)\n#set block(spacing: 0pt)\n\n#show heading: it => place(\n  top,\n  float: true,\n  clearance: 0pt,\n  block(width: 100%, height: 40pt, fill: luma(90%), it),\n)\n  \n#block(width: 100%, height: 100pt, fill: eastern)\n\n= Title\n\n#context locate(heading).position()\n```\n\n![image|448x314, 75%](upload://rT9CJ4nJpO1gY6RT4r7nTfgLRD2.png)\n\nIn Typst 0.11 this would show `y: 20pt` which is indeed the vertical position of the title. How can I get it in Typst 0.12?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 42,
      "score": 998.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 4914,
      "post_number": 2,
      "username": "jbirnick",
      "name": "Johann Birnick",
      "created_at": "2024-10-31T19:22:14.015Z",
      "updated_at": "2024-10-31T19:25:33.154Z",
      "cooked": "<p>First, note that <code>locate</code> deprecated. Instead use:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#context query(heading).first().location().position()\n</code></pre>\n<p>Now as you noticed, it shows you the position where the heading is placed before applying the show rule, and not the position of the <code>place</code>.</p>\n<p>I don’t know if that’s a bug or intended, maybe <a class=\"mention\" href=\"/u/pgbiel\">@PgBiel</a> can tell.</p>\n<p>But also, what are you trying to achieve? I’m pretty sure <code>show heading: it =&gt; place(...)</code> is not a good pattern. If you tell us what you want to do (title page?) maybe we can give you a better way to implement it.</p>",
      "raw": "First, note that `locate` deprecated. Instead use:\n```typ\n#context query(heading).first().location().position()\n```\n\nNow as you noticed, it shows you the position where the heading is placed before applying the show rule, and not the position of the `place`.\n\nI don't know if that's a bug or intended, maybe @PgBiel can tell.\n\nBut also, what are you trying to achieve? I'm pretty sure `show heading: it => place(...)` is not a good pattern. If you tell us what you want to do (title page?) maybe we can give you a better way to implement it.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 38,
      "score": 17.6,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 218
    },
    {
      "id": 4942,
      "post_number": 3,
      "username": "PgBiel",
      "name": "",
      "created_at": "2024-11-01T02:48:39.661Z",
      "updated_at": "2024-11-01T02:48:39.661Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"jbirnick\" data-post=\"2\" data-topic=\"1459\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/jbirnick/48/193_2.png\" class=\"avatar\"> jbirnick:</div>\n<blockquote>\n<p>First, note that <code>locate</code> deprecated. Instead use:</p>\n</blockquote>\n</aside>\n<p>Actually, <code>locate(loc =&gt; ...)</code> (using locate as a means of obtaining the <em>current</em> location) is deprecated. Using <code>locate(selector)</code> to obtain the location of <em>something else</em> was added in Typst 0.11 together with <code>context</code> and is not deprecated, being encouraged if that is the purpose of the usage. <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<aside class=\"quote no-group\" data-username=\"jbirnick\" data-post=\"2\" data-topic=\"1459\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/jbirnick/48/193_2.png\" class=\"avatar\"> jbirnick:</div>\n<blockquote>\n<p>Now as you noticed, it shows you the position where the heading is placed before applying the show rule, and not the position of the <code>place</code>.</p>\n<p>I don’t know if that’s a bug or intended, maybe <a class=\"mention\" href=\"/u/pgbiel\">@PgBiel</a> can tell.</p>\n</blockquote>\n</aside>\n<p>I’m not sure, but either way it seems ambiguous. I’d recommend not using a show rule for this and using a query which unambiguously matches something inside <code>place</code>, e.g. by adding a label.</p>",
      "raw": "[quote=\"jbirnick, post:2, topic:1459\"]\nFirst, note that `locate` deprecated. Instead use:\n[/quote]\n\nActually, `locate(loc => ...)` (using locate as a means of obtaining the _current_ location) is deprecated. Using `locate(selector)` to obtain the location of _something else_ was added in Typst 0.11 together with `context` and is not deprecated, being encouraged if that is the purpose of the usage. :slight_smile:\n\n[quote=\"jbirnick, post:2, topic:1459\"]\nNow as you noticed, it shows you the position where the heading is placed before applying the show rule, and not the position of the `place`.\n\nI don’t know if that’s a bug or intended, maybe @PgBiel can tell.\n[/quote]\n\nI'm not sure, but either way it seems ambiguous. I'd recommend not using a show rule for this and using a query which unambiguously matches something inside `place`, e.g. by adding a label.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 33,
      "score": 41.6,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 4948,
      "post_number": 4,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2024-11-01T08:19:11.595Z",
      "updated_at": "2024-11-01T08:19:11.595Z",
      "cooked": "<p>This was the result of a few internal changes. It solves some problems and creates some new ones. <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"> For figures specifically, it ensures that the <a href=\"https://github.com/typst/typst/issues/4322\">figure numbering stays correct even within floats</a>, but at the same time it makes links to figures <a href=\"https://github.com/typst/typst/issues/4359\">not jump to their floating contents</a>. It’s a very tricky situation.</p>",
      "raw": "This was the result of a few internal changes. It solves some problems and creates some new ones. :slight_smile: For figures specifically, it ensures that the [figure numbering stays correct even within floats](https://github.com/typst/typst/issues/4322), but at the same time it makes links to figures [not jump to their floating contents](https://github.com/typst/typst/issues/4359). It's a very tricky situation.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 30,
      "score": 21.0,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    },
    {
      "id": 4990,
      "post_number": 5,
      "username": "sijo",
      "name": "",
      "created_at": "2024-11-01T10:58:30.672Z",
      "updated_at": "2024-11-01T10:58:30.672Z",
      "cooked": "<p>I see, thanks for the links. That looks tricky indeed.</p>\n<p><a class=\"mention\" href=\"/u/pgbiel\">@PgBiel</a> I had tried with a label without success:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show heading: it =&gt; place(top, float: true, [#it &lt;a&gt;])\n= Title\n#context query(&lt;a&gt;)\n</code></pre>\n<p>Here the query returns nothing for some reason (and I guess it might still give the wrong location if it did work). But it works when I replace <code>it</code> with <code>it.body</code>. I think that’ll do for my use case, I’ll just have to recreate the numbering manually.</p>",
      "raw": "I see, thanks for the links. That looks tricky indeed.\n\n@PgBiel I had tried with a label without success:\n\n```typ\n#show heading: it => place(top, float: true, [#it <a>])\n= Title\n#context query(<a>)\n```\n\nHere the query returns nothing for some reason (and I guess it might still give the wrong location if it did work). But it works when I replace `it` with `it.body`. I think that'll do for my use case, I'll just have to recreate the numbering manually.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 30,
      "score": 26.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 5017,
      "post_number": 6,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2024-11-01T19:00:53.894Z",
      "updated_at": "2024-11-01T19:00:53.894Z",
      "cooked": "<p>The <code>it</code> in this case was already visited by Typst (since you are in its show rule) and will not be considered further. That’s kind of a subtle edge case.</p>",
      "raw": "The `it` in this case was already visited by Typst (since you are in its show rule) and will not be considered further. That's kind of a subtle edge case.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 25,
      "score": 20.0,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    }
  ],
  "scraped_at": "2025-06-10T09:55:40.433701"
}