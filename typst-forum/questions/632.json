{
  "topic_metadata": {
    "id": 632,
    "title": "What is the best way to get the total number of pages in a document and insert in the document?",
    "slug": "what-is-the-best-way-to-get-the-total-number-of-pages-in-a-document-and-insert-in-the-document",
    "posts_count": 10,
    "created_at": "2024-09-24T07:38:10.063Z",
    "last_posted_at": "2024-09-24T10:34:59.362Z",
    "views": 606,
    "like_count": 11,
    "reply_count": 10,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 8,
    "accepted_answer_username": "Andrew",
    "tags": [
      "scripting",
      "context"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1254
  },
  "posts": [
    {
      "id": 2425,
      "post_number": 1,
      "username": "Bryn",
      "name": "Bryn Humberstone",
      "created_at": "2024-09-24T07:38:10.325Z",
      "updated_at": "2024-09-24T21:51:35.186Z",
      "cooked": "<p>I have an exam paper that I am typesetting in Typst, and I want the cover page to indicate the total number of pages (e.g. “This question and answer book contains 29 pages”).</p>\n<p>It took longer than I had hoped to get working syntax, and in the end I came up with the following:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">This question and answer book contains \n#context[#counter(page).final().at(0)] pages\n</code></pre>\n<p>Is this the best way to generate this text, or is there a more natural alternative which I am overlooking?</p>\n<p>Also, not that I understand the concept of context particularly, but the <a href=\"https://typst.app/docs/reference/context/\">documentation for Context</a> starts with</p>\n<blockquote>\n<p>Sometimes, we want to create content that reacts to its location in the document.</p>\n</blockquote>\n<p>But in this case, I would have assumed that the total number of pages in the document is not contingent on the location in the document. What am I missing here?</p>",
      "raw": "I have an exam paper that I am typesetting in Typst, and I want the cover page to indicate the total number of pages (e.g. \"This question and answer book contains 29 pages\").\n\nIt took longer than I had hoped to get working syntax, and in the end I came up with the following:\n\n```typ\nThis question and answer book contains \n#context[#counter(page).final().at(0)] pages\n```\n\nIs this the best way to generate this text, or is there a more natural alternative which I am overlooking?\n\nAlso, not that I understand the concept of context particularly, but the [documentation for Context](https://typst.app/docs/reference/context/) starts with\n\n> Sometimes, we want to create content that reacts to its location in the document.\n\nBut in this case, I would have assumed that the total number of pages in the document is not contingent on the location in the document. What am I missing here?",
      "reply_to_post_number": null,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 60,
      "score": 2827.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 389
    },
    {
      "id": 2427,
      "post_number": 3,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2024-09-24T07:55:16.915Z",
      "updated_at": "2024-09-24T08:16:03.124Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"quachpas\" data-post=\"5\" data-topic=\"632\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/q/662200/48.png\" class=\"avatar\"> quachpas:</div>\n<blockquote>\n<p>I think I might have misread, I am very sorry! I think <strong>your attempt is the best one</strong>, and what I gave should probably not be used, unless you need both first and final values.</p>\n</blockquote>\n</aside>\n<div class=\"spoiler\">\n<p>Hello Bryn,<br>\nYou can get the number of pages in the document using <code>display(both: true)</code>:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#context {\n  counter(page).display(\"1/1\", both: true)\n}\n</code></pre>\n<p>Getting your result is a matter of splitting the string</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#context [\nThis question and answer book contains\n#counter(page).display(\"1/1\", both: true).split(\"/\").at(-1)\npages\n]\n</code></pre>\n<p>The final call should be deprecated soon (I believe), so the best way is to use display, to which you can pass a numbering.</p>\n<p>See <a href=\"https://typst.app/docs/reference/introspection/counter/#definitions-display-both\"><code>counter(both: bool)</code></a>.</p>\n</div>",
      "raw": "[quote=\"quachpas, post:5, topic:632\"]\nI think I might have misread, I am very sorry! I think **your attempt is the best one**, and what I gave should probably not be used, unless you need both first and final values.\n[/quote]\n\n[spoiler]\nHello Bryn,\nYou can get the number of pages in the document using `display(both: true)`:\n```typ\n#context {\n  counter(page).display(\"1/1\", both: true)\n}\n```\n\nGetting your result is a matter of splitting the string\n```typ\n#context [\nThis question and answer book contains\n#counter(page).display(\"1/1\", both: true).split(\"/\").at(-1)\npages\n]\n```\nThe final call should be deprecated soon (I believe), so the best way is to use display, to which you can pass a numbering.\n\nSee [`counter(both: bool)`](https://typst.app/docs/reference/introspection/counter/#definitions-display-both).\n[/spoiler]",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 56,
      "score": 101.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 2428,
      "post_number": 4,
      "username": "Bryn",
      "name": "Bryn Humberstone",
      "created_at": "2024-09-24T08:12:08.554Z",
      "updated_at": "2024-09-24T08:13:53.874Z",
      "cooked": "<p>Oh dear, this seems even more obfuscated than my first attempt! Is your recommendation that I should create a larger string that also includes the current page number, which I then remove?</p>\n<p>I couldn’t see any reference to final() being deprecated but I’m hoping that the ability to “time travel” isn’t removed, as I also want to be able to “time travel” to the end of the document and know the total number of marks (which is stored in a counter).</p>",
      "raw": "Oh dear, this seems even more obfuscated than my first attempt! Is your recommendation that I should create a larger string that also includes the current page number, which I then remove?\n\nI couldn't see any reference to final() being deprecated but I'm hoping that the ability to \"time travel\" isn't removed, as I also want to be able to \"time travel\" to the end of the document and know the total number of marks (which is stored in a counter).",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 54,
      "score": 20.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 389
    },
    {
      "id": 2429,
      "post_number": 5,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2024-09-24T08:15:34.211Z",
      "updated_at": "2024-09-24T08:15:34.211Z",
      "cooked": "<p>I think I might have misread, I am very sorry! I think <strong>your attempt is the best one</strong>, and what I gave should probably not be used, unless you need both first and final values.</p>\n<p>The part I misread in the documentation was</p>\n<blockquote>\n<p>Compatibility: This argument only exists for compatibility with Typst 0.10 and lower and shouldn’t be used anymore.</p>\n</blockquote>\n<p>which referred only to the <code>location</code> argument of <code>final</code>, and not of final itself.</p>",
      "raw": "I think I might have misread, I am very sorry! I think **your attempt is the best one**, and what I gave should probably not be used, unless you need both first and final values.\n\nThe part I misread in the documentation was \n\n> Compatibility: This argument only exists for compatibility with Typst 0.10 and lower and shouldn't be used anymore.\n\nwhich referred only to the `location` argument of `final`, and not of final itself.",
      "reply_to_post_number": 4,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 2,
      "reads": 50,
      "score": 85.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 2431,
      "post_number": 6,
      "username": "Bryn",
      "name": "Bryn Humberstone",
      "created_at": "2024-09-24T08:21:54.871Z",
      "updated_at": "2024-09-24T08:21:54.871Z",
      "cooked": "<p>Yes, I also found that compatibility note confusing too but I concluded that it used to be required to pass the location but now it stands for the final location in the document.</p>\n<p>I must say, it still seems a bit over-the-top to have to put the context etc. in, just to get the final page number.</p>",
      "raw": "Yes, I also found that compatibility note confusing too but I concluded that it used to be required to pass the location but now it stands for the final location in the document.\n\nI must say, it still seems a bit over-the-top to have to put the context etc. in, just to get the final page number.",
      "reply_to_post_number": 5,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 51,
      "score": 15.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 389
    },
    {
      "id": 2438,
      "post_number": 7,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2024-09-24T08:48:51.568Z",
      "updated_at": "2024-09-24T08:48:51.568Z",
      "cooked": "<aside class=\"quote no-group quote-modified\" data-username=\"Bryn\" data-post=\"1\" data-topic=\"632\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/bryn/48/513_2.png\" class=\"avatar\"> Bryn:</div>\n<blockquote>\n<p>Also, not that I understand the concept of context particularly, but the <a href=\"https://typst.app/docs/reference/context/\">documentation for Context</a> starts with</p>\n<blockquote>\n<p>Sometimes, we want to create content that reacts to its location in the document.</p>\n</blockquote>\n<p>But in this case, I would have assumed that the total number of pages in the document is not contingent on the location in the document. What am I missing here?</p>\n</blockquote>\n</aside>\n<aside class=\"quote no-group\" data-username=\"Bryn\" data-post=\"6\" data-topic=\"632\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/bryn/48/513_2.png\" class=\"avatar\"> Bryn:</div>\n<blockquote>\n<p>I must say, it still seems a bit over-the-top to have to put the context etc.</p>\n</blockquote>\n</aside>\n<p>The value here is really not dependent on the <em>location</em>, but the documentation simplifies a bit here which is confusing in this particular instance.</p>\n<p>The final counter value depends on the document as a whole, so it can’t be evaluated immediately; only after the whole document was put together. <code>context</code> allows Typst to delay the execution, or even execute multiple times – imagine the counter was so big that it caused an extra page to appear in the document. In that case Typst evaluates the context again with the new value.</p>\n<p>Each expression in Typst needs some definitive value, and if <code>counter.final()</code> returned a number <em>without</em> context, that would not work out.</p>",
      "raw": "[quote=\"Bryn, post:1, topic:632\"]\nAlso, not that I understand the concept of context particularly, but the [documentation for Context](https://typst.app/docs/reference/context/) starts with\n\n> Sometimes, we want to create content that reacts to its location in the document.\n\nBut in this case, I would have assumed that the total number of pages in the document is not contingent on the location in the document. What am I missing here?\n[/quote]\n\n[quote=\"Bryn, post:6, topic:632\"]\nI must say, it still seems a bit over-the-top to have to put the context etc.\n[/quote]\n\nThe value here is really not dependent on the _location_, but the documentation simplifies a bit here which is confusing in this particular instance.\n\nThe final counter value depends on the document as a whole, so it can't be evaluated immediately; only after the whole document was put together. `context` allows Typst to delay the execution, or even execute multiple times -- imagine the counter was so big that it caused an extra page to appear in the document. In that case Typst evaluates the context again with the new value.\n\nEach expression in Typst needs some definitive value, and if `counter.final()` returned a number _without_ context, that would not work out.",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 2,
      "like_count": 1,
      "reads": 49,
      "score": 64.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 2439,
      "post_number": 8,
      "username": "Andrew",
      "name": "",
      "created_at": "2024-09-24T08:54:40.177Z",
      "updated_at": "2024-09-24T08:54:40.177Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Bryn\" data-post=\"1\" data-topic=\"632\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/bryn/48/513_2.png\" class=\"avatar\"> Bryn:</div>\n<blockquote>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">This question and answer book contains \n#context[#counter(page).final().at(0)] pages\n</code></pre>\n<p>Is this the best way to generate this text, or is there a more natural alternative which I am overlooking?</p>\n</blockquote>\n</aside>\n<p>Yes, but you can optimize/simplify it like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#context counter(page).final().first()\n</code></pre>\n<aside class=\"quote no-group quote-modified\" data-username=\"Bryn\" data-post=\"1\" data-topic=\"632\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/bryn/48/513_2.png\" class=\"avatar\"> Bryn:</div>\n<blockquote>\n<p>Also, not that I understand the concept of context particularly, but the <a href=\"https://typst.app/docs/reference/context/\">documentation for Context</a> starts with</p>\n<blockquote>\n<p>Sometimes, we want to create content that reacts to its location in the document.</p>\n</blockquote>\n<p>But in this case, I would have assumed that the total number of pages in the document is not contingent on the location in the document. What am I missing here?</p>\n</blockquote>\n</aside>\n<p>The key part here is “sometimes”. This does not apply to your example, but does for this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#context here().position()\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/1X/7c5ae821a4be5b00bc8876e0f9c93d3e2bb49e92.png\" alt=\"image\" data-base62-sha1=\"hK5YkTy0JLUEwHjlImdYlwtYNrk\" width=\"227\" height=\"25\"></p>",
      "raw": "[quote=\"Bryn, post:1, topic:632\"]\n```typ\nThis question and answer book contains \n#context[#counter(page).final().at(0)] pages\n```\n\nIs this the best way to generate this text, or is there a more natural alternative which I am overlooking?\n[/quote]\n\nYes, but you can optimize/simplify it like this:\n\n```typ\n#context counter(page).final().first()\n```\n\n[quote=\"Bryn, post:1, topic:632\"]\nAlso, not that I understand the concept of context particularly, but the [documentation for Context](https://typst.app/docs/reference/context/) starts with\n\n> Sometimes, we want to create content that reacts to its location in the document.\n\nBut in this case, I would have assumed that the total number of pages in the document is not contingent on the location in the document. What am I missing here?\n[/quote]\n\nThe key part here is \"sometimes\". This does not apply to your example, but does for this:\n\n```typ\n#context here().position()\n```\n\n![image|227x25](upload://hK5YkTy0JLUEwHjlImdYlwtYNrk.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 48,
      "score": 134.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 2444,
      "post_number": 9,
      "username": "Bryn",
      "name": "Bryn Humberstone",
      "created_at": "2024-09-24T10:25:51.032Z",
      "updated_at": "2024-09-24T10:25:51.032Z",
      "cooked": "<p>That makes good sense, thanks! I hadn’t thought about the fact that not only can Typst not calculate it yet but it needs to find a fixed point if it’s a rather large document (or I print the page number in such a large font) and the printing of the final page number causes the page count to increase. Maybe I should think of <a class=\"hashtag-cooked\" href=\"/tag/context\" data-type=\"tag\" data-slug=\"context\" data-id=\"61\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>context</span></a> as for the type of thing that would require a second run of a LaTeX compiler, if I were typesetting the document in LaTeX.</p>",
      "raw": "That makes good sense, thanks! I hadn't thought about the fact that not only can Typst not calculate it yet but it needs to find a fixed point if it's a rather large document (or I print the page number in such a large font) and the printing of the final page number causes the page count to increase. Maybe I should think of #context as for the type of thing that would require a second run of a LaTeX compiler, if I were typesetting the document in LaTeX.",
      "reply_to_post_number": 7,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 39,
      "score": 22.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 389
    },
    {
      "id": 2448,
      "post_number": 10,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2024-09-24T10:33:41.377Z",
      "updated_at": "2024-09-24T10:33:41.377Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Bryn\" data-post=\"9\" data-topic=\"632\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/bryn/48/513_2.png\" class=\"avatar\"> Bryn:</div>\n<blockquote>\n<p>Maybe I should think of <a class=\"hashtag-cooked\" href=\"/tag/context\" data-type=\"tag\" data-slug=\"context\" data-id=\"61\" data-ref=\"context::tag\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>context</span></a> as for the type of thing that would require a second run of a LaTeX compiler, if I were typesetting the document in LaTeX.</p>\n</blockquote>\n</aside>\n<p>I think that’s a pretty good mental model. It also gives a feeling for the dreaded “layout did not converge within 5 attempts” warning: that’s how often Typst will try to recompile before giving up.</p>\n<p>btw, don’t forget to tick one of the responses if you got a satisfying answer. The answer you choose should usually be the response that you found most correct/helpful/comprehensive for the question you asked.</p>",
      "raw": "[quote=\"Bryn, post:9, topic:632\"]\nMaybe I should think of #context::tag as for the type of thing that would require a second run of a LaTeX compiler, if I were typesetting the document in LaTeX.\n[/quote]\n\nI think that's a pretty good mental model. It also gives a feeling for the dreaded \"layout did not converge within 5 attempts\" warning: that's how often Typst will try to recompile before giving up.\n\nbtw, don't forget to tick one of the responses if you got a satisfying answer. The answer you choose should usually be the response that you found most correct/helpful/comprehensive for the question you asked.",
      "reply_to_post_number": 9,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 2,
      "reads": 38,
      "score": 42.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 2449,
      "post_number": 11,
      "username": "Andrew",
      "name": "",
      "created_at": "2024-09-24T10:34:59.362Z",
      "updated_at": "2024-09-24T10:34:59.362Z",
      "cooked": "<p>Typst indeed uses the same tactic as LaTeX, but the difference is that with LaTeX you have to manually re-run the compiler, while Typst does this automatically. And if something needs more than 2 compilations to converge, it provides 5 attempts for such documents.</p>\n<p>From <a href=\"https://typst.app/docs/reference/context/#compiler-iterations\" class=\"inline-onebox\">Context – Typst Documentation</a> :</p>\n<blockquote>\n<p>To resolve contextual interactions, the Typst compiler processes your document multiple times. For instance, to resolve a <code>locate</code> call, Typst first provides a placeholder position, layouts your document and then recompiles with the known position from the finished layout. The same approach is taken to resolve counters, states, and queries. In certain cases, Typst may even need more than two iterations to resolve everything. While that’s sometimes a necessity, it may also be a sign of misuse of contextual functions (e.g. of <a href=\"https://typst.app/docs/reference/introspection/state/#caution\">state</a>). <strong>If Typst cannot resolve everything within five attempts</strong>, it will stop and output the warning “layout did not converge within 5 attempts.”</p>\n</blockquote>",
      "raw": "Typst indeed uses the same tactic as LaTeX, but the difference is that with LaTeX you have to manually re-run the compiler, while Typst does this automatically. And if something needs more than 2 compilations to converge, it provides 5 attempts for such documents.\n\nFrom https://typst.app/docs/reference/context/#compiler-iterations :\n\n> To resolve contextual interactions, the Typst compiler processes your document multiple times. For instance, to resolve a `locate` call, Typst first provides a placeholder position, layouts your document and then recompiles with the known position from the finished layout. The same approach is taken to resolve counters, states, and queries. In certain cases, Typst may even need more than two iterations to resolve everything. While that's sometimes a necessity, it may also be a sign of misuse of contextual functions (e.g. of [state](https://typst.app/docs/reference/introspection/state/#caution)). **If Typst cannot resolve everything within five attempts**, it will stop and output the warning \"layout did not converge within 5 attempts.\"",
      "reply_to_post_number": 9,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 17.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:58:14.235441"
}