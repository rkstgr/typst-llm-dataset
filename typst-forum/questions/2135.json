{
  "topic_metadata": {
    "id": 2135,
    "title": "How to ensure headings in passed content don't affect outline or PDF bookmarks?",
    "slug": "how-to-ensure-headings-in-passed-content-dont-affect-outline-or-pdf-bookmarks",
    "posts_count": 4,
    "created_at": "2024-12-18T14:12:09.123Z",
    "last_posted_at": "2024-12-20T00:11:16.084Z",
    "views": 174,
    "like_count": 3,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "sijo",
    "tags": [
      "scripting",
      "layout"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 845
  },
  "posts": [
    {
      "id": 6737,
      "post_number": 1,
      "username": "Fevol",
      "name": "Fevol",
      "created_at": "2024-12-18T14:12:09.271Z",
      "updated_at": "2024-12-20T00:10:11.358Z",
      "cooked": "<p>I have the following minimal example:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let exclude-heading(content) = context {\n  set heading(outlined: false, bookmarked: false)\n  let original_nr = counter(heading).get()\n  {\n    show heading: it =&gt; {\n      it.numbering + [ ] + it.body + linebreak()\n    }\n    content\n  }\n  counter(heading).update(original_nr)\n}\n\n#set heading(numbering: \"1.\")\n#outline(indent: 16pt)\n\n= Donkey\n== Dog\n#exclude-heading[\n  = Lorem Stone\n  #lorem(5)\n]\n=== Cat\n#exclude-heading[\n  = Epsum lorem\n  == Lorem Epsum\n  #lorem(5)\n]\n\n= Donkey\n== Dog\n=== Cat\n</code></pre>\n<p>I am trying to include a bunch of documents (represented by the <code>exclude-heading</code> here), but I do not want any of the headings of these documents to actually be outlined <em>or</em> bookmarked. For all intends and purposes, they should be just be seen as regular text (the style should stay identical, though!).</p>\n<p>I <em>sort</em> of managed to bodge my way around this by resetting the counter and adding a show rule. This fixes the outline numbering and displaying (numberings are broken but the numberings don’t matter for me luckily).</p>\n<p>However, the bookmarks <em>are</em> incorrect, I am expecting a bookmark structure in the form of:</p>\n<ul>\n<li>Donkey\n<ul>\n<li>Dog\n<ul>\n<li>Cat</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<p>But instead I am getting:</p>\n<ul>\n<li>Donkey\n<ul>\n<li>Dog</li>\n</ul>\n</li>\n<li>Cat</li>\n</ul>\n<p>This is probably due to the fact that <code>Cat</code> is internally still counted as <code>2.1.1</code>, and not <code>1.1.1</code>; even if the outline properly reflects the count.</p>\n<p>Is there anything I can do to bypass this issue? Is this a bug (specifically, the bookmark and outline counters not matching)?</p>\n<p>See the picture below for the output of the code and the mismatched bookmarks (to be clear, this is not a PDF reader issue, as it gives the same output on Chrome/Firefox)<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/7/7d602acf3d756db930bea21a4e405345f97590a4.png\" data-download-href=\"https://forum.typst.app/uploads/default/7d602acf3d756db930bea21a4e405345f97590a4\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/7/7d602acf3d756db930bea21a4e405345f97590a4_2_690x405.png\" alt=\"image\" data-base62-sha1=\"hT7II2DoqgjnYizWzVER9IsSzQM\" width=\"690\" height=\"405\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/7/7d602acf3d756db930bea21a4e405345f97590a4_2_690x405.png, https://forum.typst.app/uploads/default/optimized/2X/7/7d602acf3d756db930bea21a4e405345f97590a4_2_1035x607.png 1.5x, https://forum.typst.app/uploads/default/original/2X/7/7d602acf3d756db930bea21a4e405345f97590a4.png 2x\" data-dominant-color=\"D6D4D7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">1130×664 59 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>My best guess is that this issue is also related to <a href=\"https://github.com/typst/typst/issues/2416\" rel=\"noopener nofollow ugc\">https://github.com/typst/typst/issues/2416</a></p>",
      "raw": "I have the following minimal example:\n```typ\n#let exclude-heading(content) = context {\n  set heading(outlined: false, bookmarked: false)\n  let original_nr = counter(heading).get()\n  {\n    show heading: it => {\n      it.numbering + [ ] + it.body + linebreak()\n    }\n    content\n  }\n  counter(heading).update(original_nr)\n}\n\n#set heading(numbering: \"1.\")\n#outline(indent: 16pt)\n\n= Donkey\n== Dog\n#exclude-heading[\n  = Lorem Stone\n  #lorem(5)\n]\n=== Cat\n#exclude-heading[\n  = Epsum lorem\n  == Lorem Epsum\n  #lorem(5)\n]\n\n= Donkey\n== Dog\n=== Cat\n```\n\nI am trying to include a bunch of documents (represented by the `exclude-heading` here), but I do not want any of the headings of these documents to actually be outlined *or* bookmarked. For all intends and purposes, they should be just be seen as regular text (the style should stay identical, though!).\n\nI *sort* of managed to bodge my way around this by resetting the counter and adding a show rule. This fixes the outline numbering and displaying (numberings are broken but the numberings don't matter for me luckily).\n\nHowever, the bookmarks *are* incorrect, I am expecting a bookmark structure in the form of:\n- Donkey\n   - Dog\n      - Cat\n \nBut instead I am getting:\n- Donkey\n   - Dog\n- Cat\n\nThis is probably due to the fact that `Cat` is internally still counted as `2.1.1`, and not `1.1.1`; even if the outline properly reflects the count.\n\nIs there anything I can do to bypass this issue? Is this a bug (specifically, the bookmark and outline counters not matching)?\n\nSee the picture below for the output of the code and the mismatched bookmarks (to be clear, this is not a PDF reader issue, as it gives the same output on Chrome/Firefox)\n![image|690x405](upload://hT7II2DoqgjnYizWzVER9IsSzQM.png)\n\n\nMy best guess is that this issue is also related to <https://github.com/typst/typst/issues/2416>",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 46,
      "score": 489.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 22
    },
    {
      "id": 6738,
      "post_number": 2,
      "username": "sijo",
      "name": "",
      "created_at": "2024-12-18T16:03:00.507Z",
      "updated_at": "2024-12-18T16:03:00.507Z",
      "cooked": "<p>I don’t think it’s related to that issue. The problem is rather in the hierarchy of your headings: the level 3 section “Cat” is not under the level 2 section “Dog”, it’s under the level 1 section “Lorem Stone”. Excluding the heading from the outline doesn’t change that.</p>\n<p>A hack to work around this issue is to put these headings at a high level that you normally don’t use, for example with offset 10 (so headings will start at 11). Then we have to manually increase the text size to have levels 11 and 12 look like level 1 or 2.</p>\n<p>There’s also the problem that you update the state in the context block based on its own value. This triggers new iterations so if you use <code>exclude-heading</code> a few more times you will have a convergence failure.</p>\n<p>To avoid this issue, instead of states we can simply disable numbering for these special headings:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let exclude-heading(content) = context {\n  let n = heading.numbering\n  set heading(outlined: false, numbering: none, offset: 10)\n  show heading.where(level: 11): set text(1.4em)\n  show heading.where(level: 12): set text(1.2em)\n  show heading: it =&gt; {\n    n + [ ] + it.body + linebreak()\n  }\n  content\n}\n</code></pre>\n<p>This shows the actual <code>numbering</code> value (always 1) as in your example. I don’t know if that’s actually what you want.</p>",
      "raw": "I don't think it's related to that issue. The problem is rather in the hierarchy of your headings: the level 3 section \"Cat\" is not under the level 2 section \"Dog\", it's under the level 1 section \"Lorem Stone\". Excluding the heading from the outline doesn't change that.\n\nA hack to work around this issue is to put these headings at a high level that you normally don't use, for example with offset 10 (so headings will start at 11). Then we have to manually increase the text size to have levels 11 and 12 look like level 1 or 2.\n\nThere's also the problem that you update the state in the context block based on its own value. This triggers new iterations so if you use `exclude-heading` a few more times you will have a convergence failure.\n\nTo avoid this issue, instead of states we can simply disable numbering for these special headings:\n\n```typ\n#let exclude-heading(content) = context {\n  let n = heading.numbering\n  set heading(outlined: false, numbering: none, offset: 10)\n  show heading.where(level: 11): set text(1.4em)\n  show heading.where(level: 12): set text(1.2em)\n  show heading: it => {\n    n + [ ] + it.body + linebreak()\n  }\n  content\n}\n```\n\nThis shows the actual `numbering` value (always 1) as in your example. I don't know if that's actually what you want.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 39,
      "score": 32.8,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 6785,
      "post_number": 3,
      "username": "Fevol",
      "name": "Fevol",
      "created_at": "2024-12-19T18:07:27.671Z",
      "updated_at": "2024-12-19T22:20:34.847Z",
      "cooked": "<p>Sorry for the late reply, thank you very much for your answer!<br>\nI was indeed mistaken to refer to that issue, I think I got tripped up by the fact that the bookmark of <code>Cat</code> is level one (and not three), so I assumed it has something to do with counters.</p>\n<blockquote>\n<p>A hack to work around this issue is to put these headings at a high level that you normally don’t use, for example with offset 10 (so headings will start at 11). Then we have to manually increase the text size to have levels 11 and 12 look like level 1 or 2.</p>\n</blockquote>\n<p>This is a fantastic &amp; elegant solution, and does minimally conflicts with the content I’m trying to handle.</p>\n<blockquote>\n<p>There’s also the problem that you update the state in the context block based on its own value. This triggers new iterations so if you use <code>exclude-heading</code> a few more times you will have a convergence failure.</p>\n</blockquote>\n<p>Thanks for bringing that up! I’ll need to brush up on state/counter management (again).</p>\n<blockquote>\n<p>This shows the actual numbering value (always 1) as in your example. I don’t know if that’s actually what you want.</p>\n</blockquote>\n<p>Yeah, that is not entirely what I wanted, but I managed to find a fix quickly enough by reconstructing the numbering (see below).</p>\n<pre><code class=\"lang-auto\">set heading(outlined: false, numbering: none, offset: 10)\nshow heading.where(level: 11): set text(1.4em)\nshow heading.where(level: 12): set text(1.2em)\nshow heading: it =&gt; {\n  if it.numbering != none { numbering(\"1.\", ..counter(heading).get().slice(10)) } + [ ] + it.body + linebreak()\n}\n</code></pre>\n<p>Thank you again for your solution! I appreciate it!</p>",
      "raw": "Sorry for the late reply, thank you very much for your answer!\nI was indeed mistaken to refer to that issue, I think I got tripped up by the fact that the bookmark of `Cat` is level one (and not three), so I assumed it has something to do with counters. \n\n> A hack to work around this issue is to put these headings at a high level that you normally don’t use, for example with offset 10 (so headings will start at 11). Then we have to manually increase the text size to have levels 11 and 12 look like level 1 or 2.\n\nThis is a fantastic & elegant solution, and does minimally conflicts with the content I'm trying to handle.\n\n> There’s also the problem that you update the state in the context block based on its own value. This triggers new iterations so if you use `exclude-heading` a few more times you will have a convergence failure.\n\nThanks for bringing that up! I'll need to brush up on state/counter management (again).\n\n> This shows the actual numbering value (always 1) as in your example. I don’t know if that’s actually what you want.\n\nYeah, that is not entirely what I wanted, but I managed to find a fix quickly enough by reconstructing the numbering (see below).\n\n```\nset heading(outlined: false, numbering: none, offset: 10)\nshow heading.where(level: 11): set text(1.4em)\nshow heading.where(level: 12): set text(1.2em)\nshow heading: it => {\n  if it.numbering != none { numbering(\"1.\", ..counter(heading).get().slice(10)) } + [ ] + it.body + linebreak()\n}\n```\n\nThank you again for your solution! I appreciate it!",
      "reply_to_post_number": 2,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 32,
      "score": 31.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 22
    },
    {
      "id": 6791,
      "post_number": 4,
      "username": "PgBiel",
      "name": "",
      "created_at": "2024-12-20T00:11:16.084Z",
      "updated_at": "2024-12-20T00:11:16.084Z",
      "cooked": "<p>Hey <a class=\"mention\" href=\"/u/fevol\">@Fevol</a>, glad you got an answer! I’ve changed your question post’s title to better fit our guidelines: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></p>\n<p>For future posts, please make sure your title is a question you’d ask to a friend about Typst. <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hey @Fevol, glad you got an answer! I’ve changed your question post’s title to better fit our guidelines: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n\nFor future posts, please make sure your title is a question you’d ask to a friend about Typst. :wink:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 25,
      "score": 30.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    }
  ],
  "scraped_at": "2025-06-10T09:53:32.379839"
}