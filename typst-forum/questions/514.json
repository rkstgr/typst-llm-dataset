{
  "topic_metadata": {
    "id": 514,
    "title": "How do I draw a box behind text?",
    "slug": "how-do-i-draw-a-box-behind-text",
    "posts_count": 5,
    "created_at": "2024-09-20T04:34:13.442Z",
    "last_posted_at": "2024-09-20T13:38:55.416Z",
    "views": 407,
    "like_count": 5,
    "reply_count": 3,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 5,
    "accepted_answer_username": "Tinger",
    "tags": [
      "scripting",
      "text-formatting"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 541
  },
  "posts": [
    {
      "id": 1998,
      "post_number": 1,
      "username": "jkwchui",
      "name": "Jon Chui",
      "created_at": "2024-09-20T04:34:13.593Z",
      "updated_at": "2024-09-20T05:33:24.684Z",
      "cooked": "<p>I am looking to annotate text with a color-box behind it, with an effect like this:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/1X/0381760dee348aa2bd3d25e5acdd2fb8b9baa29c.png\" data-download-href=\"https://forum.typst.app/uploads/default/0381760dee348aa2bd3d25e5acdd2fb8b9baa29c\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/0381760dee348aa2bd3d25e5acdd2fb8b9baa29c_2_690x103.png\" alt=\"image\" data-base62-sha1=\"v0NHwIKW7FfcT4Des8eyvLGPeI\" width=\"690\" height=\"103\" srcset=\"https://forum.typst.app/uploads/default/optimized/1X/0381760dee348aa2bd3d25e5acdd2fb8b9baa29c_2_690x103.png, https://forum.typst.app/uploads/default/optimized/1X/0381760dee348aa2bd3d25e5acdd2fb8b9baa29c_2_1035x154.png 1.5x, https://forum.typst.app/uploads/default/optimized/1X/0381760dee348aa2bd3d25e5acdd2fb8b9baa29c_2_1380x206.png 2x\" data-dominant-color=\"E8EAE7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">2004×300 80 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>The above was achieved with a macro of</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let part(content, angle: 0deg, content_color: black) = {\n  box(\n    radius: 0.1em, \n    stroke: (2pt + oklch(40%, 0.2, angle, 100%)), \n    fill: oklch(95%, 0.05, angle, 80%), \n    inset: (x: 0.3em, y: 0.3em),\n  )[#text(content_color)[#content]]\n}\n</code></pre>\n<p>This doesn’t quite do the job, however, because it’s actually a sequence of boxes being drawn at the baseline, and the content floating inside it.  These do not compose with plain-text:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/1X/3553f30b353077e4347fabc09646cd870e005042.png\" data-download-href=\"https://forum.typst.app/uploads/default/3553f30b353077e4347fabc09646cd870e005042\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/3553f30b353077e4347fabc09646cd870e005042_2_690x88.png\" alt=\"image\" data-base62-sha1=\"7BLakGzvltTcig0NHRG1g808pHQ\" width=\"690\" height=\"88\" srcset=\"https://forum.typst.app/uploads/default/optimized/1X/3553f30b353077e4347fabc09646cd870e005042_2_690x88.png, https://forum.typst.app/uploads/default/optimized/1X/3553f30b353077e4347fabc09646cd870e005042_2_1035x132.png 1.5x, https://forum.typst.app/uploads/default/optimized/1X/3553f30b353077e4347fabc09646cd870e005042_2_1380x176.png 2x\" data-dominant-color=\"EBEAE9\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">2328×300 103 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#part([我], angle: 20deg) #part([喺], angle: 80deg) 鄰近 #part([公園], angle: 310deg) #part([見到], angle: 120deg) #part([媽媽], angle: 220deg)\n</code></pre>\n<p>Is there an idiomatic Typst way to keep the text as first-class citizen, and draw the box behind it?</p>",
      "raw": "I am looking to annotate text with a color-box behind it, with an effect like this:\n\n![image|690x103](upload://v0NHwIKW7FfcT4Des8eyvLGPeI.png)\n\nThe above was achieved with a macro of\n\n```typst\n#let part(content, angle: 0deg, content_color: black) = {\n  box(\n    radius: 0.1em, \n    stroke: (2pt + oklch(40%, 0.2, angle, 100%)), \n    fill: oklch(95%, 0.05, angle, 80%), \n    inset: (x: 0.3em, y: 0.3em),\n  )[#text(content_color)[#content]]\n}\n```\n\nThis doesn't quite do the job, however, because it's actually a sequence of boxes being drawn at the baseline, and the content floating inside it.  These do not compose with plain-text:\n\n![image|690x88](upload://7BLakGzvltTcig0NHRG1g808pHQ.png)\n\n```typst\n#part([我], angle: 20deg) #part([喺], angle: 80deg) 鄰近 #part([公園], angle: 310deg) #part([見到], angle: 120deg) #part([媽媽], angle: 220deg)\n```\n\nIs there an idiomatic Typst way to keep the text as first-class citizen, and draw the box behind it?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 56,
      "score": 1656.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 254
    },
    {
      "id": 1999,
      "post_number": 2,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2024-09-20T05:31:39.556Z",
      "updated_at": "2024-09-20T10:01:28.122Z",
      "cooked": "<p>I’m unfortunately not aware of a box variant/mode that does not affect the baseline in the way you need it. However, <code>box</code> lets you adjust the baseline so you can visually shift everything to where you need it. <s>With the exact code you posted, 22% looked right</s> <strong>EDIT</strong> since your inset is <code>0.3em</code>, that’s how much you need to adjust the baseline (thanks <a class=\"mention\" href=\"/u/eric\">@Eric</a>):</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(width: auto, height: auto, margin: 0.3cm)\n\n#let part(content, angle: 0deg, content_color: black) = {\n  box(\n    radius: 0.1em, \n    stroke: (2pt + oklch(40%, 0.2, angle, 100%)), \n    fill: oklch(95%, 0.05, angle, 80%), \n    inset: (x: 0.3em, y: 0.3em),\n    baseline: 0.3em,\n  )[#text(content_color)[#content]]\n}\n\n#part([我], angle: 20deg) #part([喺], angle: 80deg) #highlight[鄰近] #part(highlight[公園], angle: 310deg) #part([見到], angle: 120deg) #part([媽媽], angle: 220deg)\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/1X/3602388868d0749ae335be4af9968e7552b69aa6.png\" data-download-href=\"https://forum.typst.app/uploads/default/3602388868d0749ae335be4af9968e7552b69aa6\" title=\"baseline\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/3602388868d0749ae335be4af9968e7552b69aa6_2_690x128.png\" alt=\"baseline\" data-base62-sha1=\"7HMxzzRWJWf4wPAyCqQgtCchKGa\" width=\"690\" height=\"128\" srcset=\"https://forum.typst.app/uploads/default/optimized/1X/3602388868d0749ae335be4af9968e7552b69aa6_2_690x128.png, https://forum.typst.app/uploads/default/optimized/1X/3602388868d0749ae335be4af9968e7552b69aa6_2_1035x192.png 1.5x, https://forum.typst.app/uploads/default/optimized/1X/3602388868d0749ae335be4af9968e7552b69aa6_2_1380x256.png 2x\" data-dominant-color=\"D4CFC3\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">baseline</span><span class=\"informations\">1448×270 101 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>(The highlight is just for easier character alignment comparison.) You’ll have to adjust it to your case of course.</p>",
      "raw": "I'm unfortunately not aware of a box variant/mode that does not affect the baseline in the way you need it. However, `box` lets you adjust the baseline so you can visually shift everything to where you need it. ~~With the exact code you posted, 22% looked right~~ **EDIT** since your inset is `0.3em`, that's how much you need to adjust the baseline (thanks @Eric):\n```typ\n#set page(width: auto, height: auto, margin: 0.3cm)\n\n#let part(content, angle: 0deg, content_color: black) = {\n  box(\n    radius: 0.1em, \n    stroke: (2pt + oklch(40%, 0.2, angle, 100%)), \n    fill: oklch(95%, 0.05, angle, 80%), \n    inset: (x: 0.3em, y: 0.3em),\n    baseline: 0.3em,\n  )[#text(content_color)[#content]]\n}\n\n#part([我], angle: 20deg) #part([喺], angle: 80deg) #highlight[鄰近] #part(highlight[公園], angle: 310deg) #part([見到], angle: 120deg) #part([媽媽], angle: 220deg)\n```\n![baseline|690x128](upload://7HMxzzRWJWf4wPAyCqQgtCchKGa.png)\n\n(The highlight is just for easier character alignment comparison.) You'll have to adjust it to your case of course.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 54,
      "score": 30.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 2000,
      "post_number": 3,
      "username": "Eric",
      "name": "Eric Biedert",
      "created_at": "2024-09-20T06:25:13.794Z",
      "updated_at": "2024-09-20T06:25:13.794Z",
      "cooked": "<p>As in this case, the baseline difference is only due to to box’s bottom inset, you can as well just use the <code>0.3em</code> for the baseline instead of guessing the <code>22%</code>.</p>",
      "raw": "As in this case, the baseline difference is only due to to box's bottom inset, you can as well just use the `0.3em` for the baseline instead of guessing the `22%`.",
      "reply_to_post_number": 2,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 50,
      "score": 24.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 88
    },
    {
      "id": 2010,
      "post_number": 4,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2024-09-20T09:35:40.582Z",
      "updated_at": "2024-09-20T09:59:11.105Z",
      "cooked": "<p>I tried that but it didn’t look right to me. Maybe it was just the live preview in the web app though…</p>\n<p>Edit: I think it was just me, thanks for pointing this out <a class=\"mention\" href=\"/u/eric\">@Eric</a>!</p>",
      "raw": "I tried that but it didn't look right to me. Maybe it was just the live preview in the web app though...\n\nEdit: I think it was just me, thanks for pointing this out @Eric!",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 48,
      "score": 19.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 2025,
      "post_number": 5,
      "username": "Tinger",
      "name": "Tinger",
      "created_at": "2024-09-20T13:38:55.416Z",
      "updated_at": "2024-09-20T13:40:30.081Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Eric\" data-post=\"3\" data-topic=\"514\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/eric/48/87_2.png\" class=\"avatar\"> Eric:</div>\n<blockquote>\n<p>As in this case, the baseline difference is only due to to box’s bottom inset, you can as well just use the <code>0.3em</code> for the baseline instead of guessing the <code>22%</code>.</p>\n</blockquote>\n</aside>\n<p>I suggest simply using <code>outset </code> for the y-axis, this will leave the baseline unaffected:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let part(content, angle: 0deg, content_color: black) = {\n  box(\n    radius: 0.1em, \n    stroke: (2pt + oklch(40%, 0.2, angle, 100%)), \n    fill: oklch(95%, 0.05, angle, 80%), \n    inset: (x: 0.3em),\n    outset: (y: 0.3em),\n  )[#text(content_color)[#content]]\n}\n</code></pre>\n<p>x-inset + y-outset is the go-to style for inline raw in most of my documents and it served me pretty well.</p>\n<p>I think this also has the added benefit of not affecting line spacing, in case the baseline option does, I’m not 100% sure about that. But this also means for tight line spacing this will intersect with the other lines.</p>",
      "raw": "[quote=\"Eric, post:3, topic:514, full:true\"]\nAs in this case, the baseline difference is only due to to box’s bottom inset, you can as well just use the `0.3em` for the baseline instead of guessing the `22%`.\n[/quote]\n\nI suggest simply using `outset ` for the y-axis, this will leave the baseline unaffected:\n```typ\n#let part(content, angle: 0deg, content_color: black) = {\n  box(\n    radius: 0.1em, \n    stroke: (2pt + oklch(40%, 0.2, angle, 100%)), \n    fill: oklch(95%, 0.05, angle, 80%), \n    inset: (x: 0.3em),\n    outset: (y: 0.3em),\n  )[#text(content_color)[#content]]\n}\n```\n\nx-inset + y-outset is the go-to style for inline raw in most of my documents and it served me pretty well.\n\nI think this also has the added benefit of not affecting line spacing, in case the baseline option does, I'm not 100% sure about that. But this also means for tight line spacing this will intersect with the other lines.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 4,
      "reads": 47,
      "score": 159.2,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 29
    }
  ],
  "scraped_at": "2025-06-10T09:58:33.574680"
}