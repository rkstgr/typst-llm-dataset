{
  "topic_metadata": {
    "id": 1598,
    "title": "Why my set and show rules in might be ignored when using if condition? (scope issue)",
    "slug": "why-my-set-and-show-rules-in-might-be-ignored-when-using-if-condition-scope-issue",
    "posts_count": 4,
    "created_at": "2024-11-07T20:17:35.565Z",
    "last_posted_at": "2024-11-08T06:34:22.096Z",
    "views": 253,
    "like_count": 3,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "flokl",
    "tags": [
      "scripting",
      "text-formatting"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 461
  },
  "posts": [
    {
      "id": 5279,
      "post_number": 1,
      "username": "danborek",
      "name": "danborek",
      "created_at": "2024-11-07T20:17:35.734Z",
      "updated_at": "2024-11-10T15:41:02.328Z",
      "cooked": "<p>I  have a template which I need to use different code to achieve the same behaviour in different  versions</p>\n<p>here my bib file</p>\n<pre><code class=\"lang-auto\">@article{test2024,\n  title     = {Recent Advances in Something Important},\n  author    = {Test, John A. and Example, Jane B.},\n  journal   = {Journal of Important Things},\n  year      = {2024},\n  volume    = {42},\n  number    = {1},\n  pages     = {123--145},\n  publisher = {Academic Publishers}\n}\n\n@book{test1999,\n  title     = {Classic Book on Important Topics},\n  author    = {Test, Robert C.},\n  year      = {1999},\n  publisher = {Classic Publishing House},\n  address   = {New York},\n  edition   = {2nd}\n}\n</code></pre>\n<p>Code that should work</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let spacing = 0.65em\n\n#set page(\n  paper: \"a4\",\n  margin: (x: 2.5cm, y: 2.5cm),\n)\n\n#set heading(numbering: \"1.\")\n\n// Bibliography settings\n#set bibliography(\n  title: \"References\",\n  style: \"ieee\",\n)\n\n// Configure bibliography spacing based on Typst version\n#if sys.version &gt;= version(0, 12, 0) {\n  show bibliography: set par(spacing: spacing, leading: spacing)\n} else {\n  show bibliography: set block(spacing: spacing)\n}\n\n\n\n= Introduction\n\nThis is a sample document demonstrating bibliography settings in Typst. Here's a citation to a something @test2024 and another reference @test1999.\n\nSome more text here to show the spacing...\n\n= Conclusion\n\nThe bibliography will appear below with custom spacing and styling.\n\n// Define bibliography data in YAML format\n\n\n\n#bibliography(\"bibliography.bib\")\n\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/3/34e693cf36317b5e9a2ba1355e5eb85337936e5d.png\" data-download-href=\"https://forum.typst.app/uploads/default/34e693cf36317b5e9a2ba1355e5eb85337936e5d\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/3/34e693cf36317b5e9a2ba1355e5eb85337936e5d_2_690x147.png\" alt=\"image\" data-base62-sha1=\"7xYPY7YaDZwlovOD1LickHn2qcd\" width=\"690\" height=\"147\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/3/34e693cf36317b5e9a2ba1355e5eb85337936e5d_2_690x147.png, https://forum.typst.app/uploads/default/original/2X/3/34e693cf36317b5e9a2ba1355e5eb85337936e5d.png 1.5x, https://forum.typst.app/uploads/default/original/2X/3/34e693cf36317b5e9a2ba1355e5eb85337936e5d.png 2x\" data-dominant-color=\"F4F4F4\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">735×157 27 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>but it work only if I apply it directly outside of  <span class=\"hashtag-raw\">#if</span> -   is this issue  of scope of <code>#if</code>?</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show bibliography: set par(spacing: spacing, leading: spacing)\n\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/0/0a18594641db493960b80912d80f01faca476fe1.png\" data-download-href=\"https://forum.typst.app/uploads/default/0a18594641db493960b80912d80f01faca476fe1\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/0/0a18594641db493960b80912d80f01faca476fe1_2_690x152.png\" alt=\"image\" data-base62-sha1=\"1riWnz2IqbmOoupYJ8ZbIYI4SuB\" width=\"690\" height=\"152\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/0/0a18594641db493960b80912d80f01faca476fe1_2_690x152.png, https://forum.typst.app/uploads/default/original/2X/0/0a18594641db493960b80912d80f01faca476fe1.png 1.5x, https://forum.typst.app/uploads/default/original/2X/0/0a18594641db493960b80912d80f01faca476fe1.png 2x\" data-dominant-color=\"F3F3F3\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">715×158 26.7 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>I was able to solve similar problem with using if clause options, but I am not so sure anymore :(</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">  // Set space between paragraphs\n  if sys.version &gt;= version(0,12,0) {\n    set par(spacing: spacing)\n  } else {\n    show par: set block(spacing: spacing)\n  }\n\n</code></pre>",
      "raw": "I  have a template which I need to use different code to achieve the same behaviour in different  versions\n\nhere my bib file\n```\n@article{test2024,\n  title     = {Recent Advances in Something Important},\n  author    = {Test, John A. and Example, Jane B.},\n  journal   = {Journal of Important Things},\n  year      = {2024},\n  volume    = {42},\n  number    = {1},\n  pages     = {123--145},\n  publisher = {Academic Publishers}\n}\n\n@book{test1999,\n  title     = {Classic Book on Important Topics},\n  author    = {Test, Robert C.},\n  year      = {1999},\n  publisher = {Classic Publishing House},\n  address   = {New York},\n  edition   = {2nd}\n}\n``` \n\nCode that should work \n```typ\n#let spacing = 0.65em\n\n#set page(\n  paper: \"a4\",\n  margin: (x: 2.5cm, y: 2.5cm),\n)\n\n#set heading(numbering: \"1.\")\n\n// Bibliography settings\n#set bibliography(\n  title: \"References\",\n  style: \"ieee\",\n)\n\n// Configure bibliography spacing based on Typst version\n#if sys.version >= version(0, 12, 0) {\n  show bibliography: set par(spacing: spacing, leading: spacing)\n} else {\n  show bibliography: set block(spacing: spacing)\n}\n\n\n\n= Introduction\n\nThis is a sample document demonstrating bibliography settings in Typst. Here's a citation to a something @test2024 and another reference @test1999.\n\nSome more text here to show the spacing...\n\n= Conclusion\n\nThe bibliography will appear below with custom spacing and styling.\n\n// Define bibliography data in YAML format\n\n\n\n#bibliography(\"bibliography.bib\")\n\n```\n![image|690x147](upload://7xYPY7YaDZwlovOD1LickHn2qcd.png)\n\nbut it work only if I apply it directly outside of  #if -   is this issue  of scope of `#if`?\n```typ\n#show bibliography: set par(spacing: spacing, leading: spacing)\n\n```\n![image|690x152](upload://1riWnz2IqbmOoupYJ8ZbIYI4SuB.png)\n\nI was able to solve similar problem with using if clause options, but I am not so sure anymore :(  \n```typc\n  // Set space between paragraphs\n  if sys.version >= version(0,12,0) {\n    set par(spacing: spacing)\n  } else {\n    show par: set block(spacing: spacing)\n  }\n\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 32,
      "score": 981.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 410
    },
    {
      "id": 5283,
      "post_number": 2,
      "username": "flokl",
      "name": "",
      "created_at": "2024-11-07T21:48:53.812Z",
      "updated_at": "2024-11-08T06:34:55.521Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/danborek\">@danborek</a>,</p>\n<p>you are correct, it is a scope issue. Set and show rules are scoped and only apply inside the scope, in your case inside the <code>if</code>.</p>\n<p>You can avoid the scope issue by using <code>set-if</code> rules.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show bibliography: set par(spacing: spacing, leading: spacing) if sys.version &gt;= version(0, 12, 0)\n#show bibliography: set block(spacing: spacing) if sys.version &lt; version(0, 12, 0)\n</code></pre>\n<p>Or the other option would be this:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show bibliography: it =&gt; {\n  if sys.version &gt;= version(0, 12, 0) {\n    set par(spacing: spacing, leading: spacing)\n    it\n  } else {\n    set block(spacing: spacing)\n    it\n  }\n}\n</code></pre>",
      "raw": "Hi @danborek, \n\nyou are correct, it is a scope issue. Set and show rules are scoped and only apply inside the scope, in your case inside the `if`.\n\nYou can avoid the scope issue by using `set-if` rules.\n```typst\n#show bibliography: set par(spacing: spacing, leading: spacing) if sys.version >= version(0, 12, 0)\n#show bibliography: set block(spacing: spacing) if sys.version < version(0, 12, 0)\n```\nOr the other option would be this:\n```typst\n#show bibliography: it => {\n  if sys.version >= version(0, 12, 0) {\n    set par(spacing: spacing, leading: spacing)\n    it\n  } else {\n    set block(spacing: spacing)\n    it\n  }\n}\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 26,
      "score": 25.2,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 8
    },
    {
      "id": 5285,
      "post_number": 3,
      "username": "danborek",
      "name": "danborek",
      "created_at": "2024-11-07T23:11:26.756Z",
      "updated_at": "2024-11-07T23:12:35.982Z",
      "cooked": "<p>Thanks <span class=\"mention\">@floki</span>!</p>\n<blockquote>\n<p>not so nice option would be this:</p>\n</blockquote>\n<p>Is this rather esthetic preference  about code or is there something about  the  use of <code>it</code> in <code>typst</code> that I should be  careful over and not to overuse it?<br>\nAs I am doing mostly Python recently, my first idea would be to use 2nd pattern as this more reflect my thinking (in pseudocode)</p>",
      "raw": "Thanks @floki!\n\n> not so nice option would be this:\n\nIs this rather esthetic preference  about code or is there something about  the  use of `it` in `typst` that I should be  careful over and not to overuse it?\nAs I am doing mostly Python recently, my first idea would be to use 2nd pattern as this more reflect my thinking (in pseudocode)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 26,
      "score": 25.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 410
    },
    {
      "id": 5297,
      "post_number": 4,
      "username": "flokl",
      "name": "",
      "created_at": "2024-11-08T06:34:22.096Z",
      "updated_at": "2024-11-08T06:35:37.720Z",
      "cooked": "<p>I don’t know why I added “not so nice” to the answer, the first option is just my preference. I edited the answer to not confuse anyone else.</p>",
      "raw": "I don't know why I added \"not so nice\" to the answer, the first option is just my preference. I edited the answer to not confuse anyone else.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 23,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 8
    }
  ],
  "scraped_at": "2025-06-10T09:55:20.372396"
}