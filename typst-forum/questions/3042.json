{
  "topic_metadata": {
    "id": 3042,
    "title": "How to specify custom underline strokes based on default stroke thickness?",
    "slug": "how-to-specify-custom-underline-strokes-based-on-default-stroke-thickness",
    "posts_count": 9,
    "created_at": "2025-02-28T10:13:21.528Z",
    "last_posted_at": "2025-03-05T13:32:35.838Z",
    "views": 148,
    "like_count": 1,
    "reply_count": 6,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 6,
    "accepted_answer_username": "aarnent",
    "tags": [
      "scripting",
      "styling"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 893
  },
  "posts": [
    {
      "id": 9159,
      "post_number": 1,
      "username": "wisperwind",
      "name": "",
      "created_at": "2025-02-28T10:13:21.648Z",
      "updated_at": "2025-03-03T15:43:49.786Z",
      "cooked": "<p>The <code>underline()</code> function uses a stroke thickness that is based on the font by default, e.g.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#underline(stroke: \"loosely-dotted\")[#lorem(10)]\n</code></pre>\n<p>I can define a custom stroke like so:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#underline(stroke: stroke(dash: (1pt, 2pt)))[#lorem(10)]\n</code></pre>\n<p>But there is no obvious way to define a custom stroke that also uses the font-derived thickness, i.e. something along the lines of</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#underline(\n  stroke: stroke(\n    dash: (default-thickness, 0.7 * default-thickness),\n  ),\n)[#lorem(10)]\n</code></pre>\n<p>Is there any existing method to achieve this? Or would this rather be a feature request?</p>",
      "raw": "The `underline()` function uses a stroke thickness that is based on the font by default, e.g.\n\n```typst\n#underline(stroke: \"loosely-dotted\")[#lorem(10)]\n```\n\nI can define a custom stroke like so:\n```typst\n#underline(stroke: stroke(dash: (1pt, 2pt)))[#lorem(10)]\n```\n\nBut there is no obvious way to define a custom stroke that also uses the font-derived thickness, i.e. something along the lines of\n\n```typst\n#underline(\n  stroke: stroke(\n    dash: (default-thickness, 0.7 * default-thickness),\n  ),\n)[#lorem(10)]\n```\n\nIs there any existing method to achieve this? Or would this rather be a feature request?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 37,
      "score": 467.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 750
    },
    {
      "id": 9183,
      "post_number": 2,
      "username": "aarnent",
      "name": "",
      "created_at": "2025-02-28T11:22:29.263Z",
      "updated_at": "2025-02-28T11:22:29.263Z",
      "cooked": "<p>I’m unsure what you mean by “thickness”, but if you want to make the spacing be relative to the current font size you should use <a href=\"https://typst.app/docs/reference/layout/length/\">“em” length units</a> instead of “pt”.</p>\n<p>So something like</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#underline(stroke: stroke(\n  thickness: 0.1em,\n  dash: (1em, 0.7em)\n),)[#lorem(10)]\n</code></pre>\n<p>If you mean relative to font weight instead of font size, it’d probably be easiest to  do with a <a href=\"https://typst.app/docs/reference/context/\">context</a> expression</p>",
      "raw": "I'm unsure what you mean by \"thickness\", but if you want to make the spacing be relative to the current font size you should use [\"em\" length units](https://typst.app/docs/reference/layout/length/) instead of \"pt\".\n\nSo something like\n```typst\n#underline(stroke: stroke(\n  thickness: 0.1em,\n  dash: (1em, 0.7em)\n),)[#lorem(10)]\n```\n\nIf you mean relative to font weight instead of font size, it'd probably be easiest to  do with a [context](https://typst.app/docs/reference/context/) expression",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 36,
      "score": 12.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 501
    },
    {
      "id": 9184,
      "post_number": 3,
      "username": "wisperwind",
      "name": "",
      "created_at": "2025-02-28T11:39:16.838Z",
      "updated_at": "2025-02-28T11:39:16.838Z",
      "cooked": "<p>What I refer to by thickness is really just that: The default value for <a href=\"https://typst.app/docs/reference/visualize/stroke/#constructor-thickness\"><code>stroke.thickness</code></a> that <a href=\"https://github.com/typst/typst/blob/cfb3b1a2709107f0f06f89ea25cabc939cec15e5/crates/typst-library/src/visualize/stroke.rs#L504\" rel=\"noopener nofollow ugc\">Typst will choose</a> when using, say, <code>stroke(dash: \"loosely-dotted\")</code>.</p>\n<p>So, in other words, what I’m asking is the default value for <code>stroke.thickness</code> in the context of an <code>underline</code>. Maybe, that’s just a documentation issue (if it turns out to be something like <code>0.1em</code> as you suggest). But if it’s somehow derived differently from other font metrics, I’d be curious if and how the default value can be obtained in code.</p>",
      "raw": "What I refer to by thickness is really just that: The default value for [`stroke.thickness`](https://typst.app/docs/reference/visualize/stroke/#constructor-thickness) that [Typst will choose](https://github.com/typst/typst/blob/cfb3b1a2709107f0f06f89ea25cabc939cec15e5/crates/typst-library/src/visualize/stroke.rs#L504) when using, say, `stroke(dash: \"loosely-dotted\")`.\n\nSo, in other words, what I'm asking is the default value for `stroke.thickness` in the context of an `underline`. Maybe, that's just a documentation issue (if it turns out to be something like `0.1em` as you suggest). But if it's somehow derived differently from other font metrics, I'd be curious if and how the default value can be obtained in code.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 33,
      "score": 11.6,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 750
    },
    {
      "id": 9186,
      "post_number": 4,
      "username": "aarnent",
      "name": "",
      "created_at": "2025-02-28T12:02:54.507Z",
      "updated_at": "2025-02-28T12:02:54.507Z",
      "cooked": "<p>Your second link points to the definition of the dash pattern, which doesn’t adjust the thickness. All it does is adjust the length and spacing of the underlined dashes.</p>\n<p>From the first link, it states that the thickness is derived as follows: “If set to <code>auto</code>, the value is inherited, defaulting to <code>1pt</code>.”</p>",
      "raw": "Your second link points to the definition of the dash pattern, which doesn't adjust the thickness. All it does is adjust the length and spacing of the underlined dashes.\n\nFrom the first link, it states that the thickness is derived as follows: \"If set to `auto`, the value is inherited, defaulting to `1pt`.\"",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 11.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 501
    },
    {
      "id": 9187,
      "post_number": 5,
      "username": "wisperwind",
      "name": "",
      "created_at": "2025-02-28T12:12:49.519Z",
      "updated_at": "2025-02-28T12:12:49.519Z",
      "cooked": "<p>Sorry, it seems that I haven’t described sufficiently precise what my goal is:</p>\n<p>For underlines, the default is different, namely <a href=\"https://typst.app/docs/reference/text/underline/#parameters-stroke\">it is based on the font</a>, not simply 1pt. This becomes obvious when changing font size: The line thickness will scale as well in this situation.</p>\n<p>You’re right that the dash pattern is in principle independent of stroke thickness. However, as the link to the Typst source code shows, it is in fact based on the thickness for dotted patterns (by setting dash length = thickness to obtain dots).</p>\n<p>What I want to achieve is</p>\n<ul>\n<li>keep the default thickness of the underline, which depends on the font in some undocumented way</li>\n<li>have a dash pattern with dots, i.e. set the first element of the pattern array to the same value as the thickness</li>\n<li>adjust the dot spacing, i.e. the second value of the pattern array, to be different from both the <code>dotted</code>, <code>loosely-dotted</code> and <code>densely-dotted</code> defaults (because I don’t like their looks)</li>\n</ul>",
      "raw": "Sorry, it seems that I haven't described sufficiently precise what my goal is:\n\nFor underlines, the default is different, namely [it is based on the font](https://typst.app/docs/reference/text/underline/#parameters-stroke), not simply 1pt. This becomes obvious when changing font size: The line thickness will scale as well in this situation.\n\nYou're right that the dash pattern is in principle independent of stroke thickness. However, as the link to the Typst source code shows, it is in fact based on the thickness for dotted patterns (by setting dash length = thickness to obtain dots).\n\nWhat I want to achieve is\n- keep the default thickness of the underline, which depends on the font in some undocumented way\n- have a dash pattern with dots, i.e. set the first element of the pattern array to the same value as the thickness\n- adjust the dot spacing, i.e. the second value of the pattern array, to be different from both the `dotted`, `loosely-dotted` and `densely-dotted` defaults (because I don't like their looks)",
      "reply_to_post_number": 4,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 30,
      "score": 11.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 750
    },
    {
      "id": 9191,
      "post_number": 6,
      "username": "aarnent",
      "name": "",
      "created_at": "2025-02-28T13:25:00.647Z",
      "updated_at": "2025-02-28T13:25:00.647Z",
      "cooked": "<p>Ah I understand now, sorry for the confusion.</p>\n<p>Indeed if you pass a troke to the underline function, the thickness default is based on the font thickness, or <a href=\"https://github.com/typst/typst/blob/cfb3b1a2709107f0f06f89ea25cabc939cec15e5/crates/typst-library/src/text/font/mod.rs#L244\" rel=\"noopener nofollow ugc\">defaulted to 0.06em</a>.</p>\n<p>Because this value is based on the actual font you are using (i.e. some fonts will set it to different values), the pt/em value is not exposed through typst.</p>\n<p>You can, however, use <a href=\"https://typst.app/docs/reference/visualize/stroke/#constructor-dash\">the string “dot” for a length equal to the line thickness</a> in stroke, so something like this would work:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#underline(stroke: stroke(\n  // works\n  dash: (\"dot\", 7pt)\n),)[#lorem(10)]\n</code></pre>\n<p>Downside with this is that you can’t set it to 0.7 times the thickness, so this wouldn’t work</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#underline(stroke: stroke(\n  // does not work\n  dash: (\"dot\",  0.7 * \"dot\")\n),)[#lorem(10)]\n</code></pre>\n<p>It seems the best way to achieve “relative thickness” would be through trial and error, or by <a href=\"https://fontdrop.info/\" rel=\"noopener nofollow ugc\">exploring the .otf</a> themselves. Maybe somebody else knows a better solution.</p>",
      "raw": "Ah I understand now, sorry for the confusion.\n\nIndeed if you pass a troke to the underline function, the thickness default is based on the font thickness, or [defaulted to 0.06em](https://github.com/typst/typst/blob/cfb3b1a2709107f0f06f89ea25cabc939cec15e5/crates/typst-library/src/text/font/mod.rs#L244). \n\nBecause this value is based on the actual font you are using (i.e. some fonts will set it to different values), the pt/em value is not exposed through typst.\n\nYou can, however, use [the string \"dot\" for a length equal to the line thickness](https://typst.app/docs/reference/visualize/stroke/#constructor-dash) in stroke, so something like this would work:\n```typst\n#underline(stroke: stroke(\n  // works\n  dash: (\"dot\", 7pt)\n),)[#lorem(10)]\n```\n\nDownside with this is that you can't set it to 0.7 times the thickness, so this wouldn't work\n```typst\n#underline(stroke: stroke(\n  // does not work\n  dash: (\"dot\",  0.7 * \"dot\")\n),)[#lorem(10)]\n```\n\nIt seems the best way to achieve \"relative thickness\" would be through trial and error, or by [exploring the .otf](https://fontdrop.info/) themselves. Maybe somebody else knows a better solution.",
      "reply_to_post_number": 5,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 30,
      "score": 51.0,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 501
    },
    {
      "id": 9210,
      "post_number": 7,
      "username": "wisperwind",
      "name": "",
      "created_at": "2025-02-28T17:37:21.887Z",
      "updated_at": "2025-02-28T17:37:21.887Z",
      "cooked": "<p>Nice, thanks, this is actually very helpful already: I’m pretty happy with <code>dash: (\"dot\", \"dot\")</code> in this case, which is even denser than <code>densely-dotted</code> for the font in question.</p>\n<p>I completely missed the info on <code>\"dot\"</code> when reading the documentation. I’ll probably open a GitHub issue, asking to amend the docs slightly: I feel like it would be helpful if the actual values for the shorthands would be specified. (e.g. <code>densely-dotted</code> is <code>(\"dot\", 1pt)</code> but if I wanted to slightly tweak that, I currently need to first read the Typst source to figure out what <code>densely-dotted</code> corresponds to.)</p>",
      "raw": "Nice, thanks, this is actually very helpful already: I'm pretty happy with `dash: (\"dot\", \"dot\")` in this case, which is even denser than `densely-dotted` for the font in question.\n\nI completely missed the info on `\"dot\"` when reading the documentation. I'll probably open a GitHub issue, asking to amend the docs slightly: I feel like it would be helpful if the actual values for the shorthands would be specified. (e.g. `densely-dotted` is `(\"dot\", 1pt)` but if I wanted to slightly tweak that, I currently need to first read the Typst source to figure out what `densely-dotted` corresponds to.)",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 26,
      "score": 10.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 750
    },
    {
      "id": 9213,
      "post_number": 8,
      "username": "aarnent",
      "name": "",
      "created_at": "2025-02-28T18:23:26.416Z",
      "updated_at": "2025-02-28T18:23:26.416Z",
      "cooked": "<p>No problem. I agree that the docs could do with some improvement, and it would also be nice if instead of <code>\"dot\"</code> we had something concrete like <code>underline.thickness</code> which we could use <code>set</code> rules on, and that we could e.g. multiply (it wouldn’t quite work like this because of the way stroke is implemented, but still). Of course, this would be a separate issue</p>",
      "raw": "No problem. I agree that the docs could do with some improvement, and it would also be nice if instead of `\"dot\"` we had something concrete like `underline.thickness` which we could use `set` rules on, and that we could e.g. multiply (it wouldn't quite work like this because of the way stroke is implemented, but still). Of course, this would be a separate issue",
      "reply_to_post_number": 7,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 10.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 501
    },
    {
      "id": 9413,
      "post_number": 9,
      "username": "wisperwind",
      "name": "",
      "created_at": "2025-03-05T13:32:35.838Z",
      "updated_at": "2025-03-05T13:32:35.838Z",
      "cooked": "<p>see <a href=\"https://github.com/typst/typst/issues/5982\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">`stroke` documentation does not provide definitions for dash pattern shorthands · Issue #5982 · typst/typst · GitHub</a></p>",
      "raw": "see https://github.com/typst/typst/issues/5982",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 18,
      "score": 8.6,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 750
    }
  ],
  "scraped_at": "2025-06-10T09:51:00.388739"
}