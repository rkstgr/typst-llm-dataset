{
  "topic_metadata": {
    "id": 3940,
    "title": "Why does my header code no longer work in Typst 0.13?",
    "slug": "why-does-my-header-code-no-longer-work-in-typst-0-13",
    "posts_count": 5,
    "created_at": "2025-05-05T15:51:09.137Z",
    "last_posted_at": "2025-05-06T14:43:32.270Z",
    "views": 92,
    "like_count": 3,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Andrew",
    "tags": [
      "scripting",
      "layout"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 456
  },
  "posts": [
    {
      "id": 11997,
      "post_number": 1,
      "username": "Suizii",
      "name": "",
      "created_at": "2025-05-05T15:51:09.638Z",
      "updated_at": "2025-05-05T22:26:10.457Z",
      "cooked": "<h2><a name=\"p-11997-the-following-code-is-used-to-indicate-the-title-of-the-chapter-at-the-top-of-a-presentation-this-no-longer-works-in-013-can-anyone-solve-this-function-thank-you-for-your-reply-1\" class=\"anchor\" href=\"#p-11997-the-following-code-is-used-to-indicate-the-title-of-the-chapter-at-the-top-of-a-presentation-this-no-longer-works-in-013-can-anyone-solve-this-function-thank-you-for-your-reply-1\"></a>The following code is used to indicate the title of the chapter at the top of a presentation.<br>\nThis no longer works in 0.13.<br>\nCan anyone solve this function?<br>\nThank you for your reply.</h2>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let current-chapter-title() = locate(loc =&gt; {\n  let headings = query(selector(heading.where(level:1)).before(loc))\n  if headings != () {\n    headings.last().body\n  } else {\n    \"Aucun titre trouvé\"\n  }\n})\n</code></pre>\n<hr>\n<h2><a name=\"p-11997-example-1-2\" class=\"anchor\" href=\"#p-11997-example-1-2\"></a>Example 1</h2>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">In this chapter (#current-chapter-title())...\n</code></pre>\n<h2><a name=\"p-11997-example-2-3\" class=\"anchor\" href=\"#p-11997-example-2-3\"></a>Example 2</h2>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(columns: 1,height: 1080pt, width: 1920pt, margin: (top: 55mm, right: 30mm, bottom: 30mm, left: 35mm), \nbackground: [#image(\"2.jpg\", width: 101%)], \nheader: [#place(dx: 1mm, dy: 9mm, left, text([#context counter(heading).display() - #current-chapter-title() | page #context counter(page).display()]\n,stroke: 0pt, size: 40pt, font: \"DejaVu Serif\"))]\n)\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384.jpeg\" data-download-href=\"https://forum.typst.app/uploads/default/6f736eccc67ac803ead914ff445cffb75c4a1384\" title=\"SmartSelect_20250505_172610_Chrome\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_690x255.jpeg\" alt=\"SmartSelect_20250505_172610_Chrome\" data-base62-sha1=\"fTWjoHSut4IRzaMerYFTGM29w8Y\" width=\"690\" height=\"255\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_690x255.jpeg, https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_1035x382.jpeg 1.5x, https://forum.typst.app/uploads/default/optimized/2X/6/6f736eccc67ac803ead914ff445cffb75c4a1384_2_1380x510.jpeg 2x\" data-dominant-color=\"151515\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">SmartSelect_20250505_172610_Chrome</span><span class=\"informations\">1920×710 86.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "The following code is used to indicate the title of the chapter at the top of a presentation.\nThis no longer works in 0.13.\nCan anyone solve this function?\nThank you for your reply.\n---\n```typ \n#let current-chapter-title() = locate(loc => {\n  let headings = query(selector(heading.where(level:1)).before(loc))\n  if headings != () {\n    headings.last().body\n  } else {\n    \"Aucun titre trouvé\"\n  }\n})\n```\n---\n## Example 1\n```typ\nIn this chapter (#current-chapter-title())...\n```\n## Example 2\n```typ\n#set page(columns: 1,height: 1080pt, width: 1920pt, margin: (top: 55mm, right: 30mm, bottom: 30mm, left: 35mm), \nbackground: [#image(\"2.jpg\", width: 101%)], \nheader: [#place(dx: 1mm, dy: 9mm, left, text([#context counter(heading).display() - #current-chapter-title() | page #context counter(page).display()]\n,stroke: 0pt, size: 40pt, font: \"DejaVu Serif\"))]\n)\n```\n![SmartSelect_20250505_172610_Chrome|690x255, 100%](upload://fTWjoHSut4IRzaMerYFTGM29w8Y.jpeg)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 34,
      "score": 46.8,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1558
    },
    {
      "id": 12004,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-05T17:44:19.844Z",
      "updated_at": "2025-05-05T17:44:19.844Z",
      "cooked": "<p>Hey. This is a breaking change. You should look at any breaking changes in the new version before switching to it.</p>\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/2X/b/bad3e5f9ad67c1ddf145107ce7032ac1d7b22563.svg\" class=\"site-icon\" data-dominant-color=\"\" width=\"32\" height=\"32\">\n\n      <a href=\"https://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\" target=\"_blank\" rel=\"noopener nofollow ugc\">GitHub</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/344;\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/e/e437cb90407d3c54d4bea959997febc68e9ab63c_2_690x345.png\" class=\"thumbnail\" data-dominant-color=\"ECF1F1\" width=\"690\" height=\"345\"></div>\n\n<h3><a href=\"https://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\" target=\"_blank\" rel=\"noopener nofollow ugc\">Release Version 0.13.0 (February 19, 2025) · typst/typst</a></h3>\n\n  <p>Read the announcement blog post\nView changelog with links into the documentation on typst.app/docs\nHighlights\n\nThere is now a distinction between proper paragraphs and just inline-level content. Th...</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://typst.app/docs/reference/introspection/locate/\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/1X/098187a593d51c4db99324614e2baeeb1bb355cc.png\" class=\"site-icon\" data-dominant-color=\"3CA8B6\" width=\"32\" height=\"32\">\n\n      <a href=\"https://typst.app/docs/reference/introspection/locate/\" target=\"_blank\" rel=\"noopener\">Typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/db1c18ed802fe6841bee62606931f352da10ed09_2_690x362.png\" class=\"thumbnail\" data-dominant-color=\"7CC2C5\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://typst.app/docs/reference/introspection/locate/\" target=\"_blank\" rel=\"noopener\">Locate Function – Typst Documentation</a></h3>\n\n  <p>Documentation for the `locate` function.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<aside class=\"onebox allowlistedgeneric\" data-onebox-src=\"https://typst.app/docs/reference/introspection/here/\">\n  <header class=\"source\">\n      <img src=\"https://forum.typst.app/uploads/default/original/1X/098187a593d51c4db99324614e2baeeb1bb355cc.png\" class=\"site-icon\" data-dominant-color=\"3CA8B6\" width=\"32\" height=\"32\">\n\n      <a href=\"https://typst.app/docs/reference/introspection/here/\" target=\"_blank\" rel=\"noopener\">Typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"aspect-image\" style=\"--aspect-ratio:690/361;\"><img src=\"https://forum.typst.app/uploads/default/optimized/1X/db1c18ed802fe6841bee62606931f352da10ed09_2_690x362.png\" class=\"thumbnail\" data-dominant-color=\"7CC2C5\" width=\"690\" height=\"362\"></div>\n\n<h3><a href=\"https://typst.app/docs/reference/introspection/here/\" target=\"_blank\" rel=\"noopener\">Here Function – Typst Documentation</a></h3>\n\n  <p>Documentation for the `here` function.</p>\n\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let current-chapter-title() = context {\n  let headings = query(heading.where(level: 1).before(here()))\n  if headings == () { panic(\"Aucun titre trouvé\") }\n  headings.last().body\n}\n\n= Heading\n\n#current-chapter-title()\n</code></pre>",
      "raw": "Hey. This is a breaking change. You should look at any breaking changes in the new version before switching to it.\n\nhttps://github.com/typst/typst/releases/tag/v0.13.0#:~:text=Removed%20compatibility%20behavior%20of%20locate%20(Breaking%20change)\n\nhttps://typst.app/docs/reference/introspection/locate/\n\nhttps://typst.app/docs/reference/introspection/here/\n\n```typ\n#let current-chapter-title() = context {\n  let headings = query(heading.where(level: 1).before(here()))\n  if headings == () { panic(\"Aucun titre trouvé\") }\n  headings.last().body\n}\n\n= Heading\n\n#current-chapter-title()\n```",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 28,
      "score": 40.6,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12008,
      "post_number": 3,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-05-05T22:27:12.691Z",
      "updated_at": "2025-05-05T22:27:12.691Z",
      "cooked": "<p>Hey <a class=\"mention\" href=\"/u/suizii\">@Suizii</a>, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></p>\n<p>Make sure your title is a question you’d ask to a friend about Typst. <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hey @Suizii, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n\nMake sure your title is a question you’d ask to a friend about Typst. :wink:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 5.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 12009,
      "post_number": 4,
      "username": "PgBiel",
      "name": "",
      "created_at": "2025-05-05T22:31:27.011Z",
      "updated_at": "2025-05-05T22:33:36.551Z",
      "cooked": "<p>To further clarify Andrew’s answer: the original functionality of the <code>locate</code> function was removed in Typst 0.13 (after being deprecated since Typst 0.11), and should be replaced with <code>context { ... }</code>. To get <code>loc</code> again, you can use <code>let loc = here()</code>, but that’s usually no longer necessary, as most operations which previously required a <code>loc</code> no longer do. Some examples:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">// Before Typst 0.11:\n#locate(loc =&gt; {\n  let header-numbers = counter(heading).at(loc)\n  let all-headings = query(heading, loc)\n  let last-value-of-my-state = state(\"key\", 3).final(loc)\n  let headings-before-here = query(selector(heading).before(loc))\n  let current-page = loc.page()\n\n  // ...\n})\n\n// After Typst 0.11:\n#context {\n  let header-numbers = counter(heading).get()\n  let all-headings = query(heading)\n  let last-value-of-my-state = state(\"key\", 3).final()\n\n  // These still need the current location\n  // It can be retrieved with `here()`\n  let headings-before-here = query(selector(heading).before(here()))\n  let current-page = here().page()\n\n  // ...\n})\n</code></pre>\n<p>Note that the function named <code>locate</code> now has a new purpose: <code>locate(&lt;abc&gt;)</code> in a <code>context</code> will now return the location object of something with that label.</p>",
      "raw": "To further clarify Andrew's answer: the original functionality of the `locate` function was removed in Typst 0.13 (after being deprecated since Typst 0.11), and should be replaced with `context { ... }`. To get `loc` again, you can use `let loc = here()`, but that's usually no longer necessary, as most operations which previously required a `loc` no longer do. Some examples:\n\n```typ\n// Before Typst 0.11:\n#locate(loc => {\n  let header-numbers = counter(heading).at(loc)\n  let all-headings = query(heading, loc)\n  let last-value-of-my-state = state(\"key\", 3).final(loc)\n  let headings-before-here = query(selector(heading).before(loc))\n  let current-page = loc.page()\n\n  // ...\n})\n\n// After Typst 0.11:\n#context {\n  let header-numbers = counter(heading).get()\n  let all-headings = query(heading)\n  let last-value-of-my-state = state(\"key\", 3).final()\n\n  // These still need the current location\n  // It can be retrieved with `here()`\n  let headings-before-here = query(selector(heading).before(here()))\n  let current-page = here().page()\n\n  // ...\n})\n```\n\nNote that the function named `locate` now has a new purpose: `locate(<abc>)` in a `context` will now return the location object of something with that label.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 24,
      "score": 39.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 12050,
      "post_number": 5,
      "username": "Suizii",
      "name": "",
      "created_at": "2025-05-06T14:43:32.270Z",
      "updated_at": "2025-05-06T14:43:32.270Z",
      "cooked": "<p>thank you for taking the time to explain this to me</p>",
      "raw": "thank you for taking the time to explain this to me",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 4.4,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 1558
    }
  ],
  "scraped_at": "2025-06-10T09:48:17.948834"
}