{
  "topic_metadata": {
    "id": 1708,
    "title": "How to draw at the margin of a page?",
    "slug": "how-to-draw-at-the-margin-of-a-page",
    "posts_count": 6,
    "created_at": "2024-11-13T17:07:04.786Z",
    "last_posted_at": "2024-11-14T21:36:31.113Z",
    "views": 352,
    "like_count": 6,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "sjfhsjfh",
    "tags": [
      "layout",
      "graphics"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 709
  },
  "posts": [
    {
      "id": 5593,
      "post_number": 1,
      "username": "Oscar",
      "name": "acsor43215",
      "created_at": "2024-11-13T17:07:04.894Z",
      "updated_at": "2024-11-13T17:13:37.722Z",
      "cooked": "<p>I’m trying to replicate a LaTeX template where the heading of each chapter has a black rectangle that stretches to the right margin, as shown in the picture below.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/50d05bae8631a5449f783b230dd08e1b49a82fb5.png\" data-download-href=\"https://forum.typst.app/uploads/default/50d05bae8631a5449f783b230dd08e1b49a82fb5\" title=\"The black rectangle on the right margin is what I want to achieve.\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/50d05bae8631a5449f783b230dd08e1b49a82fb5_2_690x307.png\" alt=\"The black rectangle on the right margin is what I want to achieve.\" data-base62-sha1=\"bwUBnrRzTkpVXX8H1ykHer8Spk9\" width=\"690\" height=\"307\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/50d05bae8631a5449f783b230dd08e1b49a82fb5_2_690x307.png, https://forum.typst.app/uploads/default/optimized/2X/5/50d05bae8631a5449f783b230dd08e1b49a82fb5_2_1035x460.png 1.5x, https://forum.typst.app/uploads/default/original/2X/5/50d05bae8631a5449f783b230dd08e1b49a82fb5.png 2x\" data-dominant-color=\"EFEFEF\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">The black rectangle on the right margin is what I want to achieve.</span><span class=\"informations\">1047×467 22.1 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>How can such a behavior be replicated in Typst? Here’s what I have at the moment:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">show heading.where(level: 1): x =&gt; [\n    #pagebreak(weak: true)\n    #set text(\n        size: 1.6em,\n        weight: \"regular\"\n    )\n    #set align(right)\n    #block(\n        above: 20pt,\n        below: 50pt,\n    )[\n        #smallcaps([Chapter #x.numbering]) \\\n        #text(\n            size: 1.3em\n        )[\n            *#x.body*\n        ]\n        #place(\n            dx: 75pt,\n            horizon + right,\n            rect(\n                fill: black,\n                height: 9%\n            )\n        )\n    ]\n]\n\n</code></pre>\n<p>With this code, I obtain the following output:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/7/7d4145c3796b31f3f66a4d4c08cb0c82b26c2d32.png\" data-download-href=\"https://forum.typst.app/uploads/default/7d4145c3796b31f3f66a4d4c08cb0c82b26c2d32\" title=\"What I have at the moment.\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/7/7d4145c3796b31f3f66a4d4c08cb0c82b26c2d32_2_690x213.png\" alt=\"What I have at the moment.\" data-base62-sha1=\"hS3wPtZzxlySkIm0DLjH8I1fYMa\" width=\"690\" height=\"213\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/7/7d4145c3796b31f3f66a4d4c08cb0c82b26c2d32_2_690x213.png, https://forum.typst.app/uploads/default/original/2X/7/7d4145c3796b31f3f66a4d4c08cb0c82b26c2d32.png 1.5x, https://forum.typst.app/uploads/default/original/2X/7/7d4145c3796b31f3f66a4d4c08cb0c82b26c2d32.png 2x\" data-dominant-color=\"E5E6E6\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">What I have at the moment.</span><span class=\"informations\">981×304 26.9 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Please ignore the fact that the style of this heading does not perfectly match the one of the heading before. What concerns me in this post is just how to draw the rectangle at the side of the page. Here are the specifics of the solution I would like to find:</p>\n<ul>\n<li>No hardcoded values, like in the <code>#place</code> call above where <code>dx: 75pt</code> or <code>height: 9%</code> are used. The rectangle should adapt dynamically to the content of the heading.</li>\n<li>The height of the rectangle should <em>perfectly</em> match the height of the parent element. In the snippet above, the rectangle should have exactly the same height as the surrounding <code>#block</code>.</li>\n</ul>",
      "raw": "I'm trying to replicate a LaTeX template where the heading of each chapter has a black rectangle that stretches to the right margin, as shown in the picture below.\n\n![The black rectangle on the right margin is what I want to achieve.|690x307](upload://bwUBnrRzTkpVXX8H1ykHer8Spk9.png)\n\nHow can such a behavior be replicated in Typst? Here's what I have at the moment:\n\n```typst\nshow heading.where(level: 1): x => [\n    #pagebreak(weak: true)\n    #set text(\n        size: 1.6em,\n        weight: \"regular\"\n    )\n    #set align(right)\n    #block(\n        above: 20pt,\n        below: 50pt,\n    )[\n        #smallcaps([Chapter #x.numbering]) \\\n        #text(\n            size: 1.3em\n        )[\n            *#x.body*\n        ]\n        #place(\n            dx: 75pt,\n            horizon + right,\n            rect(\n                fill: black,\n                height: 9%\n            )\n        )\n    ]\n]\n\n```\n\nWith this code, I obtain the following output:\n\n![What I have at the moment.|690x213](upload://hS3wPtZzxlySkIm0DLjH8I1fYMa.png)\n\nPlease ignore the fact that the style of this heading does not perfectly match the one of the heading before. What concerns me in this post is just how to draw the rectangle at the side of the page. Here are the specifics of the solution I would like to find:\n\n- No hardcoded values, like in the `#place` call above where `dx: 75pt` or `height: 9%` are used. The rectangle should adapt dynamically to the content of the heading.\n- The height of the rectangle should _perfectly_ match the height of the parent element. In the snippet above, the rectangle should have exactly the same height as the surrounding `#block`.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 59,
      "score": 1131.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 602
    },
    {
      "id": 5595,
      "post_number": 2,
      "username": "sjfhsjfh",
      "name": "sjfhsjfh",
      "created_at": "2024-11-13T17:41:01.449Z",
      "updated_at": "2024-11-13T17:41:01.449Z",
      "cooked": "<p>Hi Oscar, I recommend reading about <a href=\"https://typst.app/docs/reference/layout/measure/\"><code>measure</code></a> to figure out how it works. Here’s my code:</p>\n<h3><a name=\"p-5595-margin-calculation-1\" class=\"anchor\" href=\"#p-5595-margin-calculation-1\"></a>Margin calculation</h3>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">/// Reference:\n/// https://typst.app/docs/reference/layout/page/#parameters-margin\n#let calc-margin(margin, shape) = if margin == auto {\n  2.5 / 21 * calc.min(..shape)\n} else {\n  margin\n}\n</code></pre>\n<h3><a name=\"p-5595-show-rule-2\" class=\"anchor\" href=\"#p-5595-show-rule-2\"></a>Show rule</h3>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show heading.where(level: 1): it =&gt; {\n  pagebreak(weak: true)\n  set text(\n    size: 1.6em,\n    weight: \"regular\",\n  )\n  set align(right)\n  block(\n    above: 20pt,\n    below: 50pt,\n    context {\n      let title-content = {\n        smallcaps([Chapter #counter(heading).display(heading.numbering)])\n        linebreak()\n        text(size: 1.3em)[*#it.body*]\n      }\n      title-content\n      place(\n        dx: calc-margin(page.margin, (page.width, page.height)),\n        horizon + right,\n        rect(\n          fill: black,\n          height: measure(title-content).height,\n        ),\n      )\n    },\n  )\n}\n</code></pre>\n<p>I also modified the chapter numbering to make it work properly. Hope this helps <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hi Oscar, I recommend reading about [`measure`](https://typst.app/docs/reference/layout/measure/) to figure out how it works. Here's my code:\n\n### Margin calculation\n\n```typ\n/// Reference:\n/// https://typst.app/docs/reference/layout/page/#parameters-margin\n#let calc-margin(margin, shape) = if margin == auto {\n  2.5 / 21 * calc.min(..shape)\n} else {\n  margin\n}\n```\n\n### Show rule\n\n```typ\n#show heading.where(level: 1): it => {\n  pagebreak(weak: true)\n  set text(\n    size: 1.6em,\n    weight: \"regular\",\n  )\n  set align(right)\n  block(\n    above: 20pt,\n    below: 50pt,\n    context {\n      let title-content = {\n        smallcaps([Chapter #counter(heading).display(heading.numbering)])\n        linebreak()\n        text(size: 1.3em)[*#it.body*]\n      }\n      title-content\n      place(\n        dx: calc-margin(page.margin, (page.width, page.height)),\n        horizon + right,\n        rect(\n          fill: black,\n          height: measure(title-content).height,\n        ),\n      )\n    },\n  )\n}\n```\n\nI also modified the chapter numbering to make it work properly. Hope this helps :slight_smile:",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 3,
      "reads": 55,
      "score": 131.0,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 120
    },
    {
      "id": 5632,
      "post_number": 3,
      "username": "Oscar",
      "name": "acsor43215",
      "created_at": "2024-11-14T12:11:18.870Z",
      "updated_at": "2024-11-14T12:11:18.870Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/sjfhsjfh\">@sjfhsjfh</a>, thanks for your code! Yes, your snippet was actually useful. I made some modifications to suit it to a variant of the specification I gave earlier, and the result is as follows:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/3/391e9aa852fd9c372895b677d7e49894f3a2272f.png\" data-download-href=\"https://forum.typst.app/uploads/default/391e9aa852fd9c372895b677d7e49894f3a2272f\" title=\"What I get.\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/3/391e9aa852fd9c372895b677d7e49894f3a2272f_2_690x215.png\" alt=\"What I get.\" data-base62-sha1=\"89iMF0ZI9krPOvX1AmLoWOjM5ll\" width=\"690\" height=\"215\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/3/391e9aa852fd9c372895b677d7e49894f3a2272f_2_690x215.png, https://forum.typst.app/uploads/default/optimized/2X/3/391e9aa852fd9c372895b677d7e49894f3a2272f_2_1035x322.png 1.5x, https://forum.typst.app/uploads/default/original/2X/3/391e9aa852fd9c372895b677d7e49894f3a2272f.png 2x\" data-dominant-color=\"EFEFEF\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">What I get.</span><span class=\"informations\">1086×339 10.8 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>My only question at this point is, is there any mistake in the way the numbering style of the heading is fetched? When I pasted your snippet as-is into my code, the compiler was issuing an error saying it was receiving a <code>none</code> value instead of the numbering style (“1.” in my case).</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"sjfhsjfh\" data-post=\"2\" data-topic=\"1708\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/sjfhsjfh/48/125_2.png\" class=\"avatar\"> sjfhsjfh:</div>\n<blockquote>\n<pre><code class=\"lang-auto\">let title-content = {\n  // The line above is the one I mean\n  smallcaps([Chapter #counter(heading).display(heading.numbering)])\n  linebreak()\n  text(size: 1.3em)[*#it.body*]\n}\n</code></pre>\n</blockquote>\n</aside>\n<p>At the end, I replaced the line</p>\n<pre><code class=\"lang-auto\">smallcaps([Chapter #counter(heading).display(heading.numbering)])\n</code></pre>\n<p>with</p>\n<pre><code class=\"lang-auto\">smallcaps([Chapter #counter(heading).display(\"1\")])\n</code></pre>\n<p>also because I wanted the “1” numbering style to be shown in the heading, and the “1.” one elsewhere in the document.</p>",
      "raw": "Hi @sjfhsjfh, thanks for your code! Yes, your snippet was actually useful. I made some modifications to suit it to a variant of the specification I gave earlier, and the result is as follows:\n\n![What I get.|690x215](upload://89iMF0ZI9krPOvX1AmLoWOjM5ll.png)\n\nMy only question at this point is, is there any mistake in the way the numbering style of the heading is fetched? When I pasted your snippet as-is into my code, the compiler was issuing an error saying it was receiving a `none` value instead of the numbering style (\"1.\" in my case).\n\n[quote=\"sjfhsjfh, post:2, topic:1708\"]\n```\nlet title-content = {\n  // The line above is the one I mean\n  smallcaps([Chapter #counter(heading).display(heading.numbering)])\n  linebreak()\n  text(size: 1.3em)[*#it.body*]\n}\n```\n[/quote]\n\nAt the end, I replaced the line\n\n```\nsmallcaps([Chapter #counter(heading).display(heading.numbering)])\n```\n\nwith\n\n```\nsmallcaps([Chapter #counter(heading).display(\"1\")])\n```\n\nalso because I wanted the \"1\" numbering style to be shown in the heading, and the \"1.\" one elsewhere in the document.",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 1,
      "reads": 43,
      "score": 33.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 602
    },
    {
      "id": 5633,
      "post_number": 4,
      "username": "sjfhsjfh",
      "name": "sjfhsjfh",
      "created_at": "2024-11-14T12:33:35.988Z",
      "updated_at": "2024-11-14T12:33:49.207Z",
      "cooked": "<p>I assumed that you have already set the numbering for heading in the former document like:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set heading(numbering: \"1.\")\n</code></pre>\n<p>If you didn’t do this you will have <code>context heading.numbering</code> to be <code>none</code>. My purpose of doing this to keep consistency. However it seems that you would like to use a different pattern from the one in the document, then simply using <code>.display(\"1\")</code> would be fine.</p>",
      "raw": "I assumed that you have already set the numbering for heading in the former document like:\n\n```typ\n#set heading(numbering: \"1.\")\n```\n\nIf you didn't do this you will have `context heading.numbering` to be `none`. My purpose of doing this to keep consistency. However it seems that you would like to use a different pattern from the one in the document, then simply using `.display(\"1\")` would be fine.",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 41,
      "score": 13.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 120
    },
    {
      "id": 5634,
      "post_number": 5,
      "username": "Oscar",
      "name": "acsor43215",
      "created_at": "2024-11-14T14:38:42.619Z",
      "updated_at": "2024-11-14T14:38:42.619Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"sjfhsjfh\" data-post=\"4\" data-topic=\"1708\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/sjfhsjfh/48/125_2.png\" class=\"avatar\"> sjfhsjfh:</div>\n<blockquote>\n<p>I assumed that you have already set the numbering for heading in the former document like:</p>\n</blockquote>\n</aside>\n<p>Yes, I already had that setting in my code before. It was strange for me to see that too.</p>",
      "raw": "[quote=\"sjfhsjfh, post:4, topic:1708\"]\nI assumed that you have already set the numbering for heading in the former document like:\n[/quote]\n\nYes, I already had that setting in my code before. It was strange for me to see that too.",
      "reply_to_post_number": 4,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 37,
      "score": 12.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 602
    },
    {
      "id": 5646,
      "post_number": 6,
      "username": "slowjo",
      "name": "slowjo",
      "created_at": "2024-11-14T21:36:31.113Z",
      "updated_at": "2024-11-14T21:36:31.113Z",
      "cooked": "<p>I just bumped into this a few minutes ago. I was using an outline in the document, and outlines set <code>heading.numbering</code> to <code>none</code>. You can test this easily to figure out if that is where it breaks: replace the line with</p>\n<pre><code class=\"lang-auto\"> smallcaps([Chapter #repr(heading.numbering)])\n</code></pre>\n<p>and then hunt that <code>none</code> in your document :)</p>",
      "raw": "I just bumped into this a few minutes ago. I was using an outline in the document, and outlines set `heading.numbering` to `none`. You can test this easily to figure out if that is where it breaks: replace the line with\n```typst{\n smallcaps([Chapter #repr(heading.numbering)])\n```\nand then hunt that `none` in your document :)",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 33,
      "score": 31.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 793
    }
  ],
  "scraped_at": "2025-06-10T09:55:00.412938"
}