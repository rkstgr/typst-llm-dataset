{
  "topic_metadata": {
    "id": 1730,
    "title": "Why is I-figured broken with custom template?",
    "slug": "why-is-i-figured-broken-with-custom-template",
    "posts_count": 11,
    "created_at": "2024-11-14T17:53:07.696Z",
    "last_posted_at": "2024-11-19T00:44:00.314Z",
    "views": 179,
    "like_count": 1,
    "reply_count": 6,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 6,
    "accepted_answer_username": "Flexschmex",
    "tags": [
      "scripting",
      "figures"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 1242
  },
  "posts": [
    {
      "id": 5638,
      "post_number": 1,
      "username": "Flexschmex",
      "name": "Felix",
      "created_at": "2024-11-14T17:53:07.815Z",
      "updated_at": "2024-11-19T00:44:23.302Z",
      "cooked": "<p>I am currently customizing this template: <a href=\"https://typst.app/universe/package/tgm-hit-thesis/\" class=\"inline-onebox\">tgm-hit-thesis – Typst Universe</a></p>\n<p>It is using the i-figured package which is supposed to reset the figure counters on new chapters. Therefore, the first figure in chapter number X should be numbered X.1. But it is not happening and i cannot get it to work.</p>\n<p>I am really grateful for any pointers.</p>",
      "raw": "I am currently customizing this template: https://typst.app/universe/package/tgm-hit-thesis/\n\nIt is using the i-figured package which is supposed to reset the figure counters on new chapters. Therefore, the first figure in chapter number X should be numbered X.1. But it is not happening and i cannot get it to work. \n\nI am really grateful for any pointers.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 38,
      "score": 372.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 810
    },
    {
      "id": 5654,
      "post_number": 2,
      "username": "jbirnick",
      "name": "Johann Birnick",
      "created_at": "2024-11-15T02:35:53.557Z",
      "updated_at": "2024-11-15T02:35:53.557Z",
      "cooked": "<p>I tried the template and it seems like it has section-based figure numbers already built in. So I don’t know what’s the problem and why you would even do it with a separate package then?</p>\n<p>Please also share your code.</p>",
      "raw": "I tried the template and it seems like it has section-based figure numbers already built in. So I don't know what's the problem and why you would even do it with a separate package then?\n\nPlease also share your code.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 33,
      "score": 6.6,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 218
    },
    {
      "id": 5664,
      "post_number": 3,
      "username": "Flexschmex",
      "name": "Felix",
      "created_at": "2024-11-15T09:51:37.195Z",
      "updated_at": "2024-11-15T09:51:37.195Z",
      "cooked": "<p>Thank you for your time.<br>\nYou are right, the template has section-based figure numbers, using the i-figured package. The catch is, they don’t seem to work for me. I am not trying to include a separate package, as the package is already included in the template.</p>\n<p>Try to include two figures in two different chapters. I’d expect the figures to be labelled X.1 and Y.1, but instead they are labelled X.1 and Y.2.</p>\n<p>Please see this minimal example of the template with two figures in Chapter 4 and 5: <a href=\"https://typst.app/project/w9hlUyPNTRpuMFF8UFvd8k\" class=\"inline-onebox\">Typst</a></p>",
      "raw": "Thank you for your time.\nYou are right, the template has section-based figure numbers, using the i-figured package. The catch is, they don't seem to work for me. I am not trying to include a separate package, as the package is already included in the template.\n\nTry to include two figures in two different chapters. I'd expect the figures to be labelled X.1 and Y.1, but instead they are labelled X.1 and Y.2. \n\nPlease see this minimal example of the template with two figures in Chapter 4 and 5: https://typst.app/project/w9hlUyPNTRpuMFF8UFvd8k",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 31,
      "score": 6.2,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 810
    },
    {
      "id": 5690,
      "post_number": 4,
      "username": "jbirnick",
      "name": "Johann Birnick",
      "created_at": "2024-11-15T23:11:37.498Z",
      "updated_at": "2024-11-15T23:11:37.498Z",
      "cooked": "<p>Ah indeed that’s broken. I don’t know if that’s an issue with i-figured or with the template (and I don’t have the time to go through all the code…), but you can use <a href=\"https://typst.app/universe/package/headcount/\">headcount</a> instead:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/headcount:0.1.0\": *\n\n#set heading(numbering: \"1.1\")\n\n// these two lines set up the figure numbering\n#set figure(numbering: dependent-numbering(\"1.1\"))\n#show heading: reset-counter(counter(figure.where(kind: image)), levels: 1)\n\n= First chapter\n\n#figure(\n  [This is a figure.],\n  caption: [And this is a caption.]\n)\n\n= Second chapter\n\n#figure(\n  [This is a figure in another chapter.],\n  caption: [And this is the other caption.]\n)\n</code></pre>\n<p>I guess the easiest is to write your complete own template then, which is anyways a good exercise to learn Typst. (You can of course copy some code from the given template.)</p>",
      "raw": "Ah indeed that's broken. I don't know if that's an issue with i-figured or with the template (and I don't have the time to go through all the code...), but you can use [headcount](https://typst.app/universe/package/headcount/) instead:\n\n```typ\n#import \"@preview/headcount:0.1.0\": *\n\n#set heading(numbering: \"1.1\")\n\n// these two lines set up the figure numbering\n#set figure(numbering: dependent-numbering(\"1.1\"))\n#show heading: reset-counter(counter(figure.where(kind: image)), levels: 1)\n\n= First chapter\n\n#figure(\n  [This is a figure.],\n  caption: [And this is a caption.]\n)\n\n= Second chapter\n\n#figure(\n  [This is a figure in another chapter.],\n  caption: [And this is the other caption.]\n)\n```\n\nI guess the easiest is to write your complete own template then, which is anyways a good exercise to learn Typst. (You can of course copy some code from the given template.)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 5.6,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 218
    },
    {
      "id": 5723,
      "post_number": 5,
      "username": "Flexschmex",
      "name": "Felix",
      "created_at": "2024-11-17T15:24:26.957Z",
      "updated_at": "2024-11-17T21:39:07.495Z",
      "cooked": "<p>Hi,<br>\nthank you for your suggestion.<br>\nIn the meantime, I have manage to figure out that this block in the template messes with the figure numbers:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">  // chapters start on a right page and have very big, fancy headings\n  show heading.where(level: 1): it =&gt; {\n    set text(1.3em)\n    pagebreak(to: \"odd\")\n    v(12%)\n    if it.numbering != none [\n      #align(right, { \n        text(6em, fill: gray, style: \"normal\", { \n          counter(heading).display()\n        })\n      })\n      #parbreak()\n    ]\n    set text(1.3em)\n    v(-4cm)\n    align(right)[#text(1cm, weight: \"regular\")[#it.body]]\n    v(0.5cm)\n  }\n</code></pre>\n<p>Do you have an idea why that is and how it could be fixed? Interestingly, even doing</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">  // chapters start on a right page and have very big, fancy headings\n  show heading.where(level: 1): it =&gt; {}\n</code></pre>\n<p>is enough…</p>",
      "raw": "Hi,\nthank you for your suggestion.\nIn the meantime, I have manage to figure out that this block in the template messes with the figure numbers:\n\n```typc\n  // chapters start on a right page and have very big, fancy headings\n  show heading.where(level: 1): it => {\n    set text(1.3em)\n    pagebreak(to: \"odd\")\n    v(12%)\n    if it.numbering != none [\n      #align(right, { \n        text(6em, fill: gray, style: \"normal\", { \n          counter(heading).display()\n        })\n      })\n      #parbreak()\n    ]\n    set text(1.3em)\n    v(-4cm)\n    align(right)[#text(1cm, weight: \"regular\")[#it.body]]\n    v(0.5cm)\n  }\n```\n\nDo you have an idea why that is and how it could be fixed? Interestingly, even doing\n\n```typc\n  // chapters start on a right page and have very big, fancy headings\n  show heading.where(level: 1): it => {}\n```\nis enough...",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 810
    },
    {
      "id": 5726,
      "post_number": 6,
      "username": "Flexschmex",
      "name": "Felix",
      "created_at": "2024-11-17T16:27:39.736Z",
      "updated_at": "2024-11-17T21:38:42.380Z",
      "cooked": "<p>In the meantime, I found the solutions. Simply initializing the i-figured package AFTER the custom heading show rule did the trick. In the template, the init is done before the custom show rule, resulting in the numbering not working properly.</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">// define show rule\nshow heading.where(level: 1): it =&gt; {\n  // custom show rule\n}\n\n// init i-figured package\nshow heading: i-figured.reset-counters\nshow figure: i-figured.show-figure\nshow math.equation: i-figured.show-equation\n</code></pre>",
      "raw": "In the meantime, I found the solutions. Simply initializing the i-figured package AFTER the custom heading show rule did the trick. In the template, the init is done before the custom show rule, resulting in the numbering not working properly.\n\n```typc\n// define show rule\nshow heading.where(level: 1): it => {\n  // custom show rule\n}\n\n// init i-figured package\nshow heading: i-figured.reset-counters\nshow figure: i-figured.show-figure\nshow math.equation: i-figured.show-equation\n```",
      "reply_to_post_number": 5,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 34.4,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 810
    },
    {
      "id": 5729,
      "post_number": 7,
      "username": "jbirnick",
      "name": "Johann Birnick",
      "created_at": "2024-11-17T17:52:17.323Z",
      "updated_at": "2024-11-18T17:23:33.132Z",
      "cooked": "<p><s>With <a href=\"https://typst.app/universe/package/headcount/\">headcount</a> the order doesn’t matter (and will never matter) <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></s></p>",
      "raw": "~~With [headcount](https://typst.app/universe/package/headcount/) the order doesn't matter (and will never matter) :wink:~~",
      "reply_to_post_number": 6,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 21,
      "score": 4.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 218
    },
    {
      "id": 5730,
      "post_number": 8,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2024-11-17T17:53:02.112Z",
      "updated_at": "2024-11-17T17:53:02.112Z",
      "cooked": "<p>Hi, template author here! Thanks for figuring (no pun intended) the problem out. I have applied your fix and it will be in the next release! Btw, check out the main branch, as I applied <a href=\"https://github.com/typst/typst/issues/2722#issuecomment-2214976390\">frozolotl’s emtpy page fix</a>, which gets rid of the need to manually insert <code>chapter-end</code>!</p>\n<hr>\n<p>Putting on my moderator hat: could you maybe try to revise your post’s title to be a complete question as per the <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\">question guidelines</a>:</p>\n<blockquote>\n<p><strong>Good titles are questions you would ask your friend about Typst.</strong></p>\n</blockquote>\n<p>We hope by adhering to this, we make the information in this forum easy to find in the future. Thanks!</p>",
      "raw": "Hi, template author here! Thanks for figuring (no pun intended) the problem out. I have applied your fix and it will be in the next release! Btw, check out the main branch, as I applied [frozolotl's emtpy page fix](https://github.com/typst/typst/issues/2722#issuecomment-2214976390), which gets rid of the need to manually insert `chapter-end`!\n\n---\n\nPutting on my moderator hat: could you maybe try to revise your post’s title to be a complete question as per the [question guidelines](https://forum.typst.app/t/how-to-post-in-the-questions-category/11):\n\n> **Good titles are questions you would ask your friend about Typst.**\n\nWe hope by adhering to this, we make the information in this forum easy to find in the future. Thanks!",
      "reply_to_post_number": 6,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 21,
      "score": 29.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 5769,
      "post_number": 9,
      "username": "Flexschmex",
      "name": "Felix",
      "created_at": "2024-11-18T10:17:22.855Z",
      "updated_at": "2024-11-18T10:17:22.855Z",
      "cooked": "<p>That’s great news.</p>\n<p>I would love to edit the title, but it seems like there is no option to.</p>\n<p><a class=\"mention\" href=\"/u/jbirnick\">@jbirnick</a> I could not get headcount to work properly with the template.<br>\nI have build another example at <a href=\"https://typst.app/project/wuqi37PBGAvaDrJbPuTDvc\" class=\"inline-onebox\">Typst</a>. Setup of headcount is done in template/lib.typ in line 158. Maybe i was missing something.</p>",
      "raw": "That's great news.\n\nI would love to edit the title, but it seems like there is no option to.\n\n@jbirnick I could not get headcount to work properly with the template.\nI have build another example at https://typst.app/project/wuqi37PBGAvaDrJbPuTDvc. Setup of headcount is done in template/lib.typ in line 158. Maybe i was missing something.",
      "reply_to_post_number": 8,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 19,
      "score": 13.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 810
    },
    {
      "id": 5803,
      "post_number": 10,
      "username": "jbirnick",
      "name": "Johann Birnick",
      "created_at": "2024-11-18T17:48:32.229Z",
      "updated_at": "2024-11-18T17:54:11.101Z",
      "cooked": "<p>Ok I was talking BS, the order does matter for headcount. To fix your template, put the</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">show heading: reset-counter(counter(figure.where(kind: image)))\n</code></pre>\n<p>after all the other <code>heading</code> show rules (in particular after your “custom heading design”).</p>\n<hr>\n<p>If you’re interested, here is an explanation. The <code>reset-counter</code> show rule is something like this</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">it =&gt; {\n  thecounter.update((0,))\n  it\n}\n</code></pre>\n<p>where <code>thecounter</code> is the counter in the argument, so in this case the counter of <code>figure</code>. So it just resets the counter of <code>figure</code> and then displays the heading as usual.</p>\n<p>Now the question is, what happens if you put <em>another</em> show rule for heading <em>below</em> the one above. This will “wrap around” the show rule above, in the sense that <code>it</code> in the new show rule is actually:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">thecounter.update((0,))\nheading(...)\n</code></pre>\n<p>So if you just reuse <code>it</code> in your new show rule, everything will still be fine. For example, this still works:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/headcount:0.1.0\": *\n\n#set heading(numbering: \"1.1\")\n#set figure(numbering: dependent-numbering(\"1.1\"))\n#show heading: reset-counter(counter(figure.where(kind: image)))\n\n// custom design\n#show heading: it =&gt; {\n  block(fill: green.lighten(20%), inset: 5pt, it)\n}\n\n= Introduction\n\n#figure([some figure], caption: [some caption])\n\n= Let's Go\n\n#figure([another figure], caption: [another caption])\n</code></pre>\n<p>The problem now comes when, in your new show rules for your custom design, you do <em>not</em> use (the full) <code>it</code>, but just for example <code>it.body</code>. For example, this doesn’t work:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/headcount:0.1.0\": *\n\n#set heading(numbering: \"1.1\")\n#set figure(numbering: dependent-numbering(\"1.1\"))\n#show heading: reset-counter(counter(figure.where(kind: image)))\n\n// custom design\n#show heading: it =&gt; [\n  #counter(heading).display() | #it.body\n]\n\n= Introduction\n\n#figure([some figure], caption: [some caption])\n\n= Let's Go\n\n#figure([another figure], caption: [another caption])\n</code></pre>\n<p>The reason is that, because your don’t use <code>it</code> as a whole, everything that’s done by previous show rules is not used, so you essentially discard all old show rules.</p>\n<p>Putting the <code>reset-counter(...)</code> show rule last fixes this, because then you first apply your custom design, and the <code>reset-counter(...)</code> show rules then makes</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">thecounter.update((0,))\nyourcustomdesign\n</code></pre>\n<p>out of this.</p>\n<p>Just for completeness, let me mention that there is a second counter package with a totally different approach, which might be of interest to you to avoid such problems: <a href=\"https://typst.app/universe/package/rich-counters/\">rich-counters</a></p>",
      "raw": "Ok I was talking BS, the order does matter for headcount. To fix your template, put the\n```typc\nshow heading: reset-counter(counter(figure.where(kind: image)))\n```\nafter all the other `heading` show rules (in particular after your \"custom heading design\").\n\n\n---\nIf you're interested, here is an explanation. The `reset-counter` show rule is something like this\n```typc\nit => {\n  thecounter.update((0,))\n  it\n}\n```\nwhere `thecounter` is the counter in the argument, so in this case the counter of `figure`. So it just resets the counter of `figure` and then displays the heading as usual.\n\nNow the question is, what happens if you put _another_ show rule for heading _below_ the one above. This will \"wrap around\" the show rule above, in the sense that `it` in the new show rule is actually:\n```typc\nthecounter.update((0,))\nheading(...)\n```\n\nSo if you just reuse `it` in your new show rule, everything will still be fine. For example, this still works:\n\n```typ\n#import \"@preview/headcount:0.1.0\": *\n\n#set heading(numbering: \"1.1\")\n#set figure(numbering: dependent-numbering(\"1.1\"))\n#show heading: reset-counter(counter(figure.where(kind: image)))\n\n// custom design\n#show heading: it => {\n  block(fill: green.lighten(20%), inset: 5pt, it)\n}\n\n= Introduction\n\n#figure([some figure], caption: [some caption])\n\n= Let's Go\n\n#figure([another figure], caption: [another caption])\n```\n\nThe problem now comes when, in your new show rules for your custom design, you do _not_ use (the full) `it`, but just for example `it.body`. For example, this doesn't work:\n```typ\n#import \"@preview/headcount:0.1.0\": *\n\n#set heading(numbering: \"1.1\")\n#set figure(numbering: dependent-numbering(\"1.1\"))\n#show heading: reset-counter(counter(figure.where(kind: image)))\n\n// custom design\n#show heading: it => [\n  #counter(heading).display() | #it.body\n]\n\n= Introduction\n\n#figure([some figure], caption: [some caption])\n\n= Let's Go\n\n#figure([another figure], caption: [another caption])\n```\nThe reason is that, because your don't use `it` as a whole, everything that's done by previous show rules is not used, so you essentially discard all old show rules.\n\nPutting the `reset-counter(...)` show rule last fixes this, because then you first apply your custom design, and the `reset-counter(...)` show rules then makes\n```typc\nthecounter.update((0,))\nyourcustomdesign\n```\nout of this.\n\nJust for completeness, let me mention that there is a second counter package with a totally different approach, which might be of interest to you to avoid such problems: [rich-counters](https://typst.app/universe/package/rich-counters/)",
      "reply_to_post_number": 9,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 21,
      "score": 174.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 218
    },
    {
      "id": 5815,
      "post_number": 11,
      "username": "PgBiel",
      "name": "",
      "created_at": "2024-11-19T00:44:00.314Z",
      "updated_at": "2024-11-19T00:44:00.314Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"Flexschmex\" data-post=\"9\" data-topic=\"1730\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/f/611D14/48.png\" class=\"avatar\"> Flexschmex:</div>\n<blockquote>\n<p>I would love to edit the title, but it seems like there is no option to.</p>\n</blockquote>\n</aside>\n<p>Indeed, this seems related to <a href=\"https://forum.typst.app/t/allow-editing-of-old-messages/1456\" class=\"inline-onebox\">✏ Allow editing of old messages</a> - it appears new users can only change the title within 24h. We will change it for you (sorry for the trouble). But please ensure future posts’ titles are full questions. Thank you <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "[quote=\"Flexschmex, post:9, topic:1730\"]\nI would love to edit the title, but it seems like there is no option to.\n[/quote]\n\nIndeed, this seems related to https://forum.typst.app/t/allow-editing-of-old-messages/1456 - it appears new users can only change the title within 24h. We will change it for you (sorry for the trouble). But please ensure future posts' titles are full questions. Thank you :slight_smile:",
      "reply_to_post_number": 9,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 0,
      "reads": 19,
      "score": 3.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    }
  ],
  "scraped_at": "2025-06-10T09:54:55.263311"
}