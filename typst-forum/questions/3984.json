{
  "topic_metadata": {
    "id": 3984,
    "title": "How to `show` an outline at each level 1 heading for all its child headings?",
    "slug": "how-to-show-an-outline-at-each-level-1-heading-for-all-its-child-headings",
    "posts_count": 4,
    "created_at": "2025-05-07T18:29:50.054Z",
    "last_posted_at": "2025-05-09T11:17:48.504Z",
    "views": 85,
    "like_count": 5,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 4,
    "accepted_answer_username": "Andrew",
    "tags": [
      "outline"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 398
  },
  "posts": [
    {
      "id": 12110,
      "post_number": 1,
      "username": "miles-1",
      "name": "miles",
      "created_at": "2025-05-07T18:29:50.214Z",
      "updated_at": "2025-05-13T17:19:48.389Z",
      "cooked": "<p>I am hoping to use a <code>show</code> rule to insert an outline at each level 1 heading, where these outlines only show the child headings of each level 1 heading. In other words (assuming no deeper heading levels than 2), for each level 1 heading there should be one outline which shows all the level 2 headings that occur before the next level 1 heading. The idea is like a section table of contents.</p>\n<p>I’ve found something that works, but I’m worried I’m overcomplicating things. <strong>Is there an easier way to do this?</strong></p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set heading(numbering: \"(1.1)\")\n\n#show heading.where(level:1): it =&gt; {\n  it\n  let future-level-1-headings = query(selector(heading.where(level:1)).after(here(), inclusive: false))\n  let child-heading-selector = selector(heading.where(level:2)).after(here())\n  outline(\n    title:none, \n    target: if future-level-1-headings.len() &gt; 0 {\n      child-heading-selector.before(future-level-1-headings.at(0).location())\n    } else {\n      child-heading-selector\n    }\n  )\n}\n\n=\n==\n==\n==\n=\n==\n==\n==\n=\n==\n==\n==\n</code></pre>\n<p>Here are some things I can see that would make this easier:</p>\n<ol>\n<li>a way to select children headers directly instead of between</li>\n<li>a <code>location</code> object like the one returned for <code>here()</code> except for the end of the document (would help simplify the <code>if</code> statement)</li>\n<li>a way to get the subsequent level one heading directly</li>\n</ol>\n<p><strong>Are any of these listed options possible in typst?</strong></p>",
      "raw": "I am hoping to use a `show` rule to insert an outline at each level 1 heading, where these outlines only show the child headings of each level 1 heading. In other words (assuming no deeper heading levels than 2), for each level 1 heading there should be one outline which shows all the level 2 headings that occur before the next level 1 heading. The idea is like a section table of contents.\n\nI've found something that works, but I'm worried I'm overcomplicating things. **Is there an easier way to do this?**\n\n```typst\n#set heading(numbering: \"(1.1)\")\n\n#show heading.where(level:1): it => {\n  it\n  let future-level-1-headings = query(selector(heading.where(level:1)).after(here(), inclusive: false))\n  let child-heading-selector = selector(heading.where(level:2)).after(here())\n  outline(\n    title:none, \n    target: if future-level-1-headings.len() > 0 {\n      child-heading-selector.before(future-level-1-headings.at(0).location())\n    } else {\n      child-heading-selector\n    }\n  )\n}\n\n=\n==\n==\n==\n=\n==\n==\n==\n=\n==\n==\n==\n```\n\nHere are some things I can see that would make this easier:\n1. a way to select children headers directly instead of between \n2. a `location` object like the one returned for `here()` except for the end of the document (would help simplify the `if` statement)\n3. a way to get the subsequent level one heading directly\n\n**Are any of these listed options possible in typst?**",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 155.6,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 177
    },
    {
      "id": 12111,
      "post_number": 2,
      "username": "janekfleper",
      "name": "Janek Fleper",
      "created_at": "2025-05-07T19:08:57.598Z",
      "updated_at": "2025-05-07T19:08:57.598Z",
      "cooked": "<p>You can use a show rule for the outline entries that hides the sections from other chapters. I will leave the decision whether this is simpler than your current solution up to you. <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show heading.where(level: 1): it =&gt; {\n  it\n\n  let heading-number = counter(heading).get().at(0)\n  show outline.entry: it =&gt; {\n    if counter(heading).at(it.element.location()).at(0) == heading-number { it }\n  }\n\n  outline(\n    title: none, \n    target: heading.where(level: 2)\n  )\n}\n</code></pre>\n<p>I would also ask you to change the category of your post to <a class=\"hashtag-cooked\" href=\"/c/questions/5\" data-type=\"category\" data-slug=\"questions\" data-id=\"5\"><span class=\"hashtag-icon-placeholder\"><svg class=\"fa d-icon d-icon-square-full svg-icon svg-node\"><use href=\"#square-full\"></use></svg></span><span>Questions</span></a>.</p>",
      "raw": "You can use a show rule for the outline entries that hides the sections from other chapters. I will leave the decision whether this is simpler than your current solution up to you. :slight_smile:\n\n```typ\n#show heading.where(level: 1): it => {\n  it\n\n  let heading-number = counter(heading).get().at(0)\n  show outline.entry: it => {\n    if counter(heading).at(it.element.location()).at(0) == heading-number { it }\n  }\n\n  outline(\n    title: none, \n    target: heading.where(level: 2)\n  )\n}\n```\n\nI would also ask you to change the category of your post to #questions.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 28,
      "score": 35.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 69
    },
    {
      "id": 12176,
      "post_number": 3,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-05-09T10:43:45.090Z",
      "updated_at": "2025-05-09T10:43:45.090Z",
      "cooked": "<p>For future reference, an unmaintained package exists under the name <a href=\"https://typst.app/universe/package/minitoc/\">“minitoc”</a>, which uses the first approach (query heading in-between).</p>\n<p>I find <a class=\"mention\" href=\"/u/janekfleper\">@janekfleper</a>’s approach much more elegant though!</p>",
      "raw": "For future reference, an unmaintained package exists under the name [\"minitoc\"](https://typst.app/universe/package/minitoc/), which uses the first approach (query heading in-between).\n\nI find @janekfleper's approach much more elegant though!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 9.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 12181,
      "post_number": 4,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-09T11:17:48.504Z",
      "updated_at": "2025-05-09T11:17:48.504Z",
      "cooked": "<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/suboutline:0.3.0\": suboutline\n#set heading(numbering: \"1.1.\")\n#show heading.where(level: 1): it =&gt; it + suboutline()\n\n= Heading\n== Heading\n#lorem(20)\n\n=== Heading\n#lorem(30)\n\n== Heading\n#lorem(10)\n\n= Heading 2\n== Heading\n#lorem(20)\n\n=== Heading\n#lorem(30)\n\n== Heading\n#lorem(10)\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/4/4dd01b864f88c9dc500315ff4696d84f9323aa4d.png\" data-download-href=\"https://forum.typst.app/uploads/default/4dd01b864f88c9dc500315ff4696d84f9323aa4d\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/4/4dd01b864f88c9dc500315ff4696d84f9323aa4d_2_352x374.png\" alt=\"image\" data-base62-sha1=\"b6mDhgY0BbdaIRZBhSjHfSJ1V8N\" width=\"352\" height=\"374\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/4/4dd01b864f88c9dc500315ff4696d84f9323aa4d_2_352x374.png, https://forum.typst.app/uploads/default/optimized/2X/4/4dd01b864f88c9dc500315ff4696d84f9323aa4d_2_528x561.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/4/4dd01b864f88c9dc500315ff4696d84f9323aa4d_2_704x748.png 2x\" data-dominant-color=\"0B0B0B\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">760×807 103 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "```typ\n#import \"@preview/suboutline:0.3.0\": suboutline\n#set heading(numbering: \"1.1.\")\n#show heading.where(level: 1): it => it + suboutline()\n\n= Heading\n== Heading\n#lorem(20)\n\n=== Heading\n#lorem(30)\n\n== Heading\n#lorem(10)\n\n= Heading 2\n== Heading\n#lorem(20)\n\n=== Heading\n#lorem(30)\n\n== Heading\n#lorem(10)\n```\n\n![image|470x499, 75%](upload://b6mDhgY0BbdaIRZBhSjHfSJ1V8N.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 3,
      "reads": 22,
      "score": 49.4,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    }
  ],
  "scraped_at": "2025-06-10T09:48:12.685678"
}