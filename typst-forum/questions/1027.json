{
  "topic_metadata": {
    "id": 1027,
    "title": "Why does counter(heading).display() get the wrong heading number after a pagebreak?",
    "slug": "why-does-counter-heading-display-get-the-wrong-heading-number-after-a-pagebreak",
    "posts_count": 4,
    "created_at": "2024-10-11T09:55:53.115Z",
    "last_posted_at": "2024-10-13T19:14:54.336Z",
    "views": 238,
    "like_count": 2,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Tinger",
    "tags": [
      "scripting",
      "page",
      "counter"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 338
  },
  "posts": [
    {
      "id": 3694,
      "post_number": 1,
      "username": "wulfheart",
      "name": "Alex",
      "created_at": "2024-10-11T09:55:53.225Z",
      "updated_at": "2024-10-12T20:48:29.156Z",
      "cooked": "<p>I have <code>#show heading.where(level: 1): it =&gt; { pagebreak(weak: true); it } </code> and the page is configured to display the current header:</p>\n<pre data-code-wrap=\"typc\"><code class=\"lang-typc\">set page(\n    margin: 3cm,\n    header: context {\n      counter(heading).display()\n    },\n    footer: context {\n      here().page()\n    }\n  )\n</code></pre>\n<p>However, I get the previous heading number even though it is not on the page (as seen in the image). How can I make it show the correct heading?</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/1X/c321283d502036689b966dff750ba5a4a6162d96.webp\" data-download-href=\"https://forum.typst.app/uploads/default/c321283d502036689b966dff750ba5a4a6162d96\" title=\"\"><img src=\"https://forum.typst.app/uploads/default/original/1X/c321283d502036689b966dff750ba5a4a6162d96.webp\" alt=\"\" data-base62-sha1=\"rQc91ZCGsC3Shku4UOQ9fEw0TuS\" role=\"presentation\" width=\"690\" height=\"150\" data-dominant-color=\"F7F7F7\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\"></span><span class=\"informations\">1094×239 3.02 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>",
      "raw": "I have `#show heading.where(level: 1): it => { pagebreak(weak: true); it } ` and the page is configured to display the current header:\n```typc\nset page(\n    margin: 3cm,\n    header: context {\n      counter(heading).display()\n    },\n    footer: context {\n      here().page()\n    }\n  )\n```\n\nHowever, I get the previous heading number even though it is not on the page (as seen in the image). How can I make it show the correct heading?\n\n![](upload://rQc91ZCGsC3Shku4UOQ9fEw0TuS.webp)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 44,
      "score": 393.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 568
    },
    {
      "id": 3720,
      "post_number": 2,
      "username": "Tinger",
      "name": "Tinger",
      "created_at": "2024-10-11T14:24:39.176Z",
      "updated_at": "2024-10-11T14:25:06.834Z",
      "cooked": "<p>Hey there, welcome to the forum!</p>\n<p>That’s the correct behavior, the heading counter at that location (the header) has not yet advanced, it advances at the next heading (below the header), this means it will display the <em>last</em> heading’s number.</p>\n<p>If you wish to show the number of the heading on this page you need to provide the location for this heading to the counter through the use of <code>query</code>/<code>locate</code>.</p>\n<p>You may be interested in <a href=\"https://typst.app/universe/package/hydra\" class=\"inline-onebox\">hydra – Typst Universe</a> (full disclosure, I’m the author), which would take care of the logic for selecting the correct heading and displaying it.</p>\n<p>In your case that would be:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set page(header: context hydra(use-last: true, skip-starting: false))\n</code></pre>\n<p>If you prefer a more manual approach you can take a peek at the source code and write it yourself, but it boils down to <code>query(heading)</code> and filtering out candidates that don’t fit (pages after the current one etc.).</p>\n<p>PS: Something I’ve also noticed is that you’re using <code>here().page()</code> in the footer, this will give you the actual page number, not the logical page number of the page counter. You probably meant to use <code>counter(page).display()</code></p>",
      "raw": "Hey there, welcome to the forum!\n\nThat's the correct behavior, the heading counter at that location (the header) has not yet advanced, it advances at the next heading (below the header), this means it will display the _last_ heading's number.\n\nIf you wish to show the number of the heading on this page you need to provide the location for this heading to the counter through the use of `query`/`locate`.\n\nYou may be interested in https://typst.app/universe/package/hydra (full disclosure, I'm the author), which would take care of the logic for selecting the correct heading and displaying it.\n\nIn your case that would be:\n```typ\n#set page(header: context hydra(use-last: true, skip-starting: false))\n```\n\nIf you prefer a more manual approach you can take a peek at the source code and write it yourself, but it boils down to `query(heading)` and filtering out candidates that don't fit (pages after the current one etc.).\n\nPS: Something I've also noticed is that you're using `here().page()` in the footer, this will give you the actual page number, not the logical page number of the page counter. You probably meant to use `counter(page).display()`",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 39,
      "score": 37.8,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 29
    },
    {
      "id": 3761,
      "post_number": 3,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2024-10-12T20:51:10.623Z",
      "updated_at": "2024-10-12T20:51:10.623Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/wulfheart\">@wulfheart</a>, thanks for your question! If you feel the response you got has sufficiently answered your question, be sure to give it a checkmark. This will help others find the solution in the future. Thanks!</p>",
      "raw": "Hi @wulfheart, thanks for your question! If you feel the response you got has sufficiently answered your question, be sure to give it a checkmark. This will help others find the solution in the future. Thanks!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 29,
      "score": 5.8,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 3829,
      "post_number": 4,
      "username": "wulfheart",
      "name": "Alex",
      "created_at": "2024-10-13T19:14:54.336Z",
      "updated_at": "2024-10-13T19:14:54.336Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/tinger\">@Tinger</a> thanks for your reply. I started using hydra because it was the easiest way. However, I would have thought that it would be simpler with typst. Thanks nevertheless!</p>",
      "raw": "@Tinger thanks for your reply. I started using hydra because it was the easiest way. However, I would have thought that it would be simpler with typst. Thanks nevertheless!",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 28,
      "score": 5.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 568
    }
  ],
  "scraped_at": "2025-06-10T09:57:04.503943"
}