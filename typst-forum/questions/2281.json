{
  "topic_metadata": {
    "id": 2281,
    "title": "How can I initialize a genealotree family tree using data from a toml file?",
    "slug": "how-can-i-initialize-a-genealotree-family-tree-using-data-from-a-toml-file",
    "posts_count": 4,
    "created_at": "2025-01-02T22:53:50.723Z",
    "last_posted_at": "2025-01-03T18:33:30.789Z",
    "views": 102,
    "like_count": 4,
    "reply_count": 2,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 4,
    "accepted_answer_username": "LordBaryhobal",
    "tags": [
      "scripting",
      "data-loading"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 899
  },
  "posts": [
    {
      "id": 7153,
      "post_number": 1,
      "username": "grimnight",
      "name": "grimnight",
      "created_at": "2025-01-02T22:53:50.841Z",
      "updated_at": "2025-01-31T08:34:16.982Z",
      "cooked": "<p>I’m unable to get my modified script to work.</p>\n<p>The original script works fine:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#import \"@preview/genealotree:0.2.0\": *\n// https://codeberg.org/drloiseau/genealogy\n\n#import \"@preview/cetz:0.3.1\": canvas, draw\n#import draw: *\n\n#set page(width: auto, height: auto, margin: 1cm)\n#set text(size: 11pt)\n\n#let family-tree = genealogy-init()\n\n#(family-tree.config.union-dist = 5.5)\n#(family-tree.config.siblings-dist = 8)\n#(family-tree.config.union-vline = 3)\n#(family-tree.config.person-radius = 2)\n\n#let family-tree = add-persons(\n  family-tree,\n  (\n    \"1\": (sex: \"m\", label: \"1 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"2\": (sex: \"f\", label: \"2 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"3\": (sex: \"m\", label: \"3 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"4\": (sex: \"f\", label: \"4 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"5\": (sex: \"f\", label: \"5 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"6\": (sex: \"m\", label: \"6 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"7\": (sex: \"m\", label: \"7 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"8\": (sex: \"f\", label: \"8 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"9\": (sex: \"f\", label: \"9 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"10\": (sex: \"m\", label: \"10 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"11\": (sex: \"m\", label: \"11 name lastname\\n\\nm: 0000\\nd: 0000\"),\n  )\n)\n\n#let family-tree = add-unions(\n  family-tree,\n  ((\"1\", \"2\"), (\"3\", \"5\")),\n  ((\"3\", \"4\"), ()),\n  ((\"5\", \"6\"), (\"7\",)),\n  ((\"7\", \"8\"), (\"9\", \"10\", \"11\")),\n)\n\n#canvas({\n    // Draw the tree\n    draw-tree(family-tree)\n})\n</code></pre>\n<p>But when I updated my script to get it’s data from an external toml file,<br>\nI can’t get it to work.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#import \"@preview/genealotree:0.2.0\": *\n// https://codeberg.org/drloiseau/genealogy\n\n#import \"@preview/cetz:0.3.1\": canvas, draw\n#import draw: *\n\n#set page(width: auto, height: auto, margin: 1cm)\n#set text(size: 11pt)\n\n#let family-tree = genealogy-init()\n\n#(family-tree.config.union-dist = 5.5)\n#(family-tree.config.siblings-dist = 8)\n#(family-tree.config.union-vline = 3)\n#(family-tree.config.person-radius = 2)\n\n#let gen = toml(\"gen.toml\")\n\n#for c in gen.family_tree [\n  #let family-tree = add-persons(\n    family-tree,\n    (str(c.id): (sex: c.sex, label: c.label))\n  )\n]\n\n#for c in gen.unions.unions [\n  #let family-tree = add-unions(family-tree, (c.at(0), c.at(1)))\n]\n\n#canvas({\n    // Draw the tree\n    draw-tree(family-tree)\n})\n</code></pre>\n<p>And the toml:</p>\n<pre data-code-wrap=\"toml\"><code class=\"lang-toml\"># gen.toml\n\n[unions]\nunions = [\n  [[\"1\", \"2\"], [\"3\", \"5\"]],\n  [[\"3\", \"4\"], []],\n  [[\"5\", \"6\"], [\"7\",]],\n  [[\"7\", \"8\"], [\"9\", \"10\", \"11\"]]\n]\n\n[[family_tree]]\nid = 1\nsex = \"m\"\nlabel = \"1 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 2\nsex = \"f\"\nlabel = \"2 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 3\nsex = \"m\"\nlabel = \"3 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 4\nsex = \"f\"\nlabel = \"4 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 5\nsex = \"f\"\nlabel = \"5 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 6\nsex = \"m\"\nlabel = \"6 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 7\nsex = \"m\"\nlabel = \"7 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 8\nsex = \"f\"\nlabel = \"8 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 9\nsex = \"f\"\nlabel = \"9 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 10\nsex = \"m\"\nlabel = \"10 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 11\nsex = \"m\"\nlabel = \"11 name lastname\\n\\nm: 0000\\nd: 0000\"\n</code></pre>\n<p>How can I get my script to work?</p>",
      "raw": "I'm unable to get my modified script to work.\n\nThe original script works fine:\n```typst\n#import \"@preview/genealotree:0.2.0\": *\n// https://codeberg.org/drloiseau/genealogy\n\n#import \"@preview/cetz:0.3.1\": canvas, draw\n#import draw: *\n\n#set page(width: auto, height: auto, margin: 1cm)\n#set text(size: 11pt)\n\n#let family-tree = genealogy-init()\n\n#(family-tree.config.union-dist = 5.5)\n#(family-tree.config.siblings-dist = 8)\n#(family-tree.config.union-vline = 3)\n#(family-tree.config.person-radius = 2)\n\n#let family-tree = add-persons(\n  family-tree,\n  (\n    \"1\": (sex: \"m\", label: \"1 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"2\": (sex: \"f\", label: \"2 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"3\": (sex: \"m\", label: \"3 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"4\": (sex: \"f\", label: \"4 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"5\": (sex: \"f\", label: \"5 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"6\": (sex: \"m\", label: \"6 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"7\": (sex: \"m\", label: \"7 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"8\": (sex: \"f\", label: \"8 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"9\": (sex: \"f\", label: \"9 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"10\": (sex: \"m\", label: \"10 name lastname\\n\\nm: 0000\\nd: 0000\"),\n    \"11\": (sex: \"m\", label: \"11 name lastname\\n\\nm: 0000\\nd: 0000\"),\n  )\n)\n\n#let family-tree = add-unions(\n  family-tree,\n  ((\"1\", \"2\"), (\"3\", \"5\")),\n  ((\"3\", \"4\"), ()),\n  ((\"5\", \"6\"), (\"7\",)),\n  ((\"7\", \"8\"), (\"9\", \"10\", \"11\")),\n)\n\n#canvas({\n    // Draw the tree\n    draw-tree(family-tree)\n})\n```\n\nBut when I updated my script to get it's data from an external toml file,\nI can't get it to work.\n```typst\n#import \"@preview/genealotree:0.2.0\": *\n// https://codeberg.org/drloiseau/genealogy\n\n#import \"@preview/cetz:0.3.1\": canvas, draw\n#import draw: *\n\n#set page(width: auto, height: auto, margin: 1cm)\n#set text(size: 11pt)\n\n#let family-tree = genealogy-init()\n\n#(family-tree.config.union-dist = 5.5)\n#(family-tree.config.siblings-dist = 8)\n#(family-tree.config.union-vline = 3)\n#(family-tree.config.person-radius = 2)\n\n#let gen = toml(\"gen.toml\")\n\n#for c in gen.family_tree [\n  #let family-tree = add-persons(\n    family-tree,\n    (str(c.id): (sex: c.sex, label: c.label))\n  )\n]\n\n#for c in gen.unions.unions [\n  #let family-tree = add-unions(family-tree, (c.at(0), c.at(1)))\n]\n\n#canvas({\n    // Draw the tree\n    draw-tree(family-tree)\n})\n```\n\nAnd the toml:\n```toml\n# gen.toml\n\n[unions]\nunions = [\n  [[\"1\", \"2\"], [\"3\", \"5\"]],\n  [[\"3\", \"4\"], []],\n  [[\"5\", \"6\"], [\"7\",]],\n  [[\"7\", \"8\"], [\"9\", \"10\", \"11\"]]\n]\n\n[[family_tree]]\nid = 1\nsex = \"m\"\nlabel = \"1 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 2\nsex = \"f\"\nlabel = \"2 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 3\nsex = \"m\"\nlabel = \"3 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 4\nsex = \"f\"\nlabel = \"4 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 5\nsex = \"f\"\nlabel = \"5 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 6\nsex = \"m\"\nlabel = \"6 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 7\nsex = \"m\"\nlabel = \"7 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 8\nsex = \"f\"\nlabel = \"8 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 9\nsex = \"f\"\nlabel = \"9 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 10\nsex = \"m\"\nlabel = \"10 name lastname\\n\\nm: 0000\\nd: 0000\"\n\n[[family_tree]]\nid = 11\nsex = \"m\"\nlabel = \"11 name lastname\\n\\nm: 0000\\nd: 0000\"\n```\n\nHow can I get my script to work?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 33,
      "score": 291.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1001
    },
    {
      "id": 7164,
      "post_number": 2,
      "username": "flokl",
      "name": "",
      "created_at": "2025-01-03T06:06:05.657Z",
      "updated_at": "2025-01-03T06:06:05.657Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/grimnight\">@grimnight</a>,</p>\n<p>please be more specific with your question, what is not working? Version 1/2 of what?<br>\nTry to reduce your code to a minimal example with the same error.<br>\nI suspect you mean that version 0.2.0 of the genealotree package which was updated yesterday is not working for you. That is correct, as every package always needs to be manually approved by the Typst team. Therefore, as indicated in the error message, the package is not yet available. Since a few package updates have accumulated over the holidays, I believe it will take a few days next week for version 0.2.0 of the package to become available.</p>",
      "raw": "Hi @grimnight,\n\nplease be more specific with your question, what is not working? Version 1/2 of what?\nTry to reduce your code to a minimal example with the same error.\nI suspect you mean that version 0.2.0 of the genealotree package which was updated yesterday is not working for you. That is correct, as every package always needs to be manually approved by the Typst team. Therefore, as indicated in the error message, the package is not yet available. Since a few package updates have accumulated over the holidays, I believe it will take a few days next week for version 0.2.0 of the package to become available.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 28,
      "score": 50.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 8
    },
    {
      "id": 7182,
      "post_number": 4,
      "username": "LordBaryhobal",
      "name": "Baryhobal",
      "created_at": "2025-01-03T17:54:25.813Z",
      "updated_at": "2025-01-03T17:54:25.813Z",
      "cooked": "<p>It seems like you are re-declaring your <code>family-tree</code> variable instead of re-assigning its value<br>\nThis is the end of your script:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let gen = toml(\"gen.toml\")\n \n#for c in gen.family_tree [\n  #let family-tree = add-persons(\n    family-tree,\n    (str(c.id): (sex: c.sex, label: c.label))\n  )\n]\n \n#for c in gen.unions.unions [\n  #let family-tree = add-unions(family-tree, (c.at(0), c.at(1)))\n]\n</code></pre>\n<p>Because of the <code>let</code> statements (and content blocks), the variable is never changed but re-declared for that specific block<br>\nYou cou rewrite it like so and it should work as expected (I haven’t tested it though):</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let gen = toml(\"gen.toml\")\n#let people = gen.family_tree.map(person =&gt; {\n  let id = str(person.id)\n  let value = (sex: person.sex, label: person.label)\n  return (id, value)\n}).to-dict()\n\n#let family-tree = add-persons(family-tree, people)\n#let family-tree = add-unions(family-tree, ..gen.unions.unions)\n</code></pre>\n<p>You can also write the last two lines as <code>#{family-tree = ...}</code></p>",
      "raw": "It seems like you are re-declaring your `family-tree` variable instead of re-assigning its value\nThis is the end of your script:\n```typ\n#let gen = toml(\"gen.toml\")\n \n#for c in gen.family_tree [\n  #let family-tree = add-persons(\n    family-tree,\n    (str(c.id): (sex: c.sex, label: c.label))\n  )\n]\n \n#for c in gen.unions.unions [\n  #let family-tree = add-unions(family-tree, (c.at(0), c.at(1)))\n]\n```\n\nBecause of the `let` statements (and content blocks), the variable is never changed but re-declared for that specific block\nYou cou rewrite it like so and it should work as expected (I haven't tested it though):\n```typ\n#let gen = toml(\"gen.toml\")\n#let people = gen.family_tree.map(person => {\n  let id = str(person.id)\n  let value = (sex: person.sex, label: person.label)\n  return (id, value)\n}).to-dict()\n\n#let family-tree = add-persons(family-tree, people)\n#let family-tree = add-unions(family-tree, ..gen.unions.unions)\n```\n\nYou can also write the last two lines as `#{family-tree = ...}`",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 23,
      "score": 29.6,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 585
    },
    {
      "id": 7183,
      "post_number": 5,
      "username": "grimnight",
      "name": "grimnight",
      "created_at": "2025-01-03T18:33:30.789Z",
      "updated_at": "2025-01-03T18:33:30.789Z",
      "cooked": "<p>Thank you <a class=\"mention\" href=\"/u/lordbaryhobal\">@LordBaryhobal</a> , I got it to work.</p>\n<p><a class=\"mention\" href=\"/u/flokl\">@flokl</a> and SillyFreak sorry, in hindsight I do realise that my request for help was poorly written.<br>\nI had been trying to get the script to work for a while and had been frustrated when I wrote my help request.</p>",
      "raw": "Thank you @LordBaryhobal , I got it to work.\n\n@flokl and SillyFreak sorry, in hindsight I do realise that my request for help was poorly written.\nI had been trying to get the script to work for a while and had been frustrated when I wrote my help request.",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 23,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1001
    }
  ],
  "scraped_at": "2025-06-10T09:53:12.840970"
}