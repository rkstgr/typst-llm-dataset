{
  "topic_metadata": {
    "id": 2786,
    "title": "How can I list all labels that aren't referenced in the document?",
    "slug": "how-can-i-list-all-labels-that-arent-referenced-in-the-document",
    "posts_count": 6,
    "created_at": "2025-02-12T10:13:13.893Z",
    "last_posted_at": "2025-02-12T13:46:35.169Z",
    "views": 197,
    "like_count": 4,
    "reply_count": 4,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "sijo",
    "tags": [
      "scripting",
      "referencing",
      "query"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 437
  },
  "posts": [
    {
      "id": 8500,
      "post_number": 1,
      "username": "yochem",
      "name": "Yochem van Rosmalen",
      "created_at": "2025-02-12T10:13:14.072Z",
      "updated_at": "2025-02-22T09:13:37.000Z",
      "cooked": "<p>Is there a way to list all labels without a reference? For example, using <code>typst query</code>? I would like to have a shell script that checks if my document contains figures that are not yet referenced in the text. Otherwise, just some scripting in the text is fine too.</p>\n<p>If you have a list of all labels in the documents, you could probably use parts of  the code example from the <a href=\"https://sitandr.github.io/typst-examples-book/book/snippets/labels.html#allow-missing-references\" rel=\"noopener nofollow ugc\">Typst examples book</a>. So is there a way to list all labels in the document?</p>",
      "raw": "Is there a way to list all labels without a reference? For example, using `typst query`? I would like to have a shell script that checks if my document contains figures that are not yet referenced in the text. Otherwise, just some scripting in the text is fine too.\n\nIf you have a list of all labels in the documents, you could probably use parts of  the code example from the [Typst examples book](https://sitandr.github.io/typst-examples-book/book/snippets/labels.html#allow-missing-references). So is there a way to list all labels in the document?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 35,
      "score": 792.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1182
    },
    {
      "id": 8506,
      "post_number": 2,
      "username": "sijo",
      "name": "",
      "created_at": "2025-02-12T11:21:59.221Z",
      "updated_at": "2025-02-12T12:51:37.836Z",
      "cooked": "<p>Hi, welcome to the Typst forum!</p>\n<p>I don’t think there’s a way to get all labels, but you can query for all elements of a particular type and see which label they have, so you can do something like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set math.equation(numbering: \"1.\")\n\n#let check-labels() = context {\n  let targets = query(ref).map(x =&gt; x.target)\n  let unreferenced = query(selector.or(\n    figure,\n    math.equation,\n    // ... add other referencable elements here\n  )).map(x =&gt; x.at(\"label\", default: none))\n    .filter(x =&gt; x != none and x not in targets)\n\n  if unreferenced.len() &gt; 0 {\n    set text(red)\n    [\n      Unreferenced labels: #unreferenced.map(str).join(\", \").\n      #metadata(unreferenced)&lt;unreferenced-labels&gt;\n    ]\n  }\n}\n\n#check-labels()\n\n$ x $&lt;eq1&gt;\n$ y $&lt;eq2&gt;\n$ z $&lt;eq3&gt;\n\nSee @eq2.\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/6/6f11f855be1d8aa9929035f3599ab03e5969dfd6.png\" data-download-href=\"https://forum.typst.app/uploads/default/6f11f855be1d8aa9929035f3599ab03e5969dfd6\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/6/6f11f855be1d8aa9929035f3599ab03e5969dfd6_2_690x158.png\" alt=\"image\" data-base62-sha1=\"fQzuZAjRMldtbfJ9Mvpgu7m1cDY\" width=\"690\" height=\"158\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/6/6f11f855be1d8aa9929035f3599ab03e5969dfd6_2_690x158.png, https://forum.typst.app/uploads/default/original/2X/6/6f11f855be1d8aa9929035f3599ab03e5969dfd6.png 1.5x, https://forum.typst.app/uploads/default/original/2X/6/6f11f855be1d8aa9929035f3599ab03e5969dfd6.png 2x\" data-dominant-color=\"FEFEFE\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">950×218 10.1 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>And to retrieve the list from the command-line: <code>typst query file.typ '&lt;unreferenced-labels&gt;</code></p>",
      "raw": "Hi, welcome to the Typst forum!\n\nI don't think there's a way to get all labels, but you can query for all elements of a particular type and see which label they have, so you can do something like this:\n\n```typ\n#set math.equation(numbering: \"1.\")\n\n#let check-labels() = context {\n  let targets = query(ref).map(x => x.target)\n  let unreferenced = query(selector.or(\n    figure,\n    math.equation,\n    // ... add other referencable elements here\n  )).map(x => x.at(\"label\", default: none))\n    .filter(x => x != none and x not in targets)\n\n  if unreferenced.len() > 0 {\n    set text(red)\n    [\n      Unreferenced labels: #unreferenced.map(str).join(\", \").\n      #metadata(unreferenced)<unreferenced-labels>\n    ]\n  }\n}\n\n#check-labels()\n\n$ x $<eq1>\n$ y $<eq2>\n$ z $<eq3>\n\nSee @eq2.\n```\n![image|690x158](upload://fQzuZAjRMldtbfJ9Mvpgu7m1cDY.png)\n\nAnd to retrieve the list from the command-line: `typst query file.typ '<unreferenced-labels>`",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 32,
      "score": 191.4,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 8508,
      "post_number": 3,
      "username": "yochem",
      "name": "Yochem van Rosmalen",
      "created_at": "2025-02-12T12:34:26.091Z",
      "updated_at": "2025-02-12T12:35:41.296Z",
      "cooked": "<p>Woow, that looks awesome! Thanks, it errors for me though, with the error “internal error when accessing field “label” in figure – this is a bug”. Full error:</p>\n<pre><code class=\"lang-auto\">error: internal error when accessing field \"label\" in figure – this is a bug\n   ┌─ thesis.typ:54:16\n   │\n54 │   )).map(x =&gt; x.label).filter(x =&gt; x != none and x not in targets)\n   │                 ^^^^^\n</code></pre>\n<p>This is also for <code>math.equation</code>, not just <code>figure</code>.</p>\n<p>I’m using typst 0.12.0. Any clue?</p>",
      "raw": "Woow, that looks awesome! Thanks, it errors for me though, with the error \"internal error when accessing field \"label\" in figure – this is a bug\". Full error:\n\n```\nerror: internal error when accessing field \"label\" in figure – this is a bug\n   ┌─ thesis.typ:54:16\n   │\n54 │   )).map(x => x.label).filter(x => x != none and x not in targets)\n   │                 ^^^^^\n```\n\nThis is also for `math.equation`, not just `figure`.\n\nI'm using typst 0.12.0. Any clue?",
      "reply_to_post_number": 2,
      "reply_count": 2,
      "quote_count": 0,
      "like_count": 0,
      "reads": 25,
      "score": 15.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1182
    },
    {
      "id": 8509,
      "post_number": 4,
      "username": "sijo",
      "name": "",
      "created_at": "2025-02-12T12:52:34.626Z",
      "updated_at": "2025-02-12T15:27:53.331Z",
      "cooked": "<p><s>It seems that equations have a <code>label</code> field even when no label is defined (so it was working in my example) but figures not.</s> (Edit: ah no I just hadn’t tested the case without label!)</p>\n<p>I have edited my code to handle this correctly.</p>",
      "raw": "~~It seems that equations have a `label` field even when no label is defined (so it was working in my example) but figures not.~~ (Edit: ah no I just hadn't tested the case without label!)\n\nI have edited my code to handle this correctly.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 21,
      "score": 34.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 8510,
      "post_number": 5,
      "username": "quachpas",
      "name": "Pascal Quach",
      "created_at": "2025-02-12T12:54:54.578Z",
      "updated_at": "2025-02-12T12:55:29.018Z",
      "cooked": "<p>Alternatively, if you want to do that it’s probably more efficient better from outside Typst.</p>\n<p>For people with a Linux environment, it’s probably doable with</p>\n<pre data-code-wrap=\"shell\"><code class=\"lang-shell\">grep -Eo '&lt;(.*?)&gt;' doc.typ | sed 's/[&lt;&gt;]//g' | xargs -I {} sh -c \"printf {} &amp;&amp; grep -o '@{}' doc.typ | wc -c | grep 0\"\n</code></pre>\n<p>which will give you all labels with 0 references.</p>",
      "raw": "Alternatively, if you want to do that it's probably more efficient better from outside Typst.\n\nFor people with a Linux environment, it's probably doable with\n```shell\ngrep -Eo '<(.*?)>' doc.typ | sed 's/[<>]//g' | xargs -I {} sh -c \"printf {} && grep -o '@{}' doc.typ | wc -c | grep 0\"\n```\nwhich will give you all labels with 0 references.",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 9.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 258
    },
    {
      "id": 8512,
      "post_number": 6,
      "username": "yochem",
      "name": "Yochem van Rosmalen",
      "created_at": "2025-02-12T13:46:35.169Z",
      "updated_at": "2025-02-12T13:46:35.169Z",
      "cooked": "<p>Thanks for your suggestion. I tried that route too, but I have some labels that get generated dynamically, so this wouldn’t work.</p>",
      "raw": "Thanks for your suggestion. I tried that route too, but I have some labels that get generated dynamically, so this wouldn't work.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 15,
      "score": 23.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1182
    }
  ],
  "scraped_at": "2025-06-10T09:51:45.291930"
}