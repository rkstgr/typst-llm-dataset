{
  "topic_metadata": {
    "id": 2277,
    "title": "How to use custom counters in heading titles?",
    "slug": "how-to-use-custom-counters-in-heading-titles",
    "posts_count": 4,
    "created_at": "2025-01-02T15:31:37.035Z",
    "last_posted_at": "2025-01-03T11:41:21.826Z",
    "views": 209,
    "like_count": 1,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "janekfleper",
    "tags": [
      "outline",
      "counter",
      "context"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 477
  },
  "posts": [
    {
      "id": 7149,
      "post_number": 1,
      "username": "rincewind",
      "name": "rincewind",
      "created_at": "2025-01-02T15:31:37.175Z",
      "updated_at": "2025-01-03T11:45:25.448Z",
      "cooked": "<p>Hello dear people,<br>\nI have the following problem and didn’t yet find an answer here:</p>\n<p>I have a document with special sections for excercises (called “labs” here) and<br>\nI would like to have them numbered.</p>\n<p>So, ich have chapter 1 with three labs (1, 2 and 3) , chapter 2 with 2 labs  (4 and 5) and so on.<br>\nThere is the <code>counter</code> type, easy.</p>\n<p>The problem starts with the <code>outline</code>, it should be</p>\n<pre><code class=\"lang-auto\">1. chapter 1: foo\n    1.1 Lab 1: fizz\n    1.2 Lab 2: buzz\n    1.3 Lab 3: fizzbuzz\n2.chapter 2: bar\n    2.1 Lab 4: blafoo\n    2.2 Lab 5: foobla\n</code></pre>\n<p>but acutally it compiles to</p>\n<pre><code class=\"lang-auto\">1. chapter 1: foo\n    1.1 Lab 0: fizz\n    1.2 Lab 0: buzz\n    1.3 Lab 0: fizzbuzz\n2.chapter 2: bar\n    2.1 Lab 0: blafoo\n    2.2 Lab 0: foobla\n</code></pre>\n<p>The code looks kind like this (try to condense it):</p>\n<p><em>theme/utils file</em></p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let labCounter = counter(\"lab\")\n#let lab-slide(title: []) = {\n  labCounter.step()\n  heading([Lab #context labCounter.display(): #title)\n  ...\n}\n</code></pre>\n<p>and the  <em>main file</em></p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">...\n#outline()\n\n#include(\"./chapter1.typ\")\n#include(\"./chapter2.typ\")\n</code></pre>\n<p>and then <em>chapter1.typ</em></p>\n<pre><code class=\"lang-auto\">...\n#lab-slide(title: \"Try this for real\")\n...\n</code></pre>\n<p>I hope, this is understandable and that someone is able to tell me where<br>\nI am holding it the wrong way around.</p>\n<p>Thanks <img src=\"https://forum.typst.app/images/emoji/apple/slight_smile.png?v=12\" title=\":slight_smile:\" class=\"emoji\" alt=\":slight_smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hello dear people,\nI have the following problem and didn't yet find an answer here:\n\nI have a document with special sections for excercises (called \"labs\" here) and\nI would like to have them numbered.\n\nSo, ich have chapter 1 with three labs (1, 2 and 3) , chapter 2 with 2 labs  (4 and 5) and so on.\nThere is the `counter` type, easy.\n\nThe problem starts with the `outline`, it should be\n\n```\n1. chapter 1: foo\n    1.1 Lab 1: fizz\n    1.2 Lab 2: buzz\n    1.3 Lab 3: fizzbuzz\n2.chapter 2: bar\n    2.1 Lab 4: blafoo\n    2.2 Lab 5: foobla\n```\n\nbut acutally it compiles to\n\n```\n1. chapter 1: foo\n    1.1 Lab 0: fizz\n    1.2 Lab 0: buzz\n    1.3 Lab 0: fizzbuzz\n2.chapter 2: bar\n    2.1 Lab 0: blafoo\n    2.2 Lab 0: foobla\n```\n\nThe code looks kind like this (try to condense it):\n\n_theme/utils file_\n```typ\n#let labCounter = counter(\"lab\")\n#let lab-slide(title: []) = {\n  labCounter.step()\n  heading([Lab #context labCounter.display(): #title)\n  ...\n}\n```\n\nand the  _main file_\n```typ\n...\n#outline()\n\n#include(\"./chapter1.typ\")\n#include(\"./chapter2.typ\")\n```\n\nand then _chapter1.typ_\n\n```\n...\n#lab-slide(title: \"Try this for real\")\n...\n```\n\nI hope, this is understandable and that someone is able to tell me where\nI am holding it the wrong way around.\n\nThanks :slight_smile:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 38,
      "score": 552.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 999
    },
    {
      "id": 7155,
      "post_number": 2,
      "username": "janekfleper",
      "name": "Janek Fleper",
      "created_at": "2025-01-03T01:14:48.284Z",
      "updated_at": "2025-01-03T01:14:48.284Z",
      "cooked": "<p>The outline always uses the value of the <code>labCounter</code> in the current context. Since the outline is located before any of the lab slides, the counter will just be 0.</p>\n<p>If you place the entire <code>heading()</code> into the <code>context</code>, the heading titles are displayed correctly in the outline.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set heading(numbering: \"1.1\")\n#let lab-counter = counter(\"lab\")\n\n#let lab-slide(title) = {\n  lab-counter.step()\n  context { heading(level: 2, [Lab #lab-counter.display(): #title]) }\n}\n\n#outline(indent: auto)\n\n= foo\n#lab-slide(\"fizz\")\n#lab-slide(\"buzz\")\n#lab-slide(\"fizzbuzz\")\n\n= bar\n#lab-slide(\"blafoo\")\n#lab-slide(\"foobla\")\n</code></pre>\n<p>I am not sure about the technical reasons for this behavior. The outline just seems to grab all the headings and it does not care if the function <code>heading()</code> was called in a specific context? I created a minimal example project to show this behavior <a href=\"https://typst.app/project/rU4Lkrb3loExfczupW0RG8\">here</a>. If you hover over the <code>it</code> inside the show rule for the outline entries, the <code>context()</code> is not mentioned anywhere. In your case the <code>entry.heading.body</code> would be <code>sequence([Lab], [ ], context(), [:], [ ], [fizz])</code>.</p>",
      "raw": "The outline always uses the value of the `labCounter` in the current context. Since the outline is located before any of the lab slides, the counter will just be 0.\n\nIf you place the entire `heading()` into the `context`, the heading titles are displayed correctly in the outline.\n\n```typ\n#set heading(numbering: \"1.1\")\n#let lab-counter = counter(\"lab\")\n\n#let lab-slide(title) = {\n  lab-counter.step()\n  context { heading(level: 2, [Lab #lab-counter.display(): #title]) }\n}\n\n#outline(indent: auto)\n\n= foo\n#lab-slide(\"fizz\")\n#lab-slide(\"buzz\")\n#lab-slide(\"fizzbuzz\")\n\n= bar\n#lab-slide(\"blafoo\")\n#lab-slide(\"foobla\")\n```\n\nI am not sure about the technical reasons for this behavior. The outline just seems to grab all the headings and it does not care if the function `heading()` was called in a specific context? I created a minimal example project to show this behavior [here](https://typst.app/project/rU4Lkrb3loExfczupW0RG8). If you hover over the `it` inside the show rule for the outline entries, the `context()` is not mentioned anywhere. In your case the `entry.heading.body` would be `sequence([Lab], [ ], context(), [:], [ ], [fizz])`.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 27,
      "score": 130.4,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 69
    },
    {
      "id": 7168,
      "post_number": 3,
      "username": "rincewind",
      "name": "rincewind",
      "created_at": "2025-01-03T08:40:47.344Z",
      "updated_at": "2025-01-03T08:40:47.344Z",
      "cooked": "<p>Ha, works like a charm :-) Thanks <a class=\"mention\" href=\"/u/janekfleper\">@janekfleper</a> for the quick answer.</p>",
      "raw": "Ha, works like a charm :-) Thanks @janekfleper for the quick answer.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 4.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 999
    },
    {
      "id": 7170,
      "post_number": 4,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-01-03T11:41:21.826Z",
      "updated_at": "2025-01-03T11:42:48.746Z",
      "cooked": "<p>This problem also looks similar to the following:</p><aside class=\"quote quote-modified\" data-post=\"3\" data-topic=\"2215\">\n  <div class=\"title\">\n    <div class=\"quote-controls\"></div>\n    <img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/p/F64C96/48.png\" class=\"avatar\">\n    <a href=\"https://forum.typst.app/t/how-to-avoid-a-reset-to-the-third-level-heading-counter-after-changing-the-first-two-levels/2215/3\">How to avoid a reset to the third-level heading counter after changing the first two levels?</a> <a class=\"badge-category__wrapper \" href=\"/c/questions/5\"><span data-category-id=\"5\" style=\"--category-badge-color: #F7C000; --category-badge-text-color: #fdfdfd;\" data-drop-close=\"true\" class=\"badge-category \" title=\"Your questions about using Typst and the web app go in this category.\"><span class=\"badge-category__name\">Questions</span></span></a>\n  </div>\n  <blockquote>\n    Due to automatic counter step behavior when placing any heading, I’d recommend using a separate counter which you manually control, like below. \nNote that I’ve taken the additional step of updating the heading counter to ensure it is consistent with the separate counter, ensuring we don’t have to rebuild headings entirely to start using the new counter, but rather keep headings as they are, using counter(heading) like they always do. This also ensures they show up correctly in the outline withou…\n  </blockquote>\n</aside>\n\n<p>The difference is, that post is about the proper heading numbering, while here you want the number as part of the title. Maybe it still helps or gives you more ideas.</p>",
      "raw": "This problem also looks similar to the following:\nhttps://forum.typst.app/t/how-to-avoid-a-reset-to-the-third-level-heading-counter-after-changing-the-first-two-levels/2215/3?u=sillyfreak\n\nThe difference is, that post is about the proper heading numbering, while here you want the number as part of the title. Maybe it still helps or gives you more ideas.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 244.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    }
  ],
  "scraped_at": "2025-06-10T09:53:13.632073"
}