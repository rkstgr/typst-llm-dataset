{
  "topic_metadata": {
    "id": 4062,
    "title": "How to avoid horizontal stacks shifting margins?",
    "slug": "how-to-avoid-horizontal-stacks-shifting-margins",
    "posts_count": 7,
    "created_at": "2025-05-13T11:07:22.385Z",
    "last_posted_at": "2025-05-14T18:16:55.155Z",
    "views": 49,
    "like_count": 4,
    "reply_count": 3,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 3,
    "accepted_answer_username": "Andrew",
    "tags": [
      "layout"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 548
  },
  "posts": [
    {
      "id": 12379,
      "post_number": 1,
      "username": "retroflexivity",
      "name": "",
      "created_at": "2025-05-13T11:07:22.530Z",
      "updated_at": "2025-05-13T11:19:02.231Z",
      "cooked": "<p>I am not certain whether it is intended or a bug, but, when using <code>stack</code> with a horizontal direction, max width is calculated for each element independently, resulting in a shifted right page margin.</p>\n<p>E.g. the following code</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">this is a #h(1fr) normal paragraph\n#stack(dir: ltr, \"(1) \", [this is a #h(1fr) stack])\n</code></pre>\n<p>results in the following placing:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/c/cfab358c57ef34b48091620f11b4f00428fa50b5.png\" data-download-href=\"https://forum.typst.app/uploads/default/cfab358c57ef34b48091620f11b4f00428fa50b5\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/c/cfab358c57ef34b48091620f11b4f00428fa50b5_2_690x72.png\" alt=\"image\" data-base62-sha1=\"tD7EjV8fenPkQm0fgUhFAYPp0lT\" width=\"690\" height=\"72\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/c/cfab358c57ef34b48091620f11b4f00428fa50b5_2_690x72.png, https://forum.typst.app/uploads/default/original/2X/c/cfab358c57ef34b48091620f11b4f00428fa50b5.png 1.5x, https://forum.typst.app/uploads/default/original/2X/c/cfab358c57ef34b48091620f11b4f00428fa50b5.png 2x\" data-dominant-color=\"FCFCFC\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">917×96 11.6 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>The right margin of the stack is shifted to the right by the width of <code>(1) </code>. (should be noted that this is not <code>fr</code>-specific and affects line breaking as well)</p>\n<p>If this is indeed intended, my question is, what, if not <code>stack</code>, should be used for creation of e.g. custom list-like layouts?</p>",
      "raw": "I am not certain whether it is intended or a bug, but, when using `stack` with a horizontal direction, max width is calculated for each element independently, resulting in a shifted right page margin.\n\nE.g. the following code\n```typ\nthis is a #h(1fr) normal paragraph\n#stack(dir: ltr, \"(1) \", [this is a #h(1fr) stack])\n```\nresults in the following placing:\n\n![image|690x72](upload://tD7EjV8fenPkQm0fgUhFAYPp0lT.png)\n\nThe right margin of the stack is shifted to the right by the width of `(1) `. (should be noted that this is not `fr`-specific and affects line breaking as well)\n\nIf this is indeed intended, my question is, what, if not `stack`, should be used for creation of e.g. custom list-like layouts?",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 14.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1590
    },
    {
      "id": 12381,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-13T11:16:59.835Z",
      "updated_at": "2025-05-13T11:20:20.425Z",
      "cooked": "<p>Hello. Please read <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a> before posting a question (from <a href=\"https://forum.typst.app/t/welcome-to-the-typst-forum/5\">the pinned topic</a>).</p>\n<aside class=\"quote no-group quote-modified\" data-username=\"reknih\" data-post=\"1\" data-topic=\"11\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/reknih/48/3_2.png\" class=\"avatar\"><a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11/1\">How to post in the Questions category</a></div>\n<blockquote>\n<p>If your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ … ````. It will then look like this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n</code></pre>\n<p>If you need to highlight a code or math mode snippet instead, the language tags <code>typc</code> and <code>typm</code> do that, respectively.</p>\n</blockquote>\n</aside>",
      "raw": "Hello. Please read https://forum.typst.app/t/how-to-post-in-the-questions-category/11 before posting a question (from [the pinned topic](https://forum.typst.app/t/welcome-to-the-typst-forum/5)).\n\n[quote=\"reknih, post:1, topic:11\"]\nIf your question pertains to a bit of Typst markup you have problems with, put it in the question body! You can syntax-highlight Typst code by wrapping it in ` ```typ ... ````. It will then look like this:\n\n```typ\n#set font(size: 12pt)\n\nHello from *Typst* at $ pi.var + 1 $ o'clock!\n```\n\nIf you need to highlight a code or math mode snippet instead, the language tags `typc` and `typm` do that, respectively.\n[/quote]",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 18,
      "score": 18.6,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12382,
      "post_number": 3,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-13T11:25:26.896Z",
      "updated_at": "2025-05-13T12:24:30.343Z",
      "cooked": "<p>Hmm, I think it is a bug, since by default everything must follow the set margins. You should open an issue about it.</p>\n<aside class=\"quote no-group\" data-username=\"retroflexivity\" data-post=\"1\" data-topic=\"4062\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/r/B9312D/48.png\" class=\"avatar\"> retroflexivity:</div>\n<blockquote>\n<p>If this is indeed intended, my question is, what, if not <code>stack</code>, should be used for creation of e.g. custom list-like layouts?</p>\n</blockquote>\n</aside>\n<p>It depends on how your list layout supposed to work. Internally, lists are implemented through grid. <a href=\"https://github.com/typst/typst/blob/ad539ef4ed0551a7eb22f7c9c0ab1c0fd1b59209/crates/typst-layout/src/lists.rs?plain=1#L156-L168\" class=\"inline-onebox\">typst/crates/typst-layout/src/lists.rs at ad539ef4ed0551a7eb22f7c9c0ab1c0fd1b59209 · typst/typst · GitHub</a></p>\n<hr>\n<aside class=\"onebox githubissue\" data-onebox-src=\"https://github.com/typst/typst/issues/6275\">\n  <header class=\"source\">\n\n      <a href=\"https://github.com/typst/typst/issues/6275\" target=\"_blank\" rel=\"noopener\">github.com/typst/typst</a>\n  </header>\n\n  <article class=\"onebox-body\">\n    <div class=\"github-row\">\n  <div class=\"github-icon-container\" title=\"Issue\" data-github-private-repo=\"false\">\n\t  <svg width=\"60\" height=\"60\" class=\"github-icon\" viewBox=\"0 0 14 16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg>\n  </div>\n\n  <div class=\"github-info-container\">\n    <h4>\n      <a href=\"https://github.com/typst/typst/issues/6275\" target=\"_blank\" rel=\"noopener\">Horizontal stacks shift right margin</a>\n    </h4>\n\n    <div class=\"github-info\">\n      <div class=\"date\">\n        opened <span class=\"discourse-local-date\" data-format=\"ll\" data-date=\"2025-05-13\" data-time=\"11:41:05\" data-timezone=\"UTC\">11:41AM - 13 May 25 UTC</span>\n      </div>\n\n\n      <div class=\"user\">\n        <a href=\"https://github.com/retroflexivity\" target=\"_blank\" rel=\"noopener\">\n          <img alt=\"retroflexivity\" src=\"https://forum.typst.app/uploads/default/original/2X/a/a26717168c90776752b0e26a8e637a97b25bb5df.png\" class=\"onebox-avatar-inline\" width=\"20\" height=\"20\" data-dominant-color=\"ECE0C5\">\n          retroflexivity\n        </a>\n      </div>\n    </div>\n\n    <div class=\"labels\">\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          bug\n        </span>\n        <span style=\"display:inline-block;margin-top:2px;background-color: #B8B8B8;padding: 2px;border-radius: 4px;color: #fff;margin-left: 3px;\">\n          layout\n        </span>\n    </div>\n  </div>\n</div>\n\n  <div class=\"github-row\">\n    <p class=\"github-body-container\">### Description\n\nWhen using `stack` with a horizontal direction, max width seems<span class=\"show-more-container\"><a href=\"\" rel=\"noopener\" class=\"show-more\">…</a></span><span class=\"excerpt hidden\"> to be equal to the stack's max width for every element, resulting in a shifted right page margin.\n\nE.g. the following code\n```typ\nthis is a #h(1fr) normal paragraph\n#stack(dir: ltr, \"(1) \", [this is a #h(1fr) stack])\n```\nresults in the following layout:\n\n![Image](https://github.com/user-attachments/assets/6c0cd70e-37bc-43d8-88ec-a945e7778947)\n\n\nThe right margin of the stack is shifted to the right by the width of `(1) `.\n\n### Operating system\n\nLinux\n\n### Typst version\n\n- [x] I am using the latest version of Typst</span></p>\n  </div>\n\n  </article>\n\n  <div class=\"onebox-metadata\">\n    \n    \n  </div>\n\n  <div style=\"clear: both\"></div>\n</aside>\n",
      "raw": "Hmm, I think it is a bug, since by default everything must follow the set margins. You should open an issue about it.\n\n[quote=\"retroflexivity, post:1, topic:4062\"]\nIf this is indeed intended, my question is, what, if not `stack`, should be used for creation of e.g. custom list-like layouts?\n[/quote]\n\nIt depends on how your list layout supposed to work. Internally, lists are implemented through grid. https://github.com/typst/typst/blob/ad539ef4ed0551a7eb22f7c9c0ab1c0fd1b59209/crates/typst-layout/src/lists.rs?plain=1#L156-L168\n\n---\n\nhttps://github.com/typst/typst/issues/6275",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 19,
      "score": 8.8,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12383,
      "post_number": 4,
      "username": "retroflexivity",
      "name": "",
      "created_at": "2025-05-13T11:35:34.734Z",
      "updated_at": "2025-05-13T11:35:34.734Z",
      "cooked": "<p>Thank you! Grids do seem more suitable, and avoid the bug.</p>\n<p>I’ll file an issue right away.</p>",
      "raw": "Thank you! Grids do seem more suitable, and avoid the bug.\n\nI'll file an issue right away.",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 19,
      "score": 23.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1590
    },
    {
      "id": 12456,
      "post_number": 5,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-05-14T14:46:58.357Z",
      "updated_at": "2025-05-14T14:46:58.357Z",
      "cooked": "<p>Also relevant, <a href=\"https://discord.com/channels/1054443721975922748/1296208677371379813\">this Discord discussion</a>:</p>\n<aside class=\"quote no-group\" data-username=\"laurmaedje\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/laurmaedje/48/14_2.png\" class=\"avatar\"> laurmaedje:</div>\n<blockquote>\n<p>TLDR: Stacks haven’t really been touched in ~2 years and are wonky and broken</p>\n<p>– <a href=\"https://discord.com/channels/1054443721975922748/1296208677371379813/1296209145623740489\">Discord</a>, <span class=\"discourse-local-date\" data-date=\"2024-10-16\" data-email-preview=\"2024-10-16T00:00:00Z UTC\">2024-10-16T00:00:00Z</span></p>\n</blockquote>\n</aside>\n<p>It’s definitely still an issue, but I’d just prefer grid out of principle. I’m not aware of something that can be done with a stack, but not a grid.</p>",
      "raw": "Also relevant, [this Discord discussion](https://discord.com/channels/1054443721975922748/1296208677371379813):\n\n[quote=\"laurmaedje\"]\nTLDR: Stacks haven't really been touched in ~2 years and are wonky and broken\n\n-- [Discord](https://discord.com/channels/1054443721975922748/1296208677371379813/1296209145623740489), [date=2024-10-16]\n[/quote]\n\nIt's definitely still an issue, but I'd just prefer grid out of principle. I'm not aware of something that can be done with a stack, but not a grid.",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 16,
      "score": 23.2,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    },
    {
      "id": 12465,
      "post_number": 6,
      "username": "retroflexivity",
      "name": "",
      "created_at": "2025-05-14T18:10:11.023Z",
      "updated_at": "2025-05-14T18:10:11.023Z",
      "cooked": "<p>Yeah, I’ve switched to a grid already and it’s working great, thank you</p>\n<p>Which leads me to a question: why is stack a thing anyway, given there is grid?</p>\n<p>(sorry if it’s not ok to bump a closed topic)</p>",
      "raw": "Yeah, I've switched to a grid already and it's working great, thank you\n\nWhich leads me to a question: why is stack a thing anyway, given there is grid?\n\n(sorry if it's not ok to bump a closed topic)",
      "reply_to_post_number": 5,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 15,
      "score": 8.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1590
    },
    {
      "id": 12468,
      "post_number": 7,
      "username": "SillyFreak",
      "name": "SillyFreak",
      "created_at": "2025-05-14T18:16:55.155Z",
      "updated_at": "2025-05-14T18:16:55.155Z",
      "cooked": "<p>It’s just a small follow-up, so not too bad imo.</p>\n<p>I assume just history. At some point the two functions were considered to be solutions for different use cases (and the defaults of the two may still support that view), but once grid became the “dominant” tool for this kind of task, development of stack stalled. Since you have to actively spend effort to remove something (not just the code, deprecation first and then updating the docs) it just didn’t happen yet.</p>",
      "raw": "It's just a small follow-up, so not too bad imo.\n\nI assume just history. At some point the two functions were considered to be solutions for different use cases (and the defaults of the two may still support that view), but once grid became the \"dominant\" tool for this kind of task, development of stack stalled. Since you have to actively spend effort to remove something (not just the code, deprecation first and then updating the docs) it just didn't happen yet.",
      "reply_to_post_number": 6,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 15,
      "score": 18.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 32
    }
  ],
  "scraped_at": "2025-06-10T09:47:53.516768"
}