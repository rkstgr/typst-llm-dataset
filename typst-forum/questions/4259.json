{
  "topic_metadata": {
    "id": 4259,
    "title": "Is there a cleaner way to draw a heatmap using Lilaq?",
    "slug": "is-there-a-cleaner-way-to-draw-a-heatmap-using-lilaq",
    "posts_count": 4,
    "created_at": "2025-05-24T04:47:47.101Z",
    "last_posted_at": "2025-05-24T21:24:11.109Z",
    "views": 128,
    "like_count": 7,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "Andrew",
    "tags": [
      "lilaq"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 621
  },
  "posts": [
    {
      "id": 13060,
      "post_number": 1,
      "username": "Dmitriy",
      "name": "Dmitriy",
      "created_at": "2025-05-24T04:47:47.205Z",
      "updated_at": "2025-05-24T16:00:12.926Z",
      "cooked": "<p>Hello,</p>\n<p>my current solution is this:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let words = (\n  \"first\",\n  \"second\",\n  \"third\",\n  \"fourth\",\n  \"fifth\",\n  \"sixth\",\n  \"seventh\",\n  \"eighth\",\n  \"ninth\",\n  \"tenth\",\n  \"eleventh\",\n  \"tvelveth\"\n);\n#let len = words.len()\n\n#let dia = lq.diagram(\n  width: 10cm, height: 10cm,\n  lq.colormesh(\n    lq.linspace(0, len - 1, num: len),\n    lq.linspace(0, len - 1, num: len),\n    (x, y) =&gt; x * y, // for illustration purposes, for real data use the array\n        // data\n        //  .at(calc.floor(y))\n        //  .at(calc.floor(x)),\n    map: color.map.viridis\n  ),\n\n  xaxis: (\n    ticks: words.map(rotate.with(-90deg, reflow: true)).enumerate(),\n    subticks: none,\n    position: top,\n  ),\n\n  yaxis: (\n    ticks: words.enumerate(),\n    subticks: none,\n    inverted: true,\n  ),\n)\n\n#let legend = lq.diagram(\n  width: 0.25cm,\n  height: 10cm,\n  lq.colormesh(\n    interpolation: \"smooth\",\n    lq.linspace(0, 1),\n    lq.linspace(0, 1),\n    (x, y) =&gt; y\n  ),\n  xaxis: none,\n  yaxis: (\n    position: right,\n    subticks: none,\n    tick-distance: 0.2,\n  )\n)\n\n#figure(\n  grid(\n    align: bottom,\n    gutter: 0.5cm,\n    columns: 2,\n    dia,\n    legend,\n  ),\n  scope: \"parent\",\n  placement: auto,\n  caption: [My heatmap]\n) &lt;heat-map&gt;\n</code></pre>\n<p>And the result looks something like this:<br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/5/5ceccba2e98998d55d277ff19f6b7cd10a25f640.png\" data-download-href=\"https://forum.typst.app/uploads/default/5ceccba2e98998d55d277ff19f6b7cd10a25f640\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/5/5ceccba2e98998d55d277ff19f6b7cd10a25f640_2_277x250.png\" alt=\"image\" data-base62-sha1=\"dg3g4nktwukklYHTSYC7g7EFlkY\" width=\"277\" height=\"250\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/5/5ceccba2e98998d55d277ff19f6b7cd10a25f640_2_277x250.png, https://forum.typst.app/uploads/default/optimized/2X/5/5ceccba2e98998d55d277ff19f6b7cd10a25f640_2_415x375.png 1.5x, https://forum.typst.app/uploads/default/optimized/2X/5/5ceccba2e98998d55d277ff19f6b7cd10a25f640_2_554x500.png 2x\" data-dominant-color=\"7B7B9C\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">1153×1038 64.3 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>Still, something tells me this can be implemented easier and cleaner. Any suggestions?</p>",
      "raw": "Hello,\n\nmy current solution is this:\n\n```typst\n#let words = (\n  \"first\",\n  \"second\",\n  \"third\",\n  \"fourth\",\n  \"fifth\",\n  \"sixth\",\n  \"seventh\",\n  \"eighth\",\n  \"ninth\",\n  \"tenth\",\n  \"eleventh\",\n  \"tvelveth\"\n);\n#let len = words.len()\n\n#let dia = lq.diagram(\n  width: 10cm, height: 10cm,\n  lq.colormesh(\n    lq.linspace(0, len - 1, num: len),\n    lq.linspace(0, len - 1, num: len),\n    (x, y) => x * y, // for illustration purposes, for real data use the array\n        // data\n        //  .at(calc.floor(y))\n        //  .at(calc.floor(x)),\n    map: color.map.viridis\n  ),\n\n  xaxis: (\n    ticks: words.map(rotate.with(-90deg, reflow: true)).enumerate(),\n    subticks: none,\n    position: top,\n  ),\n\n  yaxis: (\n    ticks: words.enumerate(),\n    subticks: none,\n    inverted: true,\n  ),\n)\n\n#let legend = lq.diagram(\n  width: 0.25cm,\n  height: 10cm,\n  lq.colormesh(\n    interpolation: \"smooth\",\n    lq.linspace(0, 1),\n    lq.linspace(0, 1),\n    (x, y) => y\n  ),\n  xaxis: none,\n  yaxis: (\n    position: right,\n    subticks: none,\n    tick-distance: 0.2,\n  )\n)\n\n#figure(\n  grid(\n    align: bottom,\n    gutter: 0.5cm,\n    columns: 2,\n    dia,\n    legend,\n  ),\n  scope: \"parent\",\n  placement: auto,\n  caption: [My heatmap]\n) <heat-map>\n```\n\nAnd the result looks something like this:\n![image|555x500, 50%](upload://dg3g4nktwukklYHTSYC7g7EFlkY.png)\n\n\nStill, something tells me this can be implemented easier and cleaner. Any suggestions?",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 43,
      "score": 93.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1628
    },
    {
      "id": 13082,
      "post_number": 2,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-24T15:16:15.721Z",
      "updated_at": "2025-05-24T15:17:03.578Z",
      "cooked": "<p>My suggestion is to request the addition of a continuous legend for the heatmap diagram.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/lilaq:0.3.0\" as lq\n\n/// Style for heatmap diagram.\n#let heatmap-style(doc) = {\n  set rotate(reflow: true)\n  show: lq.set-diagram(\n    xaxis: (subticks: none, position: top),\n    yaxis: (subticks: none, inverted: true),\n    width: 10cm,\n    height: 10cm,\n  )\n  doc\n}\n\n/// Continuous legend style for heatmap diagram.\n#let heatmap-legend-style(doc) = {\n  show: lq.set-diagram(\n    yaxis: (position: right, subticks: none, tick-distance: 0.2),\n    xaxis: none,\n    width: 0.25cm,\n    height: 10cm,\n  )\n  doc\n}\n\n#let heatmap-with-legend(diagram, range) = grid(\n  columns: 2,\n  align: bottom,\n  gutter: 0.5cm,\n  heatmap-style(diagram),\n  heatmap-legend-style(lq.diagram(lq.colormesh(\n    interpolation: \"smooth\",\n    range,\n    range,\n    (_, y) =&gt; y,\n  ))),\n)\n\n#let words = (\n  \"first\",\n  \"second\",\n  \"third\",\n  \"fourth\",\n  \"fifth\",\n  \"sixth\",\n  \"seventh\",\n  \"eighth\",\n  \"ninth\",\n  \"tenth\",\n  \"eleventh\",\n  \"twelveth\",\n)\n\n#let length = words.len()\n#let x = lq.linspace(2, 20, num: length)\n#let y = lq.linspace(-4, 15, num: length)\n\n#figure(\n  heatmap-with-legend(\n    lq.diagram(\n      xaxis: (ticks: x.zip(words.map(rotate.with(-90deg)))),\n      yaxis: (ticks: y.zip(words)),\n      lq.colormesh(x, y, (x, y) =&gt; x * y, map: color.map.viridis),\n    ),\n    lq.linspace(0, 1),\n  ),\n  caption: [My heatmap],\n) &lt;heat-map&gt;\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/7/7643a121214ab3c5bb7e9a59934d25ec4c910522.png\" alt=\"image\" data-base62-sha1=\"gSdeGuf2aMswDkEfGYxGMYgS9hg\" width=\"236\" height=\"224\"></p>",
      "raw": "My suggestion is to request the addition of a continuous legend for the heatmap diagram.\n\n```typ\n#import \"@preview/lilaq:0.3.0\" as lq\n\n/// Style for heatmap diagram.\n#let heatmap-style(doc) = {\n  set rotate(reflow: true)\n  show: lq.set-diagram(\n    xaxis: (subticks: none, position: top),\n    yaxis: (subticks: none, inverted: true),\n    width: 10cm,\n    height: 10cm,\n  )\n  doc\n}\n\n/// Continuous legend style for heatmap diagram.\n#let heatmap-legend-style(doc) = {\n  show: lq.set-diagram(\n    yaxis: (position: right, subticks: none, tick-distance: 0.2),\n    xaxis: none,\n    width: 0.25cm,\n    height: 10cm,\n  )\n  doc\n}\n\n#let heatmap-with-legend(diagram, range) = grid(\n  columns: 2,\n  align: bottom,\n  gutter: 0.5cm,\n  heatmap-style(diagram),\n  heatmap-legend-style(lq.diagram(lq.colormesh(\n    interpolation: \"smooth\",\n    range,\n    range,\n    (_, y) => y,\n  ))),\n)\n\n#let words = (\n  \"first\",\n  \"second\",\n  \"third\",\n  \"fourth\",\n  \"fifth\",\n  \"sixth\",\n  \"seventh\",\n  \"eighth\",\n  \"ninth\",\n  \"tenth\",\n  \"eleventh\",\n  \"twelveth\",\n)\n\n#let length = words.len()\n#let x = lq.linspace(2, 20, num: length)\n#let y = lq.linspace(-4, 15, num: length)\n\n#figure(\n  heatmap-with-legend(\n    lq.diagram(\n      xaxis: (ticks: x.zip(words.map(rotate.with(-90deg)))),\n      yaxis: (ticks: y.zip(words)),\n      lq.colormesh(x, y, (x, y) => x * y, map: color.map.viridis),\n    ),\n    lq.linspace(0, 1),\n  ),\n  caption: [My heatmap],\n) <heat-map>\n```\n\n![image|473x448, 50%](upload://gSdeGuf2aMswDkEfGYxGMYgS9hg.png)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 37,
      "score": 32.4,
      "accepted_answer": true,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 13101,
      "post_number": 3,
      "username": "Mc-Zen",
      "name": "Mc-Zen",
      "created_at": "2025-05-24T21:21:30.262Z",
      "updated_at": "2025-05-24T21:22:52.063Z",
      "cooked": "<p>Hi <a class=\"mention\" href=\"/u/dmitriy\">@Dmitriy</a>, let me tell you a secret but you gotta keep it ;)</p>\n<p>There exists <code>lq.colorbar</code> and you can use it like this</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">\n#show: lq.set-diagram(\n  height: 10cm,\n)\n\n#let heatmap = lq.colormesh(\n  lq.linspace(0, len - 1, num: len),\n  lq.linspace(0, len - 1, num: len),\n  (x, y) =&gt; x * y, \n)\n\n#lq.diagram(\n  width: 10cm, \n\n  heatmap,\n\n  xaxis: (\n    ticks: words.map(rotate.with(-90deg, reflow: true)).enumerate(),\n    subticks: none,\n    position: top,\n  ),\n\n  yaxis: (\n    ticks: words.enumerate(),\n    subticks: none,\n    inverted: true,\n  ),\n)\n#lq.colorbar(heatmap)\n</code></pre>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/1/1d8f46ed6691a86f4fa978ed349ff206100c0e39.png\" data-download-href=\"https://forum.typst.app/uploads/default/1d8f46ed6691a86f4fa978ed349ff206100c0e39\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/1/1d8f46ed6691a86f4fa978ed349ff206100c0e39_2_416x375.png\" alt=\"image\" data-base62-sha1=\"4duOBXScnMUyRcadZ4i8vfmvk2B\" width=\"416\" height=\"375\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/1/1d8f46ed6691a86f4fa978ed349ff206100c0e39_2_416x375.png, https://forum.typst.app/uploads/default/original/2X/1/1d8f46ed6691a86f4fa978ed349ff206100c0e39.png 1.5x, https://forum.typst.app/uploads/default/original/2X/1/1d8f46ed6691a86f4fa978ed349ff206100c0e39.png 2x\" data-dominant-color=\"767899\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">611×550 50.6 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>It takes the numeric data and automatically scales everything as it should be.</p>\n<p>This feature is (almost) entirely undocumented and for a reason: I’m not yet decided on the usage design − should it be something extra that the user needs to place on their own (like it is currently  − more powerful but also more manual) or should it be just something you call within <code>lq.diagram</code> and it’s automatically placed somewhere? And there are many more questions concerning the API.</p>\n<p>But you can try it out and give feedback on the rough idea of it (I know that there are still severe limitations, for example the height of the color bar can only be set through a set rule and the width not at all).</p>",
      "raw": "Hi @Dmitriy, let me tell you a secret but you gotta keep it ;)\n\nThere exists `lq.colorbar` and you can use it like this\n```typ\n\n#show: lq.set-diagram(\n  height: 10cm,\n)\n\n#let heatmap = lq.colormesh(\n  lq.linspace(0, len - 1, num: len),\n  lq.linspace(0, len - 1, num: len),\n  (x, y) => x * y, \n)\n\n#lq.diagram(\n  width: 10cm, \n\n  heatmap,\n\n  xaxis: (\n    ticks: words.map(rotate.with(-90deg, reflow: true)).enumerate(),\n    subticks: none,\n    position: top,\n  ),\n\n  yaxis: (\n    ticks: words.enumerate(),\n    subticks: none,\n    inverted: true,\n  ),\n)\n#lq.colorbar(heatmap)\n```\n![image|555x500, 75%](upload://4duOBXScnMUyRcadZ4i8vfmvk2B.png)\n\nIt takes the numeric data and automatically scales everything as it should be. \n\nThis feature is (almost) entirely undocumented and for a reason: I'm not yet decided on the usage design − should it be something extra that the user needs to place on their own (like it is currently  − more powerful but also more manual) or should it be just something you call within `lq.diagram` and it's automatically placed somewhere? And there are many more questions concerning the API.\n\nBut you can try it out and give feedback on the rough idea of it (I know that there are still severe limitations, for example the height of the color bar can only be set through a set rule and the width not at all).",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 2,
      "reads": 37,
      "score": 47.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 9
    },
    {
      "id": 13102,
      "post_number": 4,
      "username": "Mc-Zen",
      "name": "Mc-Zen",
      "created_at": "2025-05-24T21:24:11.109Z",
      "updated_at": "2025-05-24T21:24:11.109Z",
      "cooked": "<p>Oh and for some wicked reason, the tick labels sometimes don’t line up with the ticks on the color bar. I haven’t yet figured out why :/</p>",
      "raw": "Oh and for some wicked reason, the tick labels sometimes don't line up with the ticks on the color bar. I haven't yet figured out why :/",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 34,
      "score": 41.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 9
    }
  ],
  "scraped_at": "2025-06-10T09:47:21.590365"
}