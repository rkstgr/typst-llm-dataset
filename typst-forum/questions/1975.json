{
  "topic_metadata": {
    "id": 1975,
    "title": "How to conditionally define a 'watermark' variable?",
    "slug": "how-to-conditionally-define-a-watermark-variable",
    "posts_count": 4,
    "created_at": "2024-12-04T04:30:29.759Z",
    "last_posted_at": "2024-12-04T06:30:05.142Z",
    "views": 197,
    "like_count": 5,
    "reply_count": 0,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "NNS",
    "tags": [
      "scripting"
    ],
    "category_id": 5,
    "participant_count": 3,
    "word_count": 275
  },
  "posts": [
    {
      "id": 6296,
      "post_number": 1,
      "username": "Brent",
      "name": "Brent",
      "created_at": "2024-12-04T04:30:29.919Z",
      "updated_at": "2024-12-04T06:28:15.516Z",
      "cooked": "<p>I want to have a conditional watermark based on a command line parameter but am having trouble with the watermark variable being out of scope in the <code>#set page</code> call.  Is there way to do this?</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#if sys.inputs.watermark == \"true\" [\n  #let watermark = rotate(24deg, text(185pt, fill: rgb(\"FF0000\"))[*SAMPLE*])\n] else [\n  #let watermark = none\n]\n\n#set page(\n  paper: \"a4\",\n  numbering: \"1\",\n  flipped: true,\n  margin: 1cm,\n  foreground: watermark\n)\n</code></pre>",
      "raw": "I want to have a conditional watermark based on a command line parameter but am having trouble with the watermark variable being out of scope in the `#set page` call.  Is there way to do this?\n\n```typ\n#if sys.inputs.watermark == \"true\" [\n  #let watermark = rotate(24deg, text(185pt, fill: rgb(\"FF0000\"))[*SAMPLE*])\n] else [\n  #let watermark = none\n]\n\n#set page(\n  paper: \"a4\",\n  numbering: \"1\",\n  flipped: true,\n  margin: 1cm,\n  foreground: watermark\n)\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 40,
      "score": 753.0,
      "accepted_answer": false,
      "trust_level": 0,
      "user_id": 888
    },
    {
      "id": 6314,
      "post_number": 2,
      "username": "NNS",
      "name": "Nikolai Neff-Sarnow",
      "created_at": "2024-12-04T05:41:32.354Z",
      "updated_at": "2024-12-04T05:43:22.780Z",
      "cooked": "<p>try setting the variable before the conditional:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let watermark = none\n#if sys.inputs.watermark == \"true\" { \nwatermark = rotate(24deg, text(185pt, fill: rgb(“FF0000”))[SAMPLE])\n}\n#set page(\npaper: \"a4\",\nnumbering: \"1\",\nflipped: true,\nmargin: 1cm,\nforeground: watermark\n)\n</code></pre>",
      "raw": "try setting the variable before the conditional:\n```typst\n#let watermark = none\n#if sys.inputs.watermark == \"true\" { \nwatermark = rotate(24deg, text(185pt, fill: rgb(“FF0000”))[SAMPLE])\n}\n#set page(\npaper: \"a4\",\nnumbering: \"1\",\nflipped: true,\nmargin: 1cm,\nforeground: watermark\n)\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 39,
      "score": 62.8,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 754
    },
    {
      "id": 6315,
      "post_number": 3,
      "username": "PgBiel",
      "name": "",
      "created_at": "2024-12-04T06:27:14.716Z",
      "updated_at": "2024-12-04T06:28:00.380Z",
      "cooked": "<p>Hey <a class=\"mention\" href=\"/u/brent\">@Brent</a>, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: <a href=\"https://forum.typst.app/t/how-to-post-in-the-questions-category/11\" class=\"inline-onebox\">How to post in the Questions category</a></p>\n<p>Make sure your title is a question you’d ask to a friend about Typst. <img src=\"https://forum.typst.app/images/emoji/apple/wink.png?v=12\" title=\":wink:\" class=\"emoji\" alt=\":wink:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>\n<p>I’ve also updated your post to use ```typ ``` around your Typst source code for better display, as <a class=\"mention\" href=\"/u/nns\">@NNS</a> did in their answer. It’s a neat trick! <img src=\"https://forum.typst.app/images/emoji/apple/smile.png?v=12\" title=\":smile:\" class=\"emoji\" alt=\":smile:\" loading=\"lazy\" width=\"20\" height=\"20\"></p>",
      "raw": "Hey @Brent, welcome to the forum! I’ve changed your question post’s title to better fit our guidelines: https://forum.typst.app/t/how-to-post-in-the-questions-category/11\n\nMake sure your title is a question you’d ask to a friend about Typst. :wink:\n\nI've also updated your post to use \\`\\`\\`typ \\`\\`\\` around your Typst source code for better display, as @NNS did in their answer. It's a neat trick! :smile:",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 36,
      "score": 112.2,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    },
    {
      "id": 6316,
      "post_number": 4,
      "username": "PgBiel",
      "name": "",
      "created_at": "2024-12-04T06:30:05.142Z",
      "updated_at": "2024-12-04T06:30:05.142Z",
      "cooked": "<p>You can “factor out” the variable definition, because each block in Typst joins and returns each line in it. For example, <code>#let x = { [a]; [b]; [c] }</code> (where <code>;</code> is equivalent to writing them in separate lines) will be the same as <code>#let x = [abc]</code>. With that in mind, we can write this:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#let watermark = if sys.inputs.watermark == \"true\" {\n  // 'rotate(...)' is returned by this block\n  rotate(24deg, text(185pt, fill: rgb(\"FF0000\"))[*SAMPLE*])\n} else {\n  // 'none' is returned by this block\n  none\n}\n\n#set page(\n  paper: \"a4\",\n  numbering: \"1\",\n  flipped: true,\n  margin: 1cm,\n  foreground: watermark\n)\n</code></pre>",
      "raw": "You can \"factor out\" the variable definition, because each block in Typst joins and returns each line in it. For example, `#let x = { [a]; [b]; [c] }` (where `;` is equivalent to writing them in separate lines) will be the same as `#let x = [abc]`. With that in mind, we can write this:\n\n```typ\n#let watermark = if sys.inputs.watermark == \"true\" {\n  // 'rotate(...)' is returned by this block\n  rotate(24deg, text(185pt, fill: rgb(\"FF0000\"))[*SAMPLE*])\n} else {\n  // 'none' is returned by this block\n  none\n}\n\n#set page(\n  paper: \"a4\",\n  numbering: \"1\",\n  flipped: true,\n  margin: 1cm,\n  foreground: watermark\n)\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 37,
      "score": 37.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 3
    }
  ],
  "scraped_at": "2025-06-10T09:54:06.531638"
}