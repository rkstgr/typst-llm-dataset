{
  "topic_metadata": {
    "id": 4192,
    "title": "Why there are still blanks when I use numbering.trim?",
    "slug": "why-there-are-still-blanks-when-i-use-numbering-trim",
    "posts_count": 4,
    "created_at": "2025-05-21T00:58:29.957Z",
    "last_posted_at": "2025-05-23T05:10:20.720Z",
    "views": 56,
    "like_count": 2,
    "reply_count": 1,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 2,
    "accepted_answer_username": "user3",
    "tags": [
      "scripting",
      "numbering"
    ],
    "category_id": 5,
    "participant_count": 2,
    "word_count": 391
  },
  "posts": [
    {
      "id": 12831,
      "post_number": 1,
      "username": "user3",
      "name": "codemetic",
      "created_at": "2025-05-21T00:58:30.093Z",
      "updated_at": "2025-05-22T19:59:43.062Z",
      "cooked": "<p>This is my minimal reproduction</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show heading.where(level: 1):set heading(numbering: \"A\")\n\n#let get-current-chapter-num() = context [\n  #let heading-counter = counter(heading).get()\n  #let chapter = if heading-counter.len() &gt; 0 {\n    let current-heading = query(selector(heading.where(level: 1)).before(here())).last()\n    numbering(current-heading.numbering, heading-counter.at(0)).trim() // at here\n  } else { \"0\" }\n  #chapter\n]\n\n= Test\nHere is in chapter-#get-current-chapter-num()\\.\n</code></pre>\n<p>Although I have trimed the numbering output, but it still puts whitespace around the numbering.</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/f/f525ee60845c0965d2e9501ead2ddc722e219713.png\" data-download-href=\"https://forum.typst.app/uploads/default/f525ee60845c0965d2e9501ead2ddc722e219713\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/f/f525ee60845c0965d2e9501ead2ddc722e219713_2_690x236.png\" alt=\"image\" data-base62-sha1=\"yYGfkZoFNn7HV1tUYjIV7gU4ZHl\" width=\"690\" height=\"236\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/f/f525ee60845c0965d2e9501ead2ddc722e219713_2_690x236.png, https://forum.typst.app/uploads/default/original/2X/f/f525ee60845c0965d2e9501ead2ddc722e219713.png 1.5x, https://forum.typst.app/uploads/default/original/2X/f/f525ee60845c0965d2e9501ead2ddc722e219713.png 2x\" data-dominant-color=\"ECEDED\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">755×259 20.7 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div><br>\n<div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/f/f9fbb21b45fa68fb958d31b1f381d3341e0c755f.png\" data-download-href=\"https://forum.typst.app/uploads/default/f9fbb21b45fa68fb958d31b1f381d3341e0c755f\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/optimized/2X/f/f9fbb21b45fa68fb958d31b1f381d3341e0c755f_2_690x253.png\" alt=\"image\" data-base62-sha1=\"zFs92h7RPmCohhmeU2ktraoe795\" width=\"690\" height=\"253\" srcset=\"https://forum.typst.app/uploads/default/optimized/2X/f/f9fbb21b45fa68fb958d31b1f381d3341e0c755f_2_690x253.png, https://forum.typst.app/uploads/default/original/2X/f/f9fbb21b45fa68fb958d31b1f381d3341e0c755f.png 1.5x, https://forum.typst.app/uploads/default/original/2X/f/f9fbb21b45fa68fb958d31b1f381d3341e0c755f.png 2x\" data-dominant-color=\"EEEEEF\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">779×286 21.2 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>And how do I remove these whitespaces around?<br>\nThank you.</p>",
      "raw": "This is my minimal reproduction\n\n```typst\n#show heading.where(level: 1):set heading(numbering: \"A\")\n\n#let get-current-chapter-num() = context [\n  #let heading-counter = counter(heading).get()\n  #let chapter = if heading-counter.len() > 0 {\n    let current-heading = query(selector(heading.where(level: 1)).before(here())).last()\n    numbering(current-heading.numbering, heading-counter.at(0)).trim() // at here\n  } else { \"0\" }\n  #chapter\n]\n\n= Test\nHere is in chapter-#get-current-chapter-num()\\.\n```\n\nAlthough I have trimed the numbering output, but it still puts whitespace around the numbering.\n\n![image|690x236](upload://yYGfkZoFNn7HV1tUYjIV7gU4ZHl.png)\n![image|690x253](upload://zFs92h7RPmCohhmeU2ktraoe795.png)\n\nAnd how do I remove these whitespaces around?\nThank you.",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 19.6,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1630
    },
    {
      "id": 12832,
      "post_number": 2,
      "username": "user3",
      "name": "codemetic",
      "created_at": "2025-05-21T01:23:19.320Z",
      "updated_at": "2025-05-21T01:23:19.320Z",
      "cooked": "<p>Ok…it seems to be the prank of <code>content</code> type.<br>\nI finally resolved it by returing string directly.</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#let get-current-chapter-num() = context {\n  let heading-counter = counter(heading).get()\n  let chapter = if heading-counter.len() &gt; 0 {\n    let current-heading = query(selector(heading.where(level: 1)).before(here())).last()\n    return numbering(current-heading.numbering, heading-counter.at(0)).trim()\n  } else { \"0\" }\n  return chapter.trim()\n}\n</code></pre>",
      "raw": "Ok...it seems to be the prank of `content` type.\nI finally resolved it by returing string directly.\n```typst\n#let get-current-chapter-num() = context {\n  let heading-counter = counter(heading).get()\n  let chapter = if heading-counter.len() > 0 {\n    let current-heading = query(selector(heading.where(level: 1)).before(here())).last()\n    return numbering(current-heading.numbering, heading-counter.at(0)).trim()\n  } else { \"0\" }\n  return chapter.trim()\n}\n```",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 23,
      "score": 9.6,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 1630
    },
    {
      "id": 12887,
      "post_number": 3,
      "username": "Andrew",
      "name": "",
      "created_at": "2025-05-21T15:12:27.182Z",
      "updated_at": "2025-05-21T15:12:55.602Z",
      "cooked": "<p>The issue is that you are using non-inline markup mode in the context block instead of code.</p>\n<p>I don’t know why you need just a chapter number, but here is an easy solution:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show heading.where(level: 1): set heading(numbering: \"A\")\n\n#let get-current-chapter-num() = context {\n  let selector = heading.where(level: 1).before(here())\n  let previous-headings = query(selector)\n  if previous-headings.len() == 0 { return 0 }\n  counter(selector).display(previous-headings.last().numbering)\n}\n</code></pre>\n<p>But it looks like a <code>@heading</code> without the label. So something like this can be used:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show heading.where(level: 1): set heading(\n  numbering: \"A\",\n  supplement: \"Chapter\",\n)\n\n#let heading-reference(element) = {\n  let nums = counter(heading).at(element.location())\n  let numering = numbering(element.numbering, ..nums)\n  link(element.location(), [#element.supplement~#numering])\n}\n\n#let get-current-chapter() = context {\n  let last-headings = query(selector(heading.where(level: 1)).before(here()))\n  if last-headings.len() == 0 [Chapter 0] else {\n    heading-reference(last-headings.last())\n  }\n}\n</code></pre>\n<p>We can’t fetch <code>heading.where(level: 1).supplement</code> yet (<a href=\"https://github.com/typst/typst/issues/5574\" class=\"inline-onebox\">Resolve the nested element styles within a `context` · Issue #5574 · typst/typst · GitHub</a>), so the default value must be hard-coded, if it will be used at all.</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">Here is in #get-current-chapter().\n\n= Test\n== Test\nHere is in #get-current-chapter().\n\n= Test\n== Test\nHere is in #get-current-chapter().\n</code></pre>\n<p><img src=\"https://forum.typst.app/uploads/default/original/2X/6/612c656f1a28162da148db2f062c116e9afb0a2d.png\" alt=\"image\" data-base62-sha1=\"dRDqQSieJ2hODNgP3yQNs0lb9r7\" width=\"147\" height=\"217\"></p>",
      "raw": "The issue is that you are using non-inline markup mode in the context block instead of code.\n\nI don't know why you need just a chapter number, but here is an easy solution:\n\n```typ\n#show heading.where(level: 1): set heading(numbering: \"A\")\n\n#let get-current-chapter-num() = context {\n  let selector = heading.where(level: 1).before(here())\n  let previous-headings = query(selector)\n  if previous-headings.len() == 0 { return 0 }\n  counter(selector).display(previous-headings.last().numbering)\n}\n```\n\nBut it looks like a `@heading` without the label. So something like this can be used:\n\n```typ\n#show heading.where(level: 1): set heading(\n  numbering: \"A\",\n  supplement: \"Chapter\",\n)\n\n#let heading-reference(element) = {\n  let nums = counter(heading).at(element.location())\n  let numering = numbering(element.numbering, ..nums)\n  link(element.location(), [#element.supplement~#numering])\n}\n\n#let get-current-chapter() = context {\n  let last-headings = query(selector(heading.where(level: 1)).before(here()))\n  if last-headings.len() == 0 [Chapter 0] else {\n    heading-reference(last-headings.last())\n  }\n}\n```\n\nWe can't fetch `heading.where(level: 1).supplement` yet (https://github.com/typst/typst/issues/5574), so the default value must be hard-coded, if it will be used at all.\n\n```typ\nHere is in #get-current-chapter().\n\n= Test\n== Test\nHere is in #get-current-chapter().\n\n= Test\n== Test\nHere is in #get-current-chapter().\n```\n\n![image|147x217](upload://dRDqQSieJ2hODNgP3yQNs0lb9r7.png)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 20,
      "score": 24.0,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 51
    },
    {
      "id": 12996,
      "post_number": 4,
      "username": "user3",
      "name": "codemetic",
      "created_at": "2025-05-23T05:10:20.720Z",
      "updated_at": "2025-05-23T05:10:20.720Z",
      "cooked": "<p>Thank you very much!</p>",
      "raw": "Thank you very much!",
      "reply_to_post_number": 3,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 17,
      "score": 18.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 1630
    }
  ],
  "scraped_at": "2025-06-10T09:47:32.938842"
}