{
  "topic_metadata": {
    "id": 1714,
    "title": "How to make figure caption text have the same width as the figure?",
    "slug": "how-to-make-figure-caption-text-have-the-same-width-as-the-figure",
    "posts_count": 9,
    "created_at": "2024-11-13T21:49:25.504Z",
    "last_posted_at": "2025-03-18T08:20:01.515Z",
    "views": 418,
    "like_count": 7,
    "reply_count": 6,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 4,
    "accepted_answer_username": "slowjo",
    "tags": [
      "layout"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 621
  },
  "posts": [
    {
      "id": 5605,
      "post_number": 1,
      "username": "AhmedSalih",
      "name": "",
      "created_at": "2024-11-13T21:49:25.703Z",
      "updated_at": "2024-12-19T05:00:29.223Z",
      "cooked": "<p>Hello!</p>\n<p>Suppose I have a figure:</p>\n<p><div class=\"lightbox-wrapper\"><a class=\"lightbox\" href=\"https://forum.typst.app/uploads/default/original/2X/e/ec8f24a6a3109b6f79579fdca7243a11c0abeda8.jpeg\" data-download-href=\"https://forum.typst.app/uploads/default/ec8f24a6a3109b6f79579fdca7243a11c0abeda8\" title=\"image\"><img src=\"https://forum.typst.app/uploads/default/original/2X/e/ec8f24a6a3109b6f79579fdca7243a11c0abeda8.jpeg\" alt=\"image\" data-base62-sha1=\"xKHmGjTIPkgBmVBFAAtQz5JHaVq\" width=\"604\" height=\"500\" data-dominant-color=\"7A9CAA\"><div class=\"meta\"><svg class=\"fa d-icon d-icon-far-image svg-icon\" aria-hidden=\"true\"><use href=\"#far-image\"></use></svg><span class=\"filename\">image</span><span class=\"informations\">893×739 91.7 KB</span><svg class=\"fa d-icon d-icon-discourse-expand svg-icon\" aria-hidden=\"true\"><use href=\"#discourse-expand\"></use></svg></div></a></div></p>\n<p>How to do this in typst?</p>\n<p>A MWE using <code>rect</code> here:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#figure(\n  rect(width:10cm, height: 5cm),\n  caption: \n    [_A coastal hydrodynamics simulation of wave impact on a light house using a particle based approach. Figure courtesy of Ihmsen et al._]\n) \n\n</code></pre>\n<p>Can I make it a default somehow?</p>\n<p>Kind regards</p>",
      "raw": "Hello!\n\nSuppose I have a figure:\n\n\n![image|604x500](upload://xKHmGjTIPkgBmVBFAAtQz5JHaVq.jpeg)\n\n\nHow to do this in typst?\n\nA MWE using `rect` here:\n\n\n```typst\n#figure(\n  rect(width:10cm, height: 5cm),\n  caption: \n    [_A coastal hydrodynamics simulation of wave impact on a light house using a particle based approach. Figure courtesy of Ihmsen et al._]\n) \n\n```\n\nCan I make it a default somehow?\n\nKind regards",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 55,
      "score": 1576.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 786
    },
    {
      "id": 5609,
      "post_number": 2,
      "username": "slowjo",
      "name": "slowjo",
      "created_at": "2024-11-13T23:13:59.750Z",
      "updated_at": "2024-11-13T23:13:59.750Z",
      "cooked": "<p>Hi, you can use a show rule on the figure to measure its size, and use a nested show rule on the caption to restraining its size to the previously measured one.</p>\n<p>I believe this to be what you’re going for:</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set page(width: auto, height: auto, margin: 2em)\n#show figure: it =&gt; {\n\tlet w = measure(it.body).width\n\tset par(justify: true)\n\tshow figure.caption: cap =&gt; box(width: w, cap)\n\tit\n}\n\n#figure(\n  rect(width:10cm, height: 5cm),\n  caption:\n    [_A coastal hydrodynamics simulation of wave impact on a light house using a particle based approach. Figure courtesy of Ihmsen et al._]\n)\n</code></pre>\n<p>which creates<br>\n<img src=\"https://forum.typst.app/uploads/default/original/2X/1/13bb7b01facc8f60a0341ffdeb1b092cc1831f41.png\" alt=\"image\" data-base62-sha1=\"2OyKjG8k4ALUKK1Mcx37KDVyKNb\" width=\"655\" height=\"457\"></p>",
      "raw": "Hi, you can use a show rule on the figure to measure its size, and use a nested show rule on the caption to restraining its size to the previously measured one.\n\nI believe this to be what you're going for:\n```typst\n#set page(width: auto, height: auto, margin: 2em)\n#show figure: it => {\n\tlet w = measure(it.body).width\n\tset par(justify: true)\n\tshow figure.caption: cap => box(width: w, cap)\n\tit\n}\n\n#figure(\n  rect(width:10cm, height: 5cm),\n  caption:\n    [_A coastal hydrodynamics simulation of wave impact on a light house using a particle based approach. Figure courtesy of Ihmsen et al._]\n)\n```\nwhich creates\n![image|655x457](upload://2OyKjG8k4ALUKK1Mcx37KDVyKNb.png)",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 47,
      "score": 59.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 793
    },
    {
      "id": 5610,
      "post_number": 3,
      "username": "AhmedSalih",
      "name": "",
      "created_at": "2024-11-13T23:23:24.906Z",
      "updated_at": "2024-11-13T23:23:37.365Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"slowjo\" data-post=\"2\" data-topic=\"1714\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/letter_avatar_proxy/v4/letter/s/220F66/48.png\" class=\"avatar\"> slowjo:</div>\n<blockquote>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#set page(width: auto, height: auto, margin: 2em)\n#show figure: it =&gt; {\n\tlet w = measure(it.body).width\n\tset par(justify: true)\n\tshow figure.caption: cap =&gt; box(width: w, cap)\n\tit\n}\n\n#figure(\n  rect(width:10cm, height: 5cm),\n  caption:\n    [_A coastal hydrodynamics simulation of wave impact on a light house using a particle based approach. Figure courtesy of Ihmsen et al._]\n)\n</code></pre>\n</blockquote>\n</aside>\n<p>Amazing!</p>\n<p>Just one question, if you use an actual image and set width to: <code>width: 60%</code> does the function you made also break for you? I get a width of 0pt in that case…</p>\n<p>Kind regards</p>",
      "raw": "[quote=\"slowjo, post:2, topic:1714\"]\n```typst\n#set page(width: auto, height: auto, margin: 2em)\n#show figure: it => {\n\tlet w = measure(it.body).width\n\tset par(justify: true)\n\tshow figure.caption: cap => box(width: w, cap)\n\tit\n}\n\n#figure(\n  rect(width:10cm, height: 5cm),\n  caption:\n    [_A coastal hydrodynamics simulation of wave impact on a light house using a particle based approach. Figure courtesy of Ihmsen et al._]\n)\n```\n[/quote]\n\nAmazing!\n\nJust one question, if you use an actual image and set width to: `width: 60%` does the function you made also break for you? I get a width of 0pt in that case..\n\nKind regards",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 0,
      "reads": 47,
      "score": 34.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 786
    },
    {
      "id": 5611,
      "post_number": 4,
      "username": "slowjo",
      "name": "slowjo",
      "created_at": "2024-11-13T23:40:58.511Z",
      "updated_at": "2024-11-13T23:40:58.511Z",
      "cooked": "<p>in that case you need to still wrap in in a <code>layout</code> call, to give it the context it needs</p>\n<pre data-code-wrap=\"typst\"><code class=\"lang-typst\">#show figure: it =&gt; layout( sz =&gt; {\n\tlet w = measure(\n\t\t\tit.body,\n\t\t\twidth: sz.width\n\t\t).width\n\tset par(justify: true)\n\tshow figure.caption: cap =&gt; box(width: w, align(left,emph(cap)))\n\tit\n})\n\n</code></pre>",
      "raw": "in that case you need to still wrap in in a `layout` call, to give it the context it needs\n```typst\n#show figure: it => layout( sz => {\n\tlet w = measure(\n\t\t\tit.body,\n\t\t\twidth: sz.width\n\t\t).width\n\tset par(justify: true)\n\tshow figure.caption: cap => box(width: w, align(left,emph(cap)))\n\tit\n})\n\n```",
      "reply_to_post_number": 3,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 3,
      "reads": 43,
      "score": 373.6,
      "accepted_answer": true,
      "trust_level": 1,
      "user_id": 793
    },
    {
      "id": 5614,
      "post_number": 5,
      "username": "AhmedSalih",
      "name": "",
      "created_at": "2024-11-13T23:45:30.972Z",
      "updated_at": "2024-11-13T23:45:30.972Z",
      "cooked": "<p>Amazing, thanks a ton!</p>\n<p>What is it that the layout does and how do I know when to use it? I don’t think I would have realized that on my own…</p>",
      "raw": "Amazing, thanks a ton!\n\nWhat is it that the layout does and how do I know when to use it? I don't think I would have realized that on my own..",
      "reply_to_post_number": 4,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 1,
      "reads": 40,
      "score": 28.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 786
    },
    {
      "id": 5615,
      "post_number": 6,
      "username": "slowjo",
      "name": "slowjo",
      "created_at": "2024-11-13T23:52:53.597Z",
      "updated_at": "2024-11-13T23:52:53.597Z",
      "cooked": "<p>I find typst has great <a href=\"https://typst.app/docs/reference/layout/layout/\">documentation</a>, it’s worth going through to find out what’s even possible.</p>\n<p>The <code>layout</code> function makes the dimensions of the parent container available. Setting your <code>width: 60%</code> is 60% <em>of the parent’s dimensions</em> + <code>0pt</code> of absolute size. Without the knowledge of the parent’s dimensions only the <code>0pt</code> remains, which is why the first solution broke for relative sizes.</p>",
      "raw": "I find typst has great [documentation](https://typst.app/docs/reference/layout/layout/), it's worth going through to find out what's even possible.\n\nThe `layout` function makes the dimensions of the parent container available. Setting your `width: 60%` is 60% _of the parent's dimensions_ + `0pt` of absolute size. Without the knowledge of the parent's dimensions only the `0pt` remains, which is why the first solution broke for relative sizes.",
      "reply_to_post_number": 5,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 2,
      "reads": 40,
      "score": 38.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 793
    },
    {
      "id": 9932,
      "post_number": 7,
      "username": "Philipp",
      "name": "Philipp",
      "created_at": "2025-03-17T16:56:51.573Z",
      "updated_at": "2025-03-17T16:58:44.924Z",
      "cooked": "<p>The trick to wrap the caption in a box which worked in typst 0.12 seems to be broken in typst 0.13, see <a href=\"https://github.com/typst/typst/issues/5472#issuecomment-2730205275\" class=\"inline-onebox\" rel=\"noopener nofollow ugc\">Paragraph justification sometimes doesn't use the full page width · Issue #5472 · typst/typst · GitHub</a></p>\n<p>I had to replace</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">show figure.caption: cap =&gt; box(width: w, cap)\n</code></pre>\n<p>with</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">show figure.caption: it =&gt; box(width: w, context[\n  #it.supplement #it.counter.display()#it.separator#it.body\n])\n</code></pre>\n<p>to get it to work again</p>",
      "raw": "The trick to wrap the caption in a box which worked in typst 0.12 seems to be broken in typst 0.13, see https://github.com/typst/typst/issues/5472#issuecomment-2730205275\n\nI had to replace\n```typ\nshow figure.caption: cap => box(width: w, cap)\n```\nwith\n```typ\nshow figure.caption: it => box(width: w, context[\n  #it.supplement #it.counter.display()#it.separator#it.body\n])\n```\nto get it to work again",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 24,
      "score": 9.8,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 798
    },
    {
      "id": 9938,
      "post_number": 8,
      "username": "sijo",
      "name": "",
      "created_at": "2025-03-18T07:48:54.082Z",
      "updated_at": "2025-03-18T07:48:54.082Z",
      "cooked": "<p>Can you give a small example that shows the problem with Typst 0.13? The examples from <a class=\"mention\" href=\"/u/slowjo\">@slowjo</a> seem to work fine in 0.13.1</p>",
      "raw": "Can you give a small example that shows the problem with Typst 0.13? The examples from @slowjo seem to work fine in 0.13.1",
      "reply_to_post_number": 7,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 22,
      "score": 14.4,
      "accepted_answer": false,
      "trust_level": 3,
      "user_id": 332
    },
    {
      "id": 9939,
      "post_number": 9,
      "username": "Philipp",
      "name": "Philipp",
      "created_at": "2025-03-18T08:20:01.515Z",
      "updated_at": "2025-03-18T08:25:56.903Z",
      "cooked": "<p><a class=\"mention\" href=\"/u/sijo\">@sijo</a> My previous reply contains a link to a github issue that shows a minimized example.</p>\n<p>You will only see it if - without justification - the caption is smaller than the figure width. Then - with justification - it is not streched horizontally to the width of the figure, but only to the width of the longest line.<br>\nFor the example given above, the difference between the width of the longest line and the figure might be a few pixels only, and thus it might not be apparent. The example I linked makes it clear.</p>",
      "raw": "@sijo My previous reply contains a link to a github issue that shows a minimized example.\n\nYou will only see it if - without justification - the caption is smaller than the figure width. Then - with justification - it is not streched horizontally to the width of the figure, but only to the width of the longest line.\nFor the example given above, the difference between the width of the longest line and the figure might be a few pixels only, and thus it might not be apparent. The example I linked makes it clear.",
      "reply_to_post_number": 8,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 20,
      "score": 4.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 798
    }
  ],
  "scraped_at": "2025-06-10T09:54:58.939851"
}