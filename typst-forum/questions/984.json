{
  "topic_metadata": {
    "id": 984,
    "title": "How to customize figure captions with subpar in 0.12?",
    "slug": "how-to-customize-figure-captions-with-subpar-in-0-12",
    "posts_count": 7,
    "created_at": "2024-10-08T12:21:57.322Z",
    "last_posted_at": "2024-10-08T18:33:42.370Z",
    "views": 439,
    "like_count": 4,
    "reply_count": 6,
    "has_accepted_answer": true,
    "accepted_answer_post_number": 6,
    "accepted_answer_username": "Tinger",
    "tags": [
      "figures"
    ],
    "category_id": 5,
    "participant_count": 4,
    "word_count": 540
  },
  "posts": [
    {
      "id": 3561,
      "post_number": 1,
      "username": "talb",
      "name": "talb",
      "created_at": "2024-10-08T12:21:57.481Z",
      "updated_at": "2024-10-08T12:21:57.481Z",
      "cooked": "<p>I want figure captions with bold supplement+number+separator, but the following code does not seem to work well with the subpar package in the Typst 0.12 Testing version:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#import \"@preview/subpar:0.1.1\"\n\n#show figure.caption: it =&gt; context box(\n  inset: (left: 1em, right: 1em),\n  align(left)[\n    *#it.supplement~#it.counter.display()#it.separator*#it.body\n  ]\n)\n\n#subpar.grid(\n  figure(\n    box(stroke: 1pt, inset: 5pt)[This is a figure],\n    caption: [This is a caption]\n  ),\n  figure(\n    box(stroke: 1pt, inset: 5pt)[This is a figure],\n    caption: [This is a caption]\n  ),\n  columns: (1fr, 1fr),\n  caption: [These are two subfigures.],\n  placement: auto,\n  label: &lt;fig1&gt;,\n)\n\n#figure(\n  box(stroke: 1pt, inset: 5pt)[This is a figure],\n  caption: [This is a caption]\n) &lt;fig2&gt;\n</code></pre>\n<p>This is the result with 0.12 (the subpar figure has number 0):</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/1X/abb2fa410a42d9344b8e2f85de9b16d082e1e1f2.png\" alt=\"image\" data-base62-sha1=\"ouV6vXPmSJ1Pmr5nu2WzFA8TmDw\" width=\"496\" height=\"165\"></p>\n<p>This is the result with 0.11.1 (the subpar figure has number 1):</p>\n<p><img src=\"https://forum.typst.app/uploads/default/original/1X/7975591213939b1c9a726546f89def6a8674a664.png\" alt=\"image\" data-base62-sha1=\"hktbP5msQhm7fxhbRBHYZpLL3fu\" width=\"480\" height=\"161\"></p>\n<p>How to fix this?</p>",
      "raw": "I want figure captions with bold supplement+number+separator, but the following code does not seem to work well with the subpar package in the Typst 0.12 Testing version:\n\n```typ\n#import \"@preview/subpar:0.1.1\"\n\n#show figure.caption: it => context box(\n  inset: (left: 1em, right: 1em),\n  align(left)[\n    *#it.supplement~#it.counter.display()#it.separator*#it.body\n  ]\n)\n\n#subpar.grid(\n  figure(\n    box(stroke: 1pt, inset: 5pt)[This is a figure],\n    caption: [This is a caption]\n  ),\n  figure(\n    box(stroke: 1pt, inset: 5pt)[This is a figure],\n    caption: [This is a caption]\n  ),\n  columns: (1fr, 1fr),\n  caption: [These are two subfigures.],\n  placement: auto,\n  label: <fig1>,\n)\n\n#figure(\n  box(stroke: 1pt, inset: 5pt)[This is a figure],\n  caption: [This is a caption]\n) <fig2>\n```\n\nThis is the result with 0.12 (the subpar figure has number 0):\n\n![image|496x165](upload://ouV6vXPmSJ1Pmr5nu2WzFA8TmDw.png)\n\nThis is the result with 0.11.1 (the subpar figure has number 1):\n\n![image|480x161](upload://hktbP5msQhm7fxhbRBHYZpLL3fu.png)\n\nHow to fix this?",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 60,
      "score": 1827.0,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 341
    },
    {
      "id": 3562,
      "post_number": 2,
      "username": "xkevio",
      "name": "Kevio",
      "created_at": "2024-10-08T12:35:37.234Z",
      "updated_at": "2024-10-08T12:35:37.234Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"talb\" data-post=\"1\" data-topic=\"984\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/talb/48/463_2.png\" class=\"avatar\"> talb:</div>\n<blockquote>\n<p>How to fix this?</p>\n</blockquote>\n</aside>\n<p>Wait until <a class=\"mention\" href=\"/u/tinger\">@Tinger</a> updates the package for v0.12 which hasn’t yet officially released. The issue is the new interaction between <code>counter.display()</code> and floating figures: <a href=\"https://forum.typst.app/t/how-to-customize-the-style-of-equation-numbering/641/8\" class=\"inline-onebox\">How to customize the style of equation numbering? - #8 by xkevio</a></p>",
      "raw": "[quote=\"talb, post:1, topic:984\"]\nHow to fix this?\n[/quote]\n Wait until @Tinger updates the package for v0.12 which hasn't yet officially released. The issue is the new interaction between `counter.display()` and floating figures: https://forum.typst.app/t/how-to-customize-the-style-of-equation-numbering/641/8",
      "reply_to_post_number": null,
      "reply_count": 1,
      "quote_count": 1,
      "like_count": 2,
      "reads": 55,
      "score": 91.0,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 21
    },
    {
      "id": 3563,
      "post_number": 3,
      "username": "talb",
      "name": "talb",
      "created_at": "2024-10-08T12:38:06.431Z",
      "updated_at": "2024-10-08T12:38:06.431Z",
      "cooked": "<p>Thanks. Should I report the bugs I encounter in 0.12 directly as GitHub issues to avoid polluting the forum?</p>",
      "raw": "Thanks. Should I report the bugs I encounter in 0.12 directly as GitHub issues to avoid polluting the forum?",
      "reply_to_post_number": 2,
      "reply_count": 1,
      "quote_count": 0,
      "like_count": 0,
      "reads": 52,
      "score": 15.4,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 341
    },
    {
      "id": 3564,
      "post_number": 4,
      "username": "xkevio",
      "name": "Kevio",
      "created_at": "2024-10-08T12:39:18.236Z",
      "updated_at": "2024-10-08T12:39:32.132Z",
      "cooked": "<p>This you would have to report to the <code>subpar</code> repository as this new behavior isn’t actually a bug (in Typst) but technically correct now. The fact that <code>counter.display()</code> worked before with floating figures was apparently only a coincidence.</p>",
      "raw": "This you would have to report to the `subpar` repository as this new behavior isn't actually a bug (in Typst) but technically correct now. The fact that `counter.display()` worked before with floating figures was apparently only a coincidence.",
      "reply_to_post_number": 3,
      "reply_count": 3,
      "quote_count": 0,
      "like_count": 0,
      "reads": 52,
      "score": 40.4,
      "accepted_answer": false,
      "trust_level": 2,
      "user_id": 21
    },
    {
      "id": 3565,
      "post_number": 5,
      "username": "talb",
      "name": "talb",
      "created_at": "2024-10-08T12:40:44.791Z",
      "updated_at": "2024-10-08T12:40:44.791Z",
      "cooked": "<p>Yes of course, I meant filing an issue to the corresponding package.</p>",
      "raw": "Yes of course, I meant filing an issue to the corresponding package.",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 1,
      "reads": 49,
      "score": 34.8,
      "accepted_answer": false,
      "trust_level": 1,
      "user_id": 341
    },
    {
      "id": 3566,
      "post_number": 6,
      "username": "Tinger",
      "name": "Tinger",
      "created_at": "2024-10-08T12:56:55.172Z",
      "updated_at": "2024-10-08T12:56:55.172Z",
      "cooked": "<aside class=\"quote no-group\" data-username=\"xkevio\" data-post=\"4\" data-topic=\"984\" data-full=\"true\">\n<div class=\"title\">\n<div class=\"quote-controls\"></div>\n<img loading=\"lazy\" alt=\"\" width=\"24\" height=\"24\" src=\"https://forum.typst.app/user_avatar/forum.typst.app/xkevio/48/37_2.png\" class=\"avatar\"> xkevio:</div>\n<blockquote>\n<p>This you would have to report to the <code>subpar</code> repository as this new behavior isn’t actually a bug (in Typst) but technically correct now. The fact that <code>counter.display()</code> worked before with floating figures was apparently only a coincidence.</p>\n</blockquote>\n</aside>\n<p>Indeed and that also gives us a hint at a solution. Because, this also reproduces the issue:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show figure.caption: it =&gt; context box(\n  inset: (left: 1em, right: 1em),\n  align(left)[\n    *#it.supplement~#it.counter.display()#it.separator*#it.body\n  ]\n)\n\n#figure(\n  box(stroke: 1pt, inset: 5pt)[This is a figure],\n  caption: [This is a caption],\n  placement: auto,\n)\n</code></pre>\n<p>In both cases the solution is to nest the <code>caption</code> show rule inside a <code>figure</code> show rule and using that figure’s location to get the correct counter value, as seen here:</p>\n<pre data-code-wrap=\"typ\"><code class=\"lang-typ\">#show figure: fig =&gt; {\n  show figure.caption: it =&gt; context box(\n    inset: (left: 1em, right: 1em),\n    align(left)[\n      *#it.supplement~#numbering(it.numbering, ..it.counter.at(fig.location()))#it.separator*#it.body\n    ]\n  )\n\n  fig\n}\n</code></pre>\n<p>This fixes the issue for both cases, hope that helps. :)</p>",
      "raw": "[quote=\"xkevio, post:4, topic:984, full:true\"]\nThis you would have to report to the `subpar` repository as this new behavior isn’t actually a bug (in Typst) but technically correct now. The fact that `counter.display()` worked before with floating figures was apparently only a coincidence.\n[/quote]\n\nIndeed and that also gives us a hint at a solution. Because, this also reproduces the issue:\n```typ\n#show figure.caption: it => context box(\n  inset: (left: 1em, right: 1em),\n  align(left)[\n    *#it.supplement~#it.counter.display()#it.separator*#it.body\n  ]\n)\n\n#figure(\n  box(stroke: 1pt, inset: 5pt)[This is a figure],\n  caption: [This is a caption],\n  placement: auto,\n)\n```\n\nIn both cases the solution is to nest the `caption` show rule inside a `figure` show rule and using that figure's location to get the correct counter value, as seen here:\n```typ\n#show figure: fig => {\n  show figure.caption: it => context box(\n    inset: (left: 1em, right: 1em),\n    align(left)[\n      *#it.supplement~#numbering(it.numbering, ..it.counter.at(fig.location()))#it.separator*#it.body\n    ]\n  )\n\n  fig\n}\n```\n\nThis fixes the issue for both cases, hope that helps. :)",
      "reply_to_post_number": null,
      "reply_count": 0,
      "quote_count": 1,
      "like_count": 1,
      "reads": 47,
      "score": 74.4,
      "accepted_answer": true,
      "trust_level": 2,
      "user_id": 29
    },
    {
      "id": 3577,
      "post_number": 7,
      "username": "laurmaedje",
      "name": "Laurenz Mädje",
      "created_at": "2024-10-08T18:33:42.370Z",
      "updated_at": "2024-10-08T18:33:42.370Z",
      "cooked": "<p>Let’s put it this way: Using the figure‘s location is definitely the most correct. The other thing working was more by accident than design. That said, its probably still the more desirable behavior. Having said that it is not a regression was sugarcoating on my end.</p>\n<p>I’m still thinking through how exactly it should work, but it will probably change again, though I’m not sure whether in time for the release.</p>",
      "raw": "Let’s put it this way: Using the figure‘s location is definitely the most correct. The other thing working was more by accident than design. That said, its probably still the more desirable behavior. Having said that it is not a regression was sugarcoating on my end.\n\nI’m still thinking through how exactly it should work, but it will probably change again, though I’m not sure whether in time for the release.",
      "reply_to_post_number": 4,
      "reply_count": 0,
      "quote_count": 0,
      "like_count": 0,
      "reads": 38,
      "score": 37.6,
      "accepted_answer": false,
      "trust_level": 4,
      "user_id": 2
    }
  ],
  "scraped_at": "2025-06-10T09:57:10.983929"
}